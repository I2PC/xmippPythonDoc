<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Xmipp: xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xmipp_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xmipp
   &#160;<span id="projectnumber">v3.23.11-Nereus</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacexmipp3.html">xmipp3</a></li><li class="navelem"><a class="el" href="namespacexmipp3_1_1protocols.html">protocols</a></li><li class="navelem"><a class="el" href="namespacexmipp3_1_1protocols_1_1protocol__reconstruct__swarm.html">protocol_reconstruct_swarm</a></li><li class="navelem"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm.html">XmippProtReconstructSwarm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm:</div>
<div class="dyncontent">
<div class="center"><img src="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm__inherit__graph.png" border="0" usemap="#xmipp3_8protocols_8protocol__reconstruct__swarm_8XmippProtReconstructSwarm_inherit__map" alt="Inheritance graph"/></div>
<map name="xmipp3_8protocols_8protocol__reconstruct__swarm_8XmippProtReconstructSwarm_inherit__map" id="xmipp3_8protocols_8protocol__reconstruct__swarm_8XmippProtReconstructSwarm_inherit__map">
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm:</div>
<div class="dyncontent">
<div class="center"><img src="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm__coll__graph.png" border="0" usemap="#xmipp3_8protocols_8protocol__reconstruct__swarm_8XmippProtReconstructSwarm_coll__map" alt="Collaboration graph"/></div>
<map name="xmipp3_8protocols_8protocol__reconstruct__swarm_8XmippProtReconstructSwarm_coll__map" id="xmipp3_8protocols_8protocol__reconstruct__swarm_8XmippProtReconstructSwarm_coll__map">
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a06cf04ba0c735af65a399c89090babe9"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm.html#a06cf04ba0c735af65a399c89090babe9">readInfoField</a> (self, fnDir, block, label)</td></tr>
<tr class="separator:a06cf04ba0c735af65a399c89090babe9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea038f4167298d2eb1c2aa794a1b6afd"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm.html#aea038f4167298d2eb1c2aa794a1b6afd">writeInfoField</a> (self, fnDir, block, label, value)</td></tr>
<tr class="separator:aea038f4167298d2eb1c2aa794a1b6afd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab07c2f24ee56992cbcc9ab3886b7b8a2"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm.html#ab07c2f24ee56992cbcc9ab3886b7b8a2">convertInputVolume</a> (self, imgHandler, obj, fnIn, fnOut, TsCurrent, newXdim)</td></tr>
<tr class="separator:ab07c2f24ee56992cbcc9ab3886b7b8a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab08d355d4ddd8a24c8bd0ebfdd91349b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm.html#ab08d355d4ddd8a24c8bd0ebfdd91349b">convertInputStep</a> (self, inputParticlesId)</td></tr>
<tr class="separator:ab08d355d4ddd8a24c8bd0ebfdd91349b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba8325eeddbbac9db86455ee6416ab5a"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm.html#aba8325eeddbbac9db86455ee6416ab5a">evaluateIndividuals</a> (self, iteration)</td></tr>
<tr class="separator:aba8325eeddbbac9db86455ee6416ab5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a848b7b0645547d38dba23985449743e8"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm.html#a848b7b0645547d38dba23985449743e8">createOutput</a> (self)</td></tr>
<tr class="separator:a848b7b0645547d38dba23985449743e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5627cfe9f3dc39023ade627ab4df7125"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm.html#a5627cfe9f3dc39023ade627ab4df7125">reconstructNewVolumes</a> (self, iteration)</td></tr>
<tr class="separator:a5627cfe9f3dc39023ade627ab4df7125"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34a1e0cc35ecf723230958b9e70f4036"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm.html#a34a1e0cc35ecf723230958b9e70f4036">cleanVolume</a> (self, fnVol)</td></tr>
<tr class="separator:a34a1e0cc35ecf723230958b9e70f4036"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a663649f0dbb2d4a9c4c40dc9da76c6d2"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm.html#a663649f0dbb2d4a9c4c40dc9da76c6d2">postProcessing</a> (self, iteration)</td></tr>
<tr class="separator:a663649f0dbb2d4a9c4c40dc9da76c6d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f441f01f26e9618078554e53054d093"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm.html#a4f441f01f26e9618078554e53054d093">updateVolumes</a> (self, iteration)</td></tr>
<tr class="separator:a4f441f01f26e9618078554e53054d093"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6f3391945b0f5982c667c62d247f6a2"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm.html#aa6f3391945b0f5982c667c62d247f6a2">calculateAverage</a> (self, iteration)</td></tr>
<tr class="separator:aa6f3391945b0f5982c667c62d247f6a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:adcebf398ebe88bccb64b1f88ead51c7c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__swarm_1_1XmippProtReconstructSwarm.html#adcebf398ebe88bccb64b1f88ead51c7c">imgsFn</a></td></tr>
<tr class="separator:adcebf398ebe88bccb64b1f88ead51c7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">This is a 3D refinement protocol whose main input is a set of volumes and a set of particles.
   The set of particles has to be at full size (the finer sampling rate available), but
   the rest of inputs (reference volume and masks) can be at any downsampling factor.
   The protocol scales the input images and volumes to a size that depends on the target resolution.

   The input set of volumes is considered to be a swarm of volumes and they try to optimize
   the correlation between the volumes and the set of particles. This is an stochastic maximization
   and only a fraction of the particles are used to update the volumes and evaluate them.
</pre> 
<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__swarm_8py_source.html#l00056">56</a> of file <a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="aa6f3391945b0f5982c667c62d247f6a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6f3391945b0f5982c667c62d247f6a2">&#9670;&nbsp;</a></span>calculateAverage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm.calculateAverage </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__swarm_8py_source.html#l00538">538</a> of file <a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keyword">def </span>calculateAverage(self,iteration):</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        fnAvg = self._getExtraPath(<span class="stringliteral">&quot;volumeAvg.vol&quot;</span>)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        N=0</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> <a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(self.inputVolumes.get().getSize()):</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            <span class="keywordflow">if</span> iteration&lt;=2:</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                fnVol = self._getExtraPath(<span class="stringliteral">&quot;volume%03d.vol&quot;</span>%i)</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                <span class="keywordflow">if</span> i==0:</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                    copyFile(fnVol,fnAvg)</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --plus %s&quot;</span>%(fnAvg,fnVol),numberOfMpi=1)</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                fnVol = self._getExtraPath(<span class="stringliteral">&quot;volume%03d_best.vol&quot;</span>%i)</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --plus %s&quot;</span>%(fnAvg,fnVol),numberOfMpi=1)</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            N+=1</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">if</span> iteration&gt;0:</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --plus %s&quot;</span>%(fnAvg,self._getExtraPath(<span class="stringliteral">&quot;volumeBest.vol&quot;</span>)),numberOfMpi=1)</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            N+=1</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --divide %f&quot;</span>%(fnAvg,N),numberOfMpi=1)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="ttc" id="namespacelibsvm_1_1svm_html_a94988a86d7dfc39cb8e193731dbf6c94"><div class="ttname"><a href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">libsvm.svm.range</a></div><div class="ttdeci">range</div><div class="ttdef"><b>Definition:</b> <a href="svm_8py_source.html#l00017">svm.py:17</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a34a1e0cc35ecf723230958b9e70f4036"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34a1e0cc35ecf723230958b9e70f4036">&#9670;&nbsp;</a></span>cleanVolume()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm.cleanVolume </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnVol</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__swarm_8py_source.html#l00474">474</a> of file <a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keyword">def </span>cleanVolume(self,fnVol):</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="comment"># Generate mask if available</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordflow">if</span> self.nextMask.hasValue():</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            fnMask=self._getExtraPath(<span class="stringliteral">&quot;mask.vol&quot;</span>)</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            fnMask=<span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        fnRootRestored=self._getExtraPath(<span class="stringliteral">&quot;volumeRestored&quot;</span>)</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        args=<span class="stringliteral">&#39;--i1 %s --i2 %s --oroot %s --denoising 1&#39;</span>%(fnVol,fnVol,fnRootRestored)</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="keywordflow">if</span> fnMask!=<span class="stringliteral">&quot;&quot;</span>:</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            args+=<span class="stringliteral">&quot; --mask binary_file %s&quot;</span>%fnMask</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_volume_halves_restoration&#39;</span>,args,numberOfMpi=1)</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        moveFile(<span class="stringliteral">&quot;%s_restored1.vol&quot;</span>%fnRootRestored,fnVol)</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        cleanPath(<span class="stringliteral">&quot;%s_restored2.vol&quot;</span>%fnRootRestored)</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        args=<span class="stringliteral">&#39;--i1 %s --i2 %s --oroot %s --filterBank 0.01&#39;</span>%(fnVol,fnVol,fnRootRestored)</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keywordflow">if</span> fnMask!=<span class="stringliteral">&quot;&quot;</span>:</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            args+=<span class="stringliteral">&quot; --mask binary_file %s&quot;</span>%fnMask</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_volume_halves_restoration&#39;</span>,args,numberOfMpi=1)</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        moveFile(<span class="stringliteral">&quot;%s_restored1.vol&quot;</span>%fnRootRestored,fnVol)</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        cleanPath(<span class="stringliteral">&quot;%s_restored2.vol&quot;</span>%fnRootRestored)</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        cleanPath(<span class="stringliteral">&quot;%s_filterBank.vol&quot;</span>%fnRootRestored)</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="ab08d355d4ddd8a24c8bd0ebfdd91349b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab08d355d4ddd8a24c8bd0ebfdd91349b">&#9670;&nbsp;</a></span>convertInputStep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm.convertInputStep </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>inputParticlesId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__swarm_8py_source.html#l00142">142</a> of file <a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keyword">def </span>convertInputStep(self, inputParticlesId):</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        fnDir=self._getExtraPath()</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <a class="code" href="namespacexmipp3_1_1convert_1_1convert.html#a497bb7406003a5e6c285ef27b5242230">writeSetOfParticles</a>(self.inputParticles.get(),self.imgsFn)</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="comment"># Choose the target sampling rate        </span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        TsOrig=self.inputParticles.get().getSamplingRate()</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        TsCurrent=max(TsOrig,self.targetResolution.get()/3)</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        Xdim=self.inputParticles.get().getDimensions()[0]</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        newXdim=<a class="code" href="namespaceswiftalign__aligned__2d__classfication.html#a37cd1488892b72bd75f39b9864edfad3">int</a>(round(Xdim*TsOrig/TsCurrent))</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">if</span> newXdim&lt;40:</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            newXdim=<a class="code" href="namespaceswiftalign__aligned__2d__classfication.html#a37cd1488892b72bd75f39b9864edfad3">int</a>(40)</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            TsCurrent=Xdim*(TsOrig/newXdim)</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        print(<span class="stringliteral">&quot;Preparing images to sampling rate=&quot;</span>,TsCurrent)</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        self.writeInfoField(fnDir,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE,newXdim)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        self.writeInfoField(fnDir,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE,TsCurrent)</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        </div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="comment"># Prepare particles</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        fnNewParticles=join(fnDir,<span class="stringliteral">&quot;images.stk&quot;</span>)</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">if</span> newXdim!=Xdim:</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_resize&quot;</span>,<span class="stringliteral">&quot;-i %s -o %s --fourier %d&quot;</span>%(self.imgsFn,fnNewParticles,newXdim),</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                        numberOfMpi=self.numberOfMpi.get()*self.numberOfThreads.get())</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_convert&quot;</span>,<span class="stringliteral">&quot;-i %s -o %s --save_metadata_stack %s&quot;</span>%(self.imgsFn,fnNewParticles,join(fnDir,<span class="stringliteral">&quot;images.xmd&quot;</span>)),</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                        numberOfMpi=1)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        R=self.particleRadius.get()</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">if</span> R&lt;=0:</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            R=self.inputParticles.get().getDimensions()[0]/2</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        R=min(round(R*TsOrig/TsCurrent*1.1),newXdim/2)</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        self.runJob(<span class="stringliteral">&quot;xmipp_transform_mask&quot;</span>,<span class="stringliteral">&quot;-i %s --mask circular -%d&quot;</span>%(fnNewParticles,R),numberOfMpi=self.numberOfMpi.get()*self.numberOfThreads.get())</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        </div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="comment"># Prepare mask</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        imgHandler=ImageHandler()</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="keywordflow">if</span> self.nextMask.hasValue():</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            self.convertInputVolume(imgHandler, self.nextMask.get(), <a class="code" href="namespacexmipp3_1_1convert_1_1convert.html#ac5b8e610548b5feb4e3fe59493942c51">getImageLocation</a>(self.nextMask.get()), join(fnDir,<span class="stringliteral">&quot;mask.vol&quot;</span>), TsCurrent, newXdim)</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        </div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="comment"># Prepare references</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        i=0</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">for</span> vol <span class="keywordflow">in</span> self.inputVolumes.get():</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            fnVol=join(fnDir,<span class="stringliteral">&quot;volume%03d.vol&quot;</span>%i)</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            self.convertInputVolume(imgHandler, vol, <a class="code" href="namespacexmipp3_1_1convert_1_1convert.html#ac5b8e610548b5feb4e3fe59493942c51">getImageLocation</a>(vol), fnVol, TsCurrent, newXdim)</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --mult 0 -o %s&quot;</span>%(fnVol,join(fnDir,<span class="stringliteral">&quot;volume%03d_speed.vol&quot;</span>%i)),numberOfMpi=1)</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            i+=1</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        emlib.MetaData().<a class="code" href="namespacepython_1_1tompy_1_1io.html#aef0f48d28574deb9e4f2df6aa17887d9">write</a>(<span class="stringliteral">&quot;best@&quot;</span>+self._getExtraPath(<span class="stringliteral">&quot;swarm.xmd&quot;</span>)) <span class="comment"># Empty write to guarantee this block is the first one</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        emlib.MetaData().<a class="code" href="namespacepython_1_1tompy_1_1io.html#aef0f48d28574deb9e4f2df6aa17887d9">write</a>(<span class="stringliteral">&quot;bestByVolume@&quot;</span>+self._getExtraPath(<span class="stringliteral">&quot;swarm.xmd&quot;</span>),emlib.MD_APPEND) <span class="comment"># Empty write to guarantee this block is the second one</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    </div><div class="ttc" id="namespacexmipp3_1_1convert_1_1convert_html_a497bb7406003a5e6c285ef27b5242230"><div class="ttname"><a href="namespacexmipp3_1_1convert_1_1convert.html#a497bb7406003a5e6c285ef27b5242230">xmipp3.convert.convert.writeSetOfParticles</a></div><div class="ttdeci">def writeSetOfParticles(imgSet, filename, blockName='Particles', kwargs)</div><div class="ttdef"><b>Definition:</b> <a href="convert_8py_source.html#l01101">convert.py:1101</a></div></div>
<div class="ttc" id="namespacexmipp3_1_1convert_1_1convert_html_ac5b8e610548b5feb4e3fe59493942c51"><div class="ttname"><a href="namespacexmipp3_1_1convert_1_1convert.html#ac5b8e610548b5feb4e3fe59493942c51">xmipp3.convert.convert.getImageLocation</a></div><div class="ttdeci">def getImageLocation(image)</div><div class="ttdef"><b>Definition:</b> <a href="convert_8py_source.html#l00408">convert.py:408</a></div></div>
<div class="ttc" id="namespacepython_1_1tompy_1_1io_html_aef0f48d28574deb9e4f2df6aa17887d9"><div class="ttname"><a href="namespacepython_1_1tompy_1_1io.html#aef0f48d28574deb9e4f2df6aa17887d9">python.tompy.io.write</a></div><div class="ttdeci">def write(filename, data)</div><div class="ttdef"><b>Definition:</b> <a href="io_8py_source.html#l00054">io.py:54</a></div></div>
<div class="ttc" id="namespaceswiftalign__aligned__2d__classfication_html_a37cd1488892b72bd75f39b9864edfad3"><div class="ttname"><a href="namespaceswiftalign__aligned__2d__classfication.html#a37cd1488892b72bd75f39b9864edfad3">swiftalign_aligned_2d_classfication.int</a></div><div class="ttdeci">int</div><div class="ttdef"><b>Definition:</b> <a href="swiftalign__aligned__2d__classfication_8py_source.html#l00147">swiftalign_aligned_2d_classfication.py:147</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab07c2f24ee56992cbcc9ab3886b7b8a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab07c2f24ee56992cbcc9ab3886b7b8a2">&#9670;&nbsp;</a></span>convertInputVolume()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm.convertInputVolume </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>imgHandler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnIn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnOut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>TsCurrent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>newXdim</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__swarm_8py_source.html#l00136">136</a> of file <a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keyword">def </span>convertInputVolume(self, imgHandler, obj, fnIn, fnOut, TsCurrent, newXdim):</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_image_resize&#39;</span>,<span class="stringliteral">&quot;-i %s -o %s --factor %f&quot;</span>%(fnIn,fnOut,obj.getSamplingRate()/TsCurrent),numberOfMpi=1)</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        objXdim, _, _, _ =imgHandler.getDimensions((1,fnOut))</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">if</span> newXdim!=objXdim:</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_transform_window&#39;</span>,<span class="stringliteral">&quot;-i %s --size %d&quot;</span>%(fnOut,newXdim),numberOfMpi=1)</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a848b7b0645547d38dba23985449743e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a848b7b0645547d38dba23985449743e8">&#9670;&nbsp;</a></span>createOutput()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm.createOutput </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__swarm_8py_source.html#l00326">326</a> of file <a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keyword">def </span>createOutput(self):</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        fnDir = self._getExtraPath()</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        Ts=self.readInfoField(fnDir,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="comment"># Remove files that will not be used any longer</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        cleanPath(join(fnDir,<span class="stringliteral">&quot;images.stk&quot;</span>))</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        cleanPath(join(fnDir,<span class="stringliteral">&quot;images.xmd&quot;</span>))</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="comment"># Final average</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        TsOrig=self.inputParticles.get().getSamplingRate()</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        XdimOrig=self.inputParticles.get().getDimensions()[0]</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        fnAvg = self._getExtraPath(<span class="stringliteral">&quot;volumeAvg.vol&quot;</span>)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        fnAvgMrc = self._getExtraPath(<span class="stringliteral">&quot;volumeAvg.mrc&quot;</span>)</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        self.runJob(<span class="stringliteral">&quot;xmipp_image_resize&quot;</span>,<span class="stringliteral">&quot;-i %s --dim %d&quot;</span>%(fnAvg,XdimOrig),numberOfMpi=1)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        self.runJob(<span class="stringliteral">&quot;xmipp_image_convert&quot;</span>,<span class="stringliteral">&quot;-i %s -o %s -t vol&quot;</span>%(fnAvg,fnAvgMrc),numberOfMpi=1)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        cleanPath(fnAvg)</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        self.runJob(<span class="stringliteral">&quot;xmipp_image_header&quot;</span>,<span class="stringliteral">&quot;-i %s --sampling_rate %f&quot;</span>%(fnAvgMrc,TsOrig),numberOfMpi=1)</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        volume=Volume()</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        volume.setFileName(fnAvgMrc)</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        volume.setSamplingRate(TsOrig)</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        self._defineOutputs(outputVolume=volume)</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        self._defineSourceRelation(self.inputParticles.get(),volume)</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        self._defineSourceRelation(self.inputVolumes.get(),volume)</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        </div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="comment"># Swarm of volumes</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        volSet = self._createSetOfVolumes()</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        volSet.setSamplingRate(Ts)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> <a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(self.inputVolumes.get().getSize()):</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            fnVol = self._getExtraPath(<span class="stringliteral">&quot;volume%03d_best.vol&quot;</span>%i)</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            fnMrc = self._getExtraPath(<span class="stringliteral">&quot;volume%03d_best.mrc&quot;</span>%i)</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_convert&quot;</span>, <span class="stringliteral">&quot;-i %s -o %s&quot;</span> % (fnVol, fnMrc), numberOfMpi=1)</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_header&quot;</span>, <span class="stringliteral">&quot;-i %s --sampling_rate %f&quot;</span> % (fnMrc, TsOrig), numberOfMpi=1)</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            cleanPath(fnVol)</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            vol=Volume()</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            vol.setFileName(fnMrc)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            vol.setSamplingRate(Ts)</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            volSet.append(vol)</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        self._defineOutputs(outputVolumes=volSet)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        self._defineSourceRelation(self.inputParticles.get(),volSet)</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        self._defineSourceRelation(self.inputVolumes.get(),volSet)</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            </div><div class="ttc" id="namespacelibsvm_1_1svm_html_a94988a86d7dfc39cb8e193731dbf6c94"><div class="ttname"><a href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">libsvm.svm.range</a></div><div class="ttdeci">range</div><div class="ttdef"><b>Definition:</b> <a href="svm_8py_source.html#l00017">svm.py:17</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aba8325eeddbbac9db86455ee6416ab5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba8325eeddbbac9db86455ee6416ab5a">&#9670;&nbsp;</a></span>evaluateIndividuals()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm.evaluateIndividuals </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__swarm_8py_source.html#l00187">187</a> of file <a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keyword">def </span>evaluateIndividuals(self,iteration):</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        fnDir = self._getExtraPath()</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        newXdim = self.readInfoField(fnDir,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE)</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        angleStep = max(math.atan2(1,newXdim/2),self.minAngle.get())</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        TsOrig=self.inputParticles.get().getSamplingRate()</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        TsCurrent = self.readInfoField(fnDir,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        fnMask = self._getExtraPath(<span class="stringliteral">&quot;mask.vol&quot;</span>)</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        fnImages = join(fnDir, <span class="stringliteral">&quot;images.xmd&quot;</span>)</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        maxShift = round(0.1 * newXdim)</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        R = self.particleRadius.get()</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">if</span> R &lt;= 0:</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            R = self.inputParticles.get().getDimensions()[0] / 2</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        R = R * TsOrig / TsCurrent</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        bestWeightVol={}</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        bestIterVol={}</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">if</span> iteration&gt;0:</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            mdPrevious = emlib.MetaData(<span class="stringliteral">&quot;bestByVolume@&quot;</span>+self._getExtraPath(<span class="stringliteral">&quot;swarm.xmd&quot;</span>))</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordflow">for</span> objId <span class="keywordflow">in</span> mdPrevious:</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                idx = <a class="code" href="namespaceswiftalign__aligned__2d__classfication.html#a37cd1488892b72bd75f39b9864edfad3">int</a>(mdPrevious.getValue(emlib.MDL_IDX,objId))</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                bestWeightVol[idx]=mdPrevious.getValue(emlib.MDL_WEIGHT,objId)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                bestIterVol[idx]=mdPrevious.getValue(emlib.MDL_ITER,objId)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="comment"># Global alignment</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        md=emlib.MetaData()</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordflow">if</span> iteration&gt;1:</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            mdBest = emlib.MetaData(<span class="stringliteral">&quot;best@&quot;</span>+self._getExtraPath(<span class="stringliteral">&quot;swarm.xmd&quot;</span>))</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            objId = mdBest.firstObject()</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            bestWeight = mdBest.getValue(emlib.MDL_WEIGHT,objId)</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            bestWeight = -1e38</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> <a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(self.inputVolumes.get().getSize()):</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="comment"># Filter and mask volumes</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            fnVol = self._getExtraPath(<span class="stringliteral">&quot;volume%03d.vol&quot;</span>%i)</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_transform_filter&quot;</span>,<span class="stringliteral">&quot;-i %s --fourier low_pass %f --sampling %f&quot;</span>%(fnVol,self.targetResolution,TsCurrent),numberOfMpi=1)</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnMask):</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --mult %s&quot;</span>%(fnVol,fnMask),numberOfMpi=1)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            </div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="comment"># Prepare subset of experimental images</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            fnTest =  join(fnDir,<span class="stringliteral">&quot;imgs_%03d.xmd&quot;</span>%i)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --operate random_subset %d -o %s&quot;</span>%(fnImages,self.NimgTest,fnTest),numberOfMpi=1)</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            </div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="comment"># Generate projections</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            fnGallery=join(fnDir,<span class="stringliteral">&quot;gallery%02d.stk&quot;</span>%i)</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            fnGalleryMd=join(fnDir,<span class="stringliteral">&quot;gallery%02d.doc&quot;</span>%i)</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">#             args=&quot;-i %s -o %s --sampling_rate %f --perturb %f --sym %s&quot;%\</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">#                  (fnVol,fnGallery,angleStep,math.sin(angleStep*math.pi/180.0)/4,self.symmetryGroup)</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            args=<span class="stringliteral">&quot;-i %s -o %s --sampling_rate %f --sym %s&quot;</span>%\</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                 (fnVol,fnGallery,angleStep,self.symmetryGroup)</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            args+=<span class="stringliteral">&quot; --compute_neighbors --angular_distance -1 --experimental_images %s&quot;</span>%fnTest</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_angular_project_library&quot;</span>,args,numberOfMpi=self.numberOfMpi.get()*self.numberOfThreads.get())</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            </div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="comment"># Assign angles</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            fnAngles = join(fnDir, <span class="stringliteral">&quot;angles_iter001_00.xmd&quot;</span>)</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.useGpu.get():</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                args = <span class="stringliteral">&#39;-i %s --initgallery %s --maxShift %d --odir %s --dontReconstruct --useForValidation 1&#39;</span> % \</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                       (fnTest, fnGalleryMd, maxShift, fnDir)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                self.runJob(<span class="stringliteral">&#39;xmipp_reconstruct_significant&#39;</span>, args,</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                            numberOfMpi=self.numberOfMpi.get() * self.numberOfThreads.get())</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                count=0</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                GpuListCuda=<span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                <span class="keywordflow">if</span> self.useQueueForSteps() <span class="keywordflow">or</span> self.useQueue():</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                    GpuList = os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>]</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                    GpuList = GpuList.split(<span class="stringliteral">&quot;,&quot;</span>)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                    <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> GpuList:</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                        GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                        count+=1</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                    GpuList = <span class="stringliteral">&#39; &#39;</span>.join([str(elem) <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> self.getGpuList()])</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                    GpuListAux = <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                    <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> self.getGpuList():</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                        GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                        GpuListAux = GpuListAux+str(elem)+<span class="stringliteral">&#39;,&#39;</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                        count+=1</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                    os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>] = GpuListAux</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                args = <span class="stringliteral">&#39;-i %s -r %s -o %s --keepBestN 1 --dev %s &#39;</span> % (</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                fnTest, fnGalleryMd, fnAngles, GpuListCuda)</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                self.runJob(CUDA_ALIGN_SIGNIFICANT, args, numberOfMpi=1)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            <span class="comment"># Evaluate</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            fnAngles = join(fnDir, <span class="stringliteral">&quot;angles_iter001_00.xmd&quot;</span>)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAngles):</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <span class="comment"># Significant may decide not to write it if it is not significant</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                mdAngles = emlib.MetaData(fnAngles)</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                weight = mdAngles.getColumnValues(emlib.MDL_MAXCC)</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                avgWeight = reduce(<span class="keyword">lambda</span> x, y: x + y, weight) / len(weight)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                print(<span class="stringliteral">&quot;Average weight for &quot;</span>+fnVol+<span class="stringliteral">&quot; = &quot;</span>+str(avgWeight))</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                objId = md.addObject()</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                md.setValue(emlib.MDL_IDX,<a class="code" href="namespaceswiftalign__aligned__2d__classfication.html#a37cd1488892b72bd75f39b9864edfad3">int</a>(i),objId)</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                md.setValue(emlib.MDL_IMAGE,fnVol,objId)</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                md.setValue(emlib.MDL_WEIGHT,avgWeight,objId)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                md.setValue(emlib.MDL_ITER,iteration,objId)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                </div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                <span class="comment"># Is global best</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                <span class="keywordflow">if</span> avgWeight&gt;bestWeight:</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    bestWeight = avgWeight</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    <span class="keywordflow">if</span> iteration==0:</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                        <span class="comment"># None of the input volumes can be the best volume in the first iteration since their gray values may significantly</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                        <span class="comment"># differ from those in the projections</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                        self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --mult 0 -o %s&quot;</span>%(fnVol,self._getExtraPath(<span class="stringliteral">&quot;volumeBest.vol&quot;</span>)),numberOfMpi=1)</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                        copyFile(fnVol, self._getExtraPath(<span class="stringliteral">&quot;volumeBest.vol&quot;</span>))</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                    mdBest=emlib.MetaData()</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                    objId=mdBest.addObject()</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                    mdBest.setValue(emlib.MDL_IMAGE,fnVol,objId)</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                    mdBest.setValue(emlib.MDL_WEIGHT,bestWeight,objId)</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                    mdBest.setValue(emlib.MDL_ITER,iteration,objId)</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                    mdBest.write(<span class="stringliteral">&quot;best@&quot;</span>+self._getExtraPath(<span class="stringliteral">&quot;swarm.xmd&quot;</span>),emlib.MD_APPEND)</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                </div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                <span class="comment"># Is local best</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                <span class="keywordflow">if</span> iteration==0:</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --mult 0 -o %s&quot;</span>%(fnVol, self._getExtraPath(<span class="stringliteral">&quot;volume%03d_best.vol&quot;</span>%i)),numberOfMpi=1)</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                <span class="keywordflow">elif</span> avgWeight&gt;bestWeightVol[i] <span class="keywordflow">or</span> iteration==1:</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                    bestWeightVol[i]=avgWeight</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                    bestIterVol[i]=iteration</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                    copyFile(fnVol,self._getExtraPath(<span class="stringliteral">&quot;volume%03d_best.vol&quot;</span>%i))</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <span class="comment"># Clean</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            cleanPath(fnTest)</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            self.runJob(<span class="stringliteral">&quot;rm -f&quot;</span>,fnDir+<span class="stringliteral">&quot;/*iter00?_00.xmd&quot;</span>,numberOfMpi=1)</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            self.runJob(<span class="stringliteral">&quot;rm -f&quot;</span>,fnDir+<span class="stringliteral">&quot;/gallery*&quot;</span>,numberOfMpi=1)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        md.write(<span class="stringliteral">&quot;evaluations_%03d@&quot;</span>%iteration+self._getExtraPath(<span class="stringliteral">&quot;swarm.xmd&quot;</span>),emlib.MD_APPEND)</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        </div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="comment"># Update best by volume</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordflow">if</span> iteration==0:</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            md.write(<span class="stringliteral">&quot;bestByVolume@&quot;</span>+self._getExtraPath(<span class="stringliteral">&quot;swarm.xmd&quot;</span>),emlib.MD_APPEND)</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            md.clear()</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> <a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(self.inputVolumes.get().getSize()):</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                objId = md.addObject()</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                md.setValue(emlib.MDL_IDX,<a class="code" href="namespaceswiftalign__aligned__2d__classfication.html#a37cd1488892b72bd75f39b9864edfad3">int</a>(i),objId)</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                md.setValue(emlib.MDL_IMAGE,self._getExtraPath(<span class="stringliteral">&quot;volume%03d_best.vol&quot;</span>%i),objId)</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                md.setValue(emlib.MDL_WEIGHT,bestWeightVol[i],objId)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                md.setValue(emlib.MDL_ITER,bestIterVol[i],objId)</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            md.write(<span class="stringliteral">&quot;bestByVolume@&quot;</span>+self._getExtraPath(<span class="stringliteral">&quot;swarm.xmd&quot;</span>),emlib.MD_APPEND)</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        </div><div class="ttc" id="namespaceAutoConfig_html_a4db5974500e14fc05a286bdbfd7701b0"><div class="ttname"><a href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">AutoConfig.exists</a></div><div class="ttdeci">def exists(env)</div><div class="ttdef"><b>Definition:</b> <a href="install_2scons-tools_2AutoConfig_8py_source.html#l00088">AutoConfig.py:88</a></div></div>
<div class="ttc" id="namespacelibsvm_1_1svm_html_a94988a86d7dfc39cb8e193731dbf6c94"><div class="ttname"><a href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">libsvm.svm.range</a></div><div class="ttdeci">range</div><div class="ttdef"><b>Definition:</b> <a href="svm_8py_source.html#l00017">svm.py:17</a></div></div>
<div class="ttc" id="namespaceswiftalign__aligned__2d__classfication_html_a37cd1488892b72bd75f39b9864edfad3"><div class="ttname"><a href="namespaceswiftalign__aligned__2d__classfication.html#a37cd1488892b72bd75f39b9864edfad3">swiftalign_aligned_2d_classfication.int</a></div><div class="ttdeci">int</div><div class="ttdef"><b>Definition:</b> <a href="swiftalign__aligned__2d__classfication_8py_source.html#l00147">swiftalign_aligned_2d_classfication.py:147</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a663649f0dbb2d4a9c4c40dc9da76c6d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a663649f0dbb2d4a9c4c40dc9da76c6d2">&#9670;&nbsp;</a></span>postProcessing()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm.postProcessing </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__swarm_8py_source.html#l00497">497</a> of file <a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keyword">def </span>postProcessing(self, iteration):</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="comment"># Calculate average</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        self.calculateAverage(iteration)</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="comment"># Align volumes</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        fnAvg = self._getExtraPath(<span class="stringliteral">&quot;volumeAvg.vol&quot;</span>)</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> <a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(self.inputVolumes.get().getSize()):</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            fnVol = self._getExtraPath(<span class="stringliteral">&quot;volume%03d.vol&quot;</span>%i)</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_volume_align&#39;</span>,<span class="stringliteral">&#39;--i1 %s --i2 %s --local --apply&#39;</span>%(fnAvg,fnVol),numberOfMpi=1)</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            <span class="keywordflow">if</span> iteration&gt;=2:</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                fnVol = self._getExtraPath(<span class="stringliteral">&quot;volume%03d_best.vol&quot;</span>%i)</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                self.runJob(<span class="stringliteral">&#39;xmipp_volume_align&#39;</span>,<span class="stringliteral">&#39;--i1 %s --i2 %s --local --apply&#39;</span>%(fnAvg,fnVol),numberOfMpi=1)</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="comment"># Remove untrusted background voxels</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> <a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(self.inputVolumes.get().getSize()):</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            fnVol = self._getExtraPath(<span class="stringliteral">&quot;volume%03d.vol&quot;</span>%i)</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            self.cleanVolume(fnVol)</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="ttc" id="namespacelibsvm_1_1svm_html_a94988a86d7dfc39cb8e193731dbf6c94"><div class="ttname"><a href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">libsvm.svm.range</a></div><div class="ttdeci">range</div><div class="ttdef"><b>Definition:</b> <a href="svm_8py_source.html#l00017">svm.py:17</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a06cf04ba0c735af65a399c89090babe9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06cf04ba0c735af65a399c89090babe9">&#9670;&nbsp;</a></span>readInfoField()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm.readInfoField </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnDir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>label</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__swarm_8py_source.html#l00126">126</a> of file <a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keyword">def </span><a class="code" href="namespacexmipp__base.html#a3d3d7f5fe3571f0d7d059ea085620f8a">readInfoField</a>(self,fnDir,block,label):</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        mdInfo = emlib.MetaData(<span class="stringliteral">&quot;%s@%s&quot;</span>%(block,join(fnDir,<span class="stringliteral">&quot;info.xmd&quot;</span>)))</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordflow">return</span> mdInfo.getValue(label,mdInfo.firstObject())</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="ttc" id="namespacexmipp__base_html_a3d3d7f5fe3571f0d7d059ea085620f8a"><div class="ttname"><a href="namespacexmipp__base.html#a3d3d7f5fe3571f0d7d059ea085620f8a">xmipp_base.readInfoField</a></div><div class="ttdeci">def readInfoField(fnDir, block, label, xmdFile=&quot;iterInfo.xmd&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__base_8py_source.html#l00494">xmipp_base.py:494</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5627cfe9f3dc39023ade627ab4df7125"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5627cfe9f3dc39023ade627ab4df7125">&#9670;&nbsp;</a></span>reconstructNewVolumes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm.reconstructNewVolumes </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__swarm_8py_source.html#l00368">368</a> of file <a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keyword">def </span>reconstructNewVolumes(self,iteration):</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        fnDir = self._getExtraPath()</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        newXdim = self.readInfoField(fnDir,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE)</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        angleStep = max(math.atan2(1,newXdim/2),self.minAngle.get())</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        TsOrig=self.inputParticles.get().getSamplingRate()</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        TsCurrent = self.readInfoField(fnDir,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        fnImages = join(fnDir,<span class="stringliteral">&quot;images.xmd&quot;</span>)</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        </div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        maxShift=round(0.1*newXdim)</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        R=self.particleRadius.get()</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="keywordflow">if</span> R&lt;=0:</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            R=self.inputParticles.get().getDimensions()[0]/2</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        R=R*TsOrig/TsCurrent</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="comment"># Global alignment</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> <a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(self.inputVolumes.get().getSize()):</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            fnVol = self._getExtraPath(<span class="stringliteral">&quot;volume%03d.vol&quot;</span>%i)</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            <span class="comment"># Prepare subset of experimental images</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            fnTrain =  join(fnDir,<span class="stringliteral">&quot;imgs_%03d.xmd&quot;</span>%i)</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --operate random_subset %d -o %s&quot;</span>%(fnImages,self.NimgTrain,fnTrain),numberOfMpi=1)</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            </div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="comment"># Generate projections</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            fnGallery=join(fnDir,<span class="stringliteral">&quot;gallery%02d.stk&quot;</span>%i)</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            fnGalleryMd=join(fnDir,<span class="stringliteral">&quot;gallery%02d.doc&quot;</span>%i)</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">#             args=&quot;-i %s -o %s --sampling_rate %f --perturb %f --sym %s&quot;%\</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">#                  (fnVol,fnGallery,angleStep,math.sin(angleStep*math.pi/180.0)/4,self.symmetryGroup)</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            args=<span class="stringliteral">&quot;-i %s -o %s --sampling_rate %f --sym %s&quot;</span>%\</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                 (fnVol,fnGallery,angleStep,self.symmetryGroup)</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            args+=<span class="stringliteral">&quot; --compute_neighbors --angular_distance -1 --experimental_images %s&quot;</span>%fnTrain</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_angular_project_library&quot;</span>,args,numberOfMpi=self.numberOfMpi.get()*self.numberOfThreads.get())</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            </div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="comment"># Assign angles</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            fnAngles = join(fnDir, <span class="stringliteral">&quot;angles_iter001_00.xmd&quot;</span>)</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.useGpu.get():</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                args = <span class="stringliteral">&#39;-i %s --initgallery %s --maxShift %d --odir %s --dontReconstruct --useForValidation 1&#39;</span> % \</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                       (fnTrain, fnGalleryMd, maxShift, fnDir)</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                self.runJob(<span class="stringliteral">&#39;xmipp_reconstruct_significant&#39;</span>, args,</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                            numberOfMpi=self.numberOfMpi.get() * self.numberOfThreads.get())</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                count=0</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                GpuListCuda=<span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                <span class="keywordflow">if</span> self.useQueueForSteps() <span class="keywordflow">or</span> self.useQueue():</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                    GpuList = os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>]</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                    GpuList = GpuList.split(<span class="stringliteral">&quot;,&quot;</span>)</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                    <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> GpuList:</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                        GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                        count+=1</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                    GpuList = <span class="stringliteral">&#39; &#39;</span>.join([str(elem) <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> self.getGpuList()])</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                    GpuListAux = <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                    <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> self.getGpuList():</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                        GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                        GpuListAux = GpuListAux+str(elem)+<span class="stringliteral">&#39;,&#39;</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                        count+=1</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                    os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>] = GpuListAux</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                args = <span class="stringliteral">&#39;-i %s -r %s -o %s --keepBestN 1 --dev %s &#39;</span> % (</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                fnTrain, fnGalleryMd, fnAngles, GpuListCuda)</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                self.runJob(CUDA_ALIGN_SIGNIFICANT, args, numberOfMpi=1)</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <span class="comment"># Reconstruct</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAngles):</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                <span class="comment"># Significant may decide not to write it if no image is significant</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                args = <span class="stringliteral">&quot;-i %s -o %s --sym %s --weight --fast&quot;</span> % (</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                fnAngles, fnVol, self.symmetryGroup)</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                <span class="keywordflow">if</span> self.useGpu.get():</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                    <span class="comment">#AJ to make it work with and without queue system</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                    <span class="keywordflow">if</span> self.numberOfMpi.get()&gt;1:</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                        N_GPUs = len((self.gpuList.get()).split(<span class="stringliteral">&#39;,&#39;</span>))</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                        args += <span class="stringliteral">&#39; -gpusPerNode %d&#39;</span> % N_GPUs</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                        args += <span class="stringliteral">&#39; -threadsPerGPU %d&#39;</span> % max(self.numberOfThreads.get(),4)</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                    count=0</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                    GpuListCuda=<span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                    <span class="keywordflow">if</span> self.useQueueForSteps() <span class="keywordflow">or</span> self.useQueue():</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                        GpuList = os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>]</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                        GpuList = GpuList.split(<span class="stringliteral">&quot;,&quot;</span>)</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                        <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> GpuList:</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                            GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                            count+=1</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                        GpuListAux = <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                        <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> self.getGpuList():</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                            GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                            GpuListAux = GpuListAux+str(elem)+<span class="stringliteral">&#39;,&#39;</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                            count+=1</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                        os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>] = GpuListAux</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                    args += <span class="stringliteral">&quot; --thr %s&quot;</span> % self.numberOfThreads.get()</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                    <span class="keywordflow">if</span> self.numberOfMpi.get()==1:</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                        args += <span class="stringliteral">&quot; --device %s&quot;</span> % GpuListCuda</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                    <span class="keywordflow">if</span> self.numberOfMpi.get()&gt;1:</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                        self.runJob(<span class="stringliteral">&#39;xmipp_cuda_reconstruct_fourier&#39;</span>, args, numberOfMpi=len((self.gpuList.get()).split(<span class="stringliteral">&#39;,&#39;</span>))+1)</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                        self.runJob(<span class="stringliteral">&#39;xmipp_cuda_reconstruct_fourier&#39;</span>, args)</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                    self.runJob(<span class="stringliteral">&#39;xmipp_reconstruct_fourier_accel&#39;</span>, args)</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                args = <span class="stringliteral">&quot;-i %s --mask circular %f&quot;</span> % (fnVol, -R)</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_transform_mask&quot;</span>, args, numberOfMpi=1)</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                args = <span class="stringliteral">&quot;-i %s --select below 0 --substitute value 0&quot;</span> % fnVol</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_transform_threshold&quot;</span>, args, numberOfMpi=1)</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="comment"># Clean</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            cleanPath(fnTrain)</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            self.runJob(<span class="stringliteral">&quot;rm -f&quot;</span>,fnDir+<span class="stringliteral">&quot;/*iter00?_00.xmd&quot;</span>,numberOfMpi=1)</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            self.runJob(<span class="stringliteral">&quot;rm -f&quot;</span>,fnDir+<span class="stringliteral">&quot;/gallery*&quot;</span>,numberOfMpi=1)</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    </div><div class="ttc" id="namespaceAutoConfig_html_a4db5974500e14fc05a286bdbfd7701b0"><div class="ttname"><a href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">AutoConfig.exists</a></div><div class="ttdeci">def exists(env)</div><div class="ttdef"><b>Definition:</b> <a href="install_2scons-tools_2AutoConfig_8py_source.html#l00088">AutoConfig.py:88</a></div></div>
<div class="ttc" id="namespacelibsvm_1_1svm_html_a94988a86d7dfc39cb8e193731dbf6c94"><div class="ttname"><a href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">libsvm.svm.range</a></div><div class="ttdeci">range</div><div class="ttdef"><b>Definition:</b> <a href="svm_8py_source.html#l00017">svm.py:17</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4f441f01f26e9618078554e53054d093"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f441f01f26e9618078554e53054d093">&#9670;&nbsp;</a></span>updateVolumes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm.updateVolumes </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__swarm_8py_source.html#l00515">515</a> of file <a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keyword">def </span>updateVolumes(self,iteration):</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        fnBest = self._getExtraPath(<span class="stringliteral">&quot;volumeBest.vol&quot;</span>)</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        fnInternal = self._getExtraPath(<span class="stringliteral">&quot;internalBest.vol&quot;</span>)</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        fnExternal = self._getExtraPath(<span class="stringliteral">&quot;externalBest.vol&quot;</span>)</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> <a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(self.inputVolumes.get().getSize()):</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            fnVol = self._getExtraPath(<span class="stringliteral">&quot;volume%03d.vol&quot;</span>%i)</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            fnVolBest = self._getExtraPath(<span class="stringliteral">&quot;volume%03d_best.vol&quot;</span>%i)</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            fnSpeed = self._getExtraPath(<span class="stringliteral">&quot;volume%03d_speed.vol&quot;</span>%i)</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            </div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            u1 = random.uniform(0, 1)</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            u2 = random.uniform(0, 1)</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            </div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --minus %s -o %s&quot;</span>%(fnVolBest,fnVol,fnInternal),numberOfMpi=1)</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --minus %s -o %s&quot;</span>%(fnBest,fnVol,fnExternal),numberOfMpi=1)</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --mult %f&quot;</span>%(fnInternal,2*u1),numberOfMpi=1)</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --mult %f&quot;</span>%(fnExternal,2*u2),numberOfMpi=1)</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --plus %s&quot;</span>%(fnSpeed,fnInternal),numberOfMpi=1)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --plus %s&quot;</span>%(fnSpeed,fnExternal),numberOfMpi=1)</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --plus %s&quot;</span>%(fnVol,fnSpeed),numberOfMpi=1)</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            </div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        cleanPath(fnInternal)</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        cleanPath(fnExternal)</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="ttc" id="namespacelibsvm_1_1svm_html_a94988a86d7dfc39cb8e193731dbf6c94"><div class="ttname"><a href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">libsvm.svm.range</a></div><div class="ttdeci">range</div><div class="ttdef"><b>Definition:</b> <a href="svm_8py_source.html#l00017">svm.py:17</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aea038f4167298d2eb1c2aa794a1b6afd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea038f4167298d2eb1c2aa794a1b6afd">&#9670;&nbsp;</a></span>writeInfoField()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm.writeInfoField </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnDir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__swarm_8py_source.html#l00130">130</a> of file <a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keyword">def </span><a class="code" href="namespacexmipp__base.html#a5d29a2b26aadbdd8f89762c128860e9c">writeInfoField</a>(self,fnDir,block,label, value):</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        mdInfo = emlib.MetaData()</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        objId=mdInfo.addObject()</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        mdInfo.setValue(label,value,objId)</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        mdInfo.write(<span class="stringliteral">&quot;%s@%s&quot;</span>%(block, join(fnDir,<span class="stringliteral">&quot;info.xmd&quot;</span>)),emlib.MD_APPEND)</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="ttc" id="namespacexmipp__base_html_a5d29a2b26aadbdd8f89762c128860e9c"><div class="ttname"><a href="namespacexmipp__base.html#a5d29a2b26aadbdd8f89762c128860e9c">xmipp_base.writeInfoField</a></div><div class="ttdeci">def writeInfoField(fnDir, block, label, value, xmdFile=&quot;iterInfo.xmd&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__base_8py_source.html#l00499">xmipp_base.py:499</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="adcebf398ebe88bccb64b1f88ead51c7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adcebf398ebe88bccb64b1f88ead51c7c">&#9670;&nbsp;</a></span>imgsFn</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmipp3.protocols.protocol_reconstruct_swarm.XmippProtReconstructSwarm.imgsFn</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__swarm_8py_source.html#l00112">112</a> of file <a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>scipion-em-xmipp/xmipp3/protocols/<a class="el" href="protocol__reconstruct__swarm_8py_source.html">protocol_reconstruct_swarm.py</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
