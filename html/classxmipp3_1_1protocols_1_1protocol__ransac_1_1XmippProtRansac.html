<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Xmipp: xmipp3.protocols.protocol_ransac.XmippProtRansac Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xmipp_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xmipp
   &#160;<span id="projectnumber">v20.07</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacexmipp3.html">xmipp3</a></li><li class="navelem"><a class="el" href="namespacexmipp3_1_1protocols.html">protocols</a></li><li class="navelem"><a class="el" href="namespacexmipp3_1_1protocols_1_1protocol__ransac.html">protocol_ransac</a></li><li class="navelem"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html">XmippProtRansac</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">xmipp3.protocols.protocol_ransac.XmippProtRansac Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for xmipp3.protocols.protocol_ransac.XmippProtRansac:</div>
<div class="dyncontent">
<div class="center"><img src="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac__inherit__graph.png" border="0" usemap="#xmipp3_8protocols_8protocol__ransac_8XmippProtRansac_inherit__map" alt="Inheritance graph"/></div>
<map name="xmipp3_8protocols_8protocol__ransac_8XmippProtRansac_inherit__map" id="xmipp3_8protocols_8protocol__ransac_8XmippProtRansac_inherit__map">
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for xmipp3.protocols.protocol_ransac.XmippProtRansac:</div>
<div class="dyncontent">
<div class="center"><img src="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac__coll__graph.png" border="0" usemap="#xmipp3_8protocols_8protocol__ransac_8XmippProtRansac_coll__map" alt="Collaboration graph"/></div>
<map name="xmipp3_8protocols_8protocol__ransac_8XmippProtRansac_coll__map" id="xmipp3_8protocols_8protocol__ransac_8XmippProtRansac_coll__map">
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a968029f61c7697d6ee4532a498cff41a"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#a968029f61c7697d6ee4532a498cff41a">__init__</a> (self, args)</td></tr>
<tr class="separator:a968029f61c7697d6ee4532a498cff41a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c5ca100860cee41d3a91edd8d7629af"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#a8c5ca100860cee41d3a91edd8d7629af">convertInputStep</a> (self, classesFn)</td></tr>
<tr class="separator:a8c5ca100860cee41d3a91edd8d7629af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade8c961c1a7a7b38535e651345c25b9b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#ade8c961c1a7a7b38535e651345c25b9b">ransacIterationStep</a> (self, n)</td></tr>
<tr class="separator:ade8c961c1a7a7b38535e651345c25b9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acebcf040d315800edccec19355bb15d8"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#acebcf040d315800edccec19355bb15d8">reconstructStep</a> (self, fnRoot)</td></tr>
<tr class="separator:acebcf040d315800edccec19355bb15d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a497cd6ba21a48bf4461bb7649590f024"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#a497cd6ba21a48bf4461bb7649590f024">resizeStep</a> (self, fnRoot, <a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#a89af80506ea44e6227a63dd621488e27">Xdim</a>)</td></tr>
<tr class="separator:a497cd6ba21a48bf4461bb7649590f024"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07952bec94cb23434a1acd722557d22d"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#a07952bec94cb23434a1acd722557d22d">getCorrThreshStep</a> (self)</td></tr>
<tr class="separator:a07952bec94cb23434a1acd722557d22d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adadc8bc283b5167f67478cf855d5dee5"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#adadc8bc283b5167f67478cf855d5dee5">evaluateVolumesStep</a> (self)</td></tr>
<tr class="separator:adadc8bc283b5167f67478cf855d5dee5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb33973891dfd6e26d5023d60e6f94e4"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#acb33973891dfd6e26d5023d60e6f94e4">getBestVolumesStep</a> (self)</td></tr>
<tr class="separator:acb33973891dfd6e26d5023d60e6f94e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5debb77e589da072fa31904f48b9021f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#a5debb77e589da072fa31904f48b9021f">projMatchStep</a> (self, fnBase)</td></tr>
<tr class="separator:a5debb77e589da072fa31904f48b9021f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31dd5dc75e630f0de66cc816914f2c2c"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#a31dd5dc75e630f0de66cc816914f2c2c">scoreFinalVolumes</a> (self)</td></tr>
<tr class="separator:a31dd5dc75e630f0de66cc816914f2c2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12a02b290770ea24e7a27ce407462af4"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#a12a02b290770ea24e7a27ce407462af4">projectInitialVolume</a> (self)</td></tr>
<tr class="separator:a12a02b290770ea24e7a27ce407462af4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac97ca7eafff4105df83db69417a7be85"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#ac97ca7eafff4105df83db69417a7be85">createOutputStep</a> (self)</td></tr>
<tr class="separator:ac97ca7eafff4105df83db69417a7be85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af22a7e43519e27449eef0e681dbeb823"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#af22a7e43519e27449eef0e681dbeb823">getCCThreshold</a> (self)</td></tr>
<tr class="separator:af22a7e43519e27449eef0e681dbeb823"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:afa0120bf683c95c121ba488290e343dd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#afa0120bf683c95c121ba488290e343dd">stepsExecutionMode</a></td></tr>
<tr class="separator:afa0120bf683c95c121ba488290e343dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87e4f02816f4c7dd900450fee29bcdde"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#a87e4f02816f4c7dd900450fee29bcdde">imgsFn</a></td></tr>
<tr class="separator:a87e4f02816f4c7dd900450fee29bcdde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89af80506ea44e6227a63dd621488e27"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#a89af80506ea44e6227a63dd621488e27">Xdim</a></td></tr>
<tr class="separator:a89af80506ea44e6227a63dd621488e27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cc22dc97c2150fcb274fbab18916c9b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__ransac_1_1XmippProtRansac.html#a3cc22dc97c2150fcb274fbab18916c9b">Xdim2</a></td></tr>
<tr class="separator:a3cc22dc97c2150fcb274fbab18916c9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Computes an initial 3d model from a set of projections/classes 
using RANSAC algorithm.

This method is based on an initial non-lineal dimensionality
reduction approach which allows to select representative small 
sets of class average images capturing the most of the structural 
information of the particle under study. These reduced sets are 
then used to generate volumes from random orientation assignments. 
The best volume is determined from these guesses using a random 
sample consensus (RANSAC) approach.    </pre> 
<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00046">46</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a968029f61c7697d6ee4532a498cff41a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a968029f61c7697d6ee4532a498cff41a">&#9670;&nbsp;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_ransac.XmippProtRansac.__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00061">61</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">def </span>__init__(self, **args):</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        ProtInitialVolume.__init__(self, **args)</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        self.stepsExecutionMode = STEPS_PARALLEL</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a8c5ca100860cee41d3a91edd8d7629af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c5ca100860cee41d3a91edd8d7629af">&#9670;&nbsp;</a></span>convertInputStep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_ransac.XmippProtRansac.convertInputStep </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>classesFn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00210">210</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keyword">def </span>convertInputStep(self, classesFn):</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        inputSet = self.inputSet.get()</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        </div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordflow">if</span> isinstance(inputSet, SetOfClasses2D):</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <a class="code" href="namespacexmipp3_1_1convert_1_1convert.html#abd828a562fc4de27a096509d97ccc5b0">writeSetOfClasses2D</a>(inputSet, classesFn)</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <a class="code" href="namespacexmipp3_1_1convert_1_1convert.html#a497bb7406003a5e6c285ef27b5242230">writeSetOfParticles</a>(inputSet, classesFn)</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        </div><div class="ttc" id="namespacexmipp3_1_1convert_1_1convert_html_abd828a562fc4de27a096509d97ccc5b0"><div class="ttname"><a href="namespacexmipp3_1_1convert_1_1convert.html#abd828a562fc4de27a096509d97ccc5b0">xmipp3.convert.convert.writeSetOfClasses2D</a></div><div class="ttdeci">def writeSetOfClasses2D(classes2DSet, filename, classesBlock='classes', writeParticles=True)</div><div class="ttdef"><b>Definition:</b> <a href="convert_8py_source.html#l01158">convert.py:1158</a></div></div>
<div class="ttc" id="namespacexmipp3_1_1convert_1_1convert_html_a497bb7406003a5e6c285ef27b5242230"><div class="ttname"><a href="namespacexmipp3_1_1convert_1_1convert.html#a497bb7406003a5e6c285ef27b5242230">xmipp3.convert.convert.writeSetOfParticles</a></div><div class="ttdeci">def writeSetOfParticles(imgSet, filename, blockName='Particles', kwargs)</div><div class="ttdef"><b>Definition:</b> <a href="convert_8py_source.html#l01096">convert.py:1096</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac97ca7eafff4105df83db69417a7be85"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac97ca7eafff4105df83db69417a7be85">&#9670;&nbsp;</a></span>createOutputStep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_ransac.XmippProtRansac.createOutputStep </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00468">468</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keyword">def </span>createOutputStep(self):</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        inputSet = self.inputSet.get()</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        fn = self._getPath(<span class="stringliteral">&#39;proposedVolumes.xmd&#39;</span>)</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">#        md = emlib.MetaData(fn)</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">#        md.addItemId()</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">#        md.write(fn)</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        </div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        volumesSet = self._createSetOfVolumes()</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        volumesSet.setSamplingRate(inputSet.getSamplingRate())</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        self._counter = 0</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <a class="code" href="namespacexmipp3_1_1convert_1_1convert.html#ac45cd554b1a3208724585053f06882b5">readSetOfVolumes</a>(fn, volumesSet, postprocessImageRow=self._postprocessVolume)</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        </div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="comment"># Set a meaningful comment</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">#         for vol in volumesSet:</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">#             vol.setObjComment(&#39;ransac volume %02d&#39; % vol.getObjId())</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">#             volumesSet.update(vol)</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        </div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        self._defineOutputs(outputVolumes=volumesSet)</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        self._defineSourceRelation(self.inputSet, volumesSet)</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        self._storeSummaryInfo(self.numVolumes.get())</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    </div><div class="ttc" id="namespacexmipp3_1_1convert_1_1convert_html_ac45cd554b1a3208724585053f06882b5"><div class="ttname"><a href="namespacexmipp3_1_1convert_1_1convert.html#ac45cd554b1a3208724585053f06882b5">xmipp3.convert.convert.readSetOfVolumes</a></div><div class="ttdeci">def readSetOfVolumes(filename, volSet, kwargs)</div><div class="ttdef"><b>Definition:</b> <a href="convert_8py_source.html#l00756">convert.py:756</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adadc8bc283b5167f67478cf855d5dee5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adadc8bc283b5167f67478cf855d5dee5">&#9670;&nbsp;</a></span>evaluateVolumesStep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_ransac.XmippProtRansac.evaluateVolumesStep </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00343">343</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keyword">def </span>evaluateVolumesStep(self):</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        fnCorr=self._getExtraPath(<span class="stringliteral">&quot;correlations.xmd&quot;</span>)</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        fnCorr = <span class="stringliteral">&#39;corrThreshold@&#39;</span>+fnCorr</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        mdCorr= emlib.MetaData(fnCorr)</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        objId = mdCorr.firstObject()    </div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        CorrThresh = mdCorr.getValue(emlib.MDL_WEIGHT,objId)</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">for</span> n <span class="keywordflow">in</span> <a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(self.nRansac.get()):        </div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            fnRoot=<span class="stringliteral">&quot;ransac%05d&quot;</span>%n              </div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            fnAngles=self._getTmpPath(<span class="stringliteral">&quot;angles_&quot;</span>+fnRoot+<span class="stringliteral">&quot;.xmd&quot;</span>)    </div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            md = emlib.MetaData(fnAngles)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            numInliers=0</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="keywordflow">for</span> objId <span class="keywordflow">in</span> md:</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                corr = md.getValue(emlib.MDL_MAXCC, objId)</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;               </div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                <span class="keywordflow">if</span> (corr &gt;= CorrThresh) :</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                    numInliers = numInliers+corr</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    </div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            md= emlib.MetaData()</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            objId = md.addObject()</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            md.setValue(emlib.MDL_WEIGHT,float(numInliers),objId)</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            md.write(<span class="stringliteral">&quot;inliers@&quot;</span>+fnAngles,emlib.MD_APPEND)</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    </div><div class="ttc" id="namespacelibsvm_1_1svm_html_a94988a86d7dfc39cb8e193731dbf6c94"><div class="ttname"><a href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">libsvm.svm.range</a></div><div class="ttdeci">range</div><div class="ttdef"><b>Definition:</b> <a href="svm_8py_source.html#l00017">svm.py:17</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acb33973891dfd6e26d5023d60e6f94e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb33973891dfd6e26d5023d60e6f94e4">&#9670;&nbsp;</a></span>getBestVolumesStep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_ransac.XmippProtRansac.getBestVolumesStep </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00365">365</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keyword">def </span>getBestVolumesStep(self):</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        volumes = []</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        inliers = []</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        </div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">for</span> n <span class="keywordflow">in</span> <a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(self.nRansac.get()):</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            fnAngles = self._getTmpPath(<span class="stringliteral">&quot;angles_ransac%05d&quot;</span>%n+<span class="stringliteral">&quot;.xmd&quot;</span>)</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            md=emlib.MetaData(<span class="stringliteral">&quot;inliers@&quot;</span>+fnAngles)</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            numInliers=md.getValue(emlib.MDL_WEIGHT,md.firstObject())</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            volumes.append(fnAngles)</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            inliers.append(numInliers)</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        </div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        index = sorted(<a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(inliers.__len__()), key=<span class="keyword">lambda</span> k: inliers[k])</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        fnBestAngles = <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        threshold=self.getCCThreshold()</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;     </div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        i = self.nRansac.get()-1</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        indx = 0</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">while</span> i &gt;= 0 <span class="keywordflow">and</span> indx &lt; self.numVolumes:</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            fnBestAngles = volumes[index[i]]</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            fnBestAnglesOut = self._getPath(<span class="stringliteral">&quot;proposedVolume%05d&quot;</span>%indx+<span class="stringliteral">&quot;.xmd&quot;</span>)</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            copyFile(fnBestAngles, fnBestAnglesOut)</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            self._log.info(<span class="stringliteral">&quot;Best volume %d = %s&quot;</span> % (indx, fnBestAngles))</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.useAll:</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s -o %s --query select \&quot;maxCC&gt;%f \&quot; --mode append&quot;</span> %(fnBestAnglesOut,fnBestAnglesOut,threshold))</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespacexmipp__base.html#ab4190ff6617a11d6e1946be36f82acf6">isMdEmpty</a>(fnBestAnglesOut):</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                    indx += 1</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                indx += 1</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            i -= 1</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            </div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="comment"># Remove unnecessary files</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordflow">for</span> n <span class="keywordflow">in</span> <a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(self.nRansac.get()):</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            fnAngles = self._getTmpPath(<span class="stringliteral">&quot;angles_ransac%05d&quot;</span>%n+<span class="stringliteral">&quot;.xmd&quot;</span>)</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            cleanPath(fnAngles)</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;             </div><div class="ttc" id="namespacelibsvm_1_1svm_html_a94988a86d7dfc39cb8e193731dbf6c94"><div class="ttname"><a href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">libsvm.svm.range</a></div><div class="ttdeci">range</div><div class="ttdef"><b>Definition:</b> <a href="svm_8py_source.html#l00017">svm.py:17</a></div></div>
<div class="ttc" id="namespacexmipp__base_html_ab4190ff6617a11d6e1946be36f82acf6"><div class="ttname"><a href="namespacexmipp__base.html#ab4190ff6617a11d6e1946be36f82acf6">xmipp_base.isMdEmpty</a></div><div class="ttdeci">def isMdEmpty(filename)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__base_8py_source.html#l00488">xmipp_base.py:488</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af22a7e43519e27449eef0e681dbeb823"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af22a7e43519e27449eef0e681dbeb823">&#9670;&nbsp;</a></span>getCCThreshold()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_ransac.XmippProtRansac.getCCThreshold </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00538">538</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keyword">def </span>getCCThreshold(self):</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        fnCorr = self._getExtraPath(<span class="stringliteral">&quot;correlations.xmd&quot;</span>)               </div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        mdCorr = emlib.MetaData(<span class="stringliteral">&quot;corrThreshold@&quot;</span>+fnCorr)</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="keywordflow">return</span> mdCorr.getValue(emlib.MDL_WEIGHT, mdCorr.firstObject())</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="a07952bec94cb23434a1acd722557d22d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07952bec94cb23434a1acd722557d22d">&#9670;&nbsp;</a></span>getCorrThreshStep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_ransac.XmippProtRansac.getCorrThreshStep </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00313">313</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keyword">def </span>getCorrThreshStep(self):</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        corrVector = []</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        fnCorr=self._getExtraPath(<span class="stringliteral">&quot;correlations.xmd&quot;</span>)               </div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        mdCorr= emlib.MetaData()</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    </div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">for</span> n <span class="keywordflow">in</span> <a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(self.nRansac.get()):</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            fnRoot=<span class="stringliteral">&quot;ransac%05d&quot;</span>%n</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            fnAngles=self._getTmpPath(<span class="stringliteral">&quot;angles_&quot;</span>+fnRoot+<span class="stringliteral">&quot;.xmd&quot;</span>)</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            md = emlib.MetaData(fnAngles)</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            </div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <span class="keywordflow">for</span> objId <span class="keywordflow">in</span> md:</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                corr = md.getValue(emlib.MDL_MAXCC, objId)</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                corrVector.append(corr)</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                objIdCorr = mdCorr.addObject()</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                mdCorr.setValue(emlib.MDL_MAXCC,float(corr),objIdCorr)</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    </div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        mdCorr.write(<span class="stringliteral">&quot;correlations@&quot;</span>+fnCorr,emlib.MD_APPEND)</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        mdCorr= emlib.MetaData()</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        sortedCorrVector = sorted(corrVector)</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        indx = int(floor(self.corrThresh.get()*(len(sortedCorrVector)-1)))    </div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        </div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="comment">#With the line below commented the percentil is not used for the threshold and is used the value introduced in the form</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="comment">#CorrThresh = sortedCorrVector[indx]#</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            </div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        objId = mdCorr.addObject()</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        mdCorr.setValue(emlib.MDL_WEIGHT,self.corrThresh.get(),objId)</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        mdCorr.write(<span class="stringliteral">&quot;corrThreshold@&quot;</span>+fnCorr,emlib.MD_APPEND)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        print(<span class="stringliteral">&quot;Correlation threshold: &quot;</span>+str(self.corrThresh.get()))</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    </div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    </div><div class="ttc" id="namespacelibsvm_1_1svm_html_a94988a86d7dfc39cb8e193731dbf6c94"><div class="ttname"><a href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">libsvm.svm.range</a></div><div class="ttdeci">range</div><div class="ttdef"><b>Definition:</b> <a href="svm_8py_source.html#l00017">svm.py:17</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a12a02b290770ea24e7a27ce407462af4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12a02b290770ea24e7a27ce407462af4">&#9670;&nbsp;</a></span>projectInitialVolume()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_ransac.XmippProtRansac.projectInitialVolume </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00450">450</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keyword">def </span>projectInitialVolume(self):</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        fnOutputInitVolume=self._getTmpPath(<span class="stringliteral">&quot;initialVolume.vol&quot;</span>)</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        img = ImageHandler()</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        img.convert(self.initialVolume.get(), fnOutputInitVolume)</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        self.runJob(<span class="stringliteral">&quot;xmipp_image_resize&quot;</span>,<span class="stringliteral">&quot;-i %s --dim %d %d&quot;</span>%(fnOutputInitVolume,self.Xdim2,self.Xdim2))</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        fnGallery=self._getTmpPath(<span class="stringliteral">&#39;gallery_InitialVolume.stk&#39;</span>)</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        fnOutputReducedClass = self._getExtraPath(<span class="stringliteral">&quot;reducedClasses.xmd&quot;</span>) </div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        self.runJob(<span class="stringliteral">&quot;xmipp_angular_project_library&quot;</span>, <span class="stringliteral">&quot;-i %s -o %s --sampling_rate %f --sym %s --method fourier 1 0.25 bspline --compute_neighbors --angular_distance -1 --experimental_images %s&quot;</span>\</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                              %(fnOutputInitVolume,fnGallery,self.angularSampling.get(),self.symmetryGroup.get(),fnOutputReducedClass))</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;   </div></div><!-- fragment -->
</div>
</div>
<a id="a5debb77e589da072fa31904f48b9021f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5debb77e589da072fa31904f48b9021f">&#9670;&nbsp;</a></span>projMatchStep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_ransac.XmippProtRansac.projMatchStep </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnBase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00400">400</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keyword">def </span>projMatchStep(self,fnBase):</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        fnRoot=self._getPath(fnBase)</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">if</span> os.path.exists(fnRoot+<span class="stringliteral">&quot;.vol&quot;</span>):</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            fnGallery=self._getTmpPath(<span class="stringliteral">&#39;gallery_&#39;</span>+fnBase+<span class="stringliteral">&#39;.stk&#39;</span>)</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            fnOutputReducedClass = self._getExtraPath(<span class="stringliteral">&quot;reducedClasses.xmd&quot;</span>) </div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            </div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            AngularSampling=max(self.angularSampling.get()/2.0,7.5);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_angular_project_library&quot;</span>, <span class="stringliteral">&quot;-i %s.vol -o %s --sampling_rate %f --sym %s --method fourier 1 0.25 bspline --compute_neighbors --angular_distance -1 --experimental_images %s&quot;</span>\</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                                  %(fnRoot,fnGallery,float(AngularSampling),self.symmetryGroup.get(),fnOutputReducedClass))</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        </div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_angular_projection_matching&quot;</span>, <span class="stringliteral">&quot;-i %s.xmd -o %s.xmd --ref %s --Ri 0 --Ro %s --max_shift %s --append&quot;</span>\</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                   %(fnRoot,fnRoot,fnGallery,str(self.Xdim/2),str(self.Xdim/20)))</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                    </div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            cleanPath(self._getTmpPath(<span class="stringliteral">&#39;gallery_&#39;</span>+fnBase+<span class="stringliteral">&#39;_sampling.xmd&#39;</span>))</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            cleanPath(self._getTmpPath(<span class="stringliteral">&#39;gallery_&#39;</span>+fnBase+<span class="stringliteral">&#39;.doc&#39;</span>))</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            cleanPath(self._getTmpPath(<span class="stringliteral">&#39;gallery_&#39;</span>+fnBase+<span class="stringliteral">&#39;.stk&#39;</span>))</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                 </div></div><!-- fragment -->
</div>
</div>
<a id="ade8c961c1a7a7b38535e651345c25b9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade8c961c1a7a7b38535e651345c25b9b">&#9670;&nbsp;</a></span>ransacIterationStep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_ransac.XmippProtRansac.ransacIterationStep </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00218">218</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keyword">def </span>ransacIterationStep(self, n):</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    </div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        fnOutputReducedClass = self._getExtraPath(<span class="stringliteral">&quot;reducedClasses.xmd&quot;</span>)  </div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        fnBase = <span class="stringliteral">&quot;ransac%05d&quot;</span>%n</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        fnRoot = self._getTmpPath(fnBase)</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        </div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    </div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">if</span> self.dimRed:</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="comment"># Get a random sample of images</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_transform_dimred&quot;</span>,<span class="stringliteral">&quot;-i %s --randomSample %s.xmd  %d -m LTSA &quot;</span>%(fnOutputReducedClass,fnRoot,self.numGrids.get()))</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">else</span>:        </div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s -o %s.xmd  --operate random_subset %d --mode overwrite &quot;</span>%(fnOutputReducedClass,fnRoot,self.numSamples.get()))</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s.xmd --fill angleRot rand_uniform -180 180 &quot;</span>%(fnRoot))</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s.xmd --fill angleTilt rand_uniform 0 180 &quot;</span>%(fnRoot))</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s.xmd --fill anglePsi  rand_uniform 0 360 &quot;</span>%(fnRoot)) </div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    </div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="comment"># If there is an initial volume, assign angles        </span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordflow">if</span> self.initialVolume.hasValue():</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            fnGallery=self._getTmpPath(<span class="stringliteral">&#39;gallery_InitialVolume.stk&#39;</span>)</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_angular_projection_matching&quot;</span>, <span class="stringliteral">&quot;-i %s.xmd -o %s.xmd --ref %s --Ri 0 --Ro %s --max_shift %s --append&quot;</span>\</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                   %(fnRoot,fnRoot,fnGallery,str(self.Xdim/2),str(self.Xdim/20)))</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    </div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="comment"># Reconstruct with the small sample</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        self.reconstructStep(fnRoot)</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        </div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        fnVol = fnRoot+<span class="stringliteral">&#39;.vol&#39;</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        </div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="comment"># Generate projections from this reconstruction</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        fnGallery=self._getTmpPath(<span class="stringliteral">&#39;gallery_&#39;</span>+fnBase+<span class="stringliteral">&#39;.stk&#39;</span>)</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        self.runJob(<span class="stringliteral">&quot;xmipp_angular_project_library&quot;</span>, <span class="stringliteral">&quot;-i %s -o %s --sampling_rate %f --sym %s --method fourier 1 0.25 bspline --compute_neighbors --angular_distance -1 --experimental_images %s --max_tilt_angle 90&quot;</span>\</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                    %(fnVol,fnGallery,self.angularSampling.get(),self.symmetryGroup.get(),fnOutputReducedClass))</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            </div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="comment"># Assign angles to the rest of images</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        fnAngles=self._getTmpPath(<span class="stringliteral">&#39;angles_&#39;</span>+fnBase+<span class="stringliteral">&#39;.xmd&#39;</span>)</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        self.runJob(<span class="stringliteral">&quot;xmipp_angular_projection_matching&quot;</span>, <span class="stringliteral">&quot;-i %s -o %s --ref %s --Ri 0 --Ro %s --max_shift %s --append&quot;</span>\</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                              %(fnOutputReducedClass,fnAngles,fnGallery,str(self.Xdim/2),str(self.Xdim/20)))</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;       </div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="comment"># Delete intermediate files </span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        cleanPath(fnGallery)</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        cleanPath(self._getTmpPath(<span class="stringliteral">&#39;gallery_&#39;</span>+fnBase+<span class="stringliteral">&#39;_sampling.xmd&#39;</span>))</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        cleanPath(self._getTmpPath(<span class="stringliteral">&#39;gallery_&#39;</span>+fnBase+<span class="stringliteral">&#39;.doc&#39;</span>))</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        cleanPath(fnVol)</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        cleanPath(self._getTmpPath(fnBase+<span class="stringliteral">&#39;.xmd&#39;</span>))</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="acebcf040d315800edccec19355bb15d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acebcf040d315800edccec19355bb15d8">&#9670;&nbsp;</a></span>reconstructStep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_ransac.XmippProtRansac.reconstructStep </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnRoot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00262">262</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keyword">def </span>reconstructStep(self, fnRoot):</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keyword">from</span> pwem.emlib.metadata <span class="keyword">import</span> getSize</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">if</span> os.path.exists(fnRoot+<span class="stringliteral">&quot;.xmd&quot;</span>):</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            Nimages=getSize(fnRoot+<span class="stringliteral">&quot;.xmd&quot;</span>)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            <span class="keywordflow">if</span> Nimages&gt;0:</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                <span class="keywordflow">if</span> self.useGpu.get():</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                    <span class="comment"># protocol will run several reconstructions at once, so execute each reconstruction separately</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                    args = <span class="stringliteral">&quot;-i %s.xmd -o %s.vol --sym %s --thr %s --fast&quot;</span>\</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                           % (fnRoot, fnRoot, self.symmetryGroup.get(), self.numberOfThreads.get())</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                    <span class="comment">#AJ to make it work with and without queue system</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                    <span class="keywordflow">if</span> self.numberOfMpi.get()&gt;1:</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                        N_GPUs = len((self.gpuList.get()).split(<span class="stringliteral">&#39;,&#39;</span>))</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                        args += <span class="stringliteral">&#39; -gpusPerNode %d&#39;</span> % N_GPUs</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                        args += <span class="stringliteral">&#39; -threadsPerGPU %d&#39;</span> % max(self.numberOfThreads.get(),4)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                    count=0</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                    GpuListCuda=<span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    <span class="keywordflow">if</span> self.useQueueForSteps() <span class="keywordflow">or</span> self.useQueue():</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                        GpuList = os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>]</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                        GpuList = GpuList.split(<span class="stringliteral">&quot;,&quot;</span>)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                        <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> GpuList:</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                            GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                            count+=1</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                        GpuListAux = <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                        <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> self.getGpuList():</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                            GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                            GpuListAux = GpuListAux+str(elem)+<span class="stringliteral">&#39;,&#39;</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                            count+=1</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                        os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>] = GpuListAux</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                    <span class="keywordflow">if</span> self.numberOfMpi.get()==1:</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                        args += <span class="stringliteral">&quot; --device %s&quot;</span> %GpuListCuda</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                    <span class="keywordflow">if</span> self.numberOfMpi.get()&gt;1:</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                        self.runJob(<span class="stringliteral">&#39;xmipp_cuda_reconstruct_fourier&#39;</span>, args, numberOfMpi=len((self.gpuList.get()).split(<span class="stringliteral">&#39;,&#39;</span>))+1)</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                        self.runJob(<span class="stringliteral">&#39;xmipp_cuda_reconstruct_fourier&#39;</span>, args)</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_reconstruct_fourier_accel&quot;</span>,<span class="stringliteral">&quot;-i %s.xmd -o %s.vol --sym %s &quot;</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                                %(fnRoot,fnRoot,self.symmetryGroup.get()))</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_transform_mask&quot;</span>,<span class="stringliteral">&quot;-i %s.vol --mask circular -%d &quot;</span>%(fnRoot,self.Xdim2/2))</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            print(fnRoot+<span class="stringliteral">&quot;.xmd is empty. The corresponding volume is not generated.&quot;</span>)</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="a497cd6ba21a48bf4461bb7649590f024"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a497cd6ba21a48bf4461bb7649590f024">&#9670;&nbsp;</a></span>resizeStep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_ransac.XmippProtRansac.resizeStep </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnRoot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>Xdim</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00305">305</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keyword">def </span>resizeStep(self,fnRoot,Xdim):</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordflow">if</span> os.path.exists(fnRoot+<span class="stringliteral">&quot;.vol&quot;</span>):</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_resize&quot;</span>,<span class="stringliteral">&quot;-i %s.vol -o %s.vol --dim %d %d&quot;</span> %(fnRoot,fnRoot,Xdim,Xdim))</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_convert&quot;</span>,<span class="stringliteral">&quot;-i %s.vol -o %s.mrc -t vol&quot;</span> %(fnRoot,fnRoot))</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            cleanPath(<span class="stringliteral">&quot;%s.vol&quot;</span>%fnRoot)</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_header&quot;</span>, <span class="stringliteral">&quot;-i %s.mrc --sampling_rate %f&quot;</span> %\</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                        (fnRoot, self.inputSet.get().getSamplingRate()))</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;     </div></div><!-- fragment -->
</div>
</div>
<a id="a31dd5dc75e630f0de66cc816914f2c2c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31dd5dc75e630f0de66cc816914f2c2c">&#9670;&nbsp;</a></span>scoreFinalVolumes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_ransac.XmippProtRansac.scoreFinalVolumes </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00417">417</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keyword">def </span>scoreFinalVolumes(self):</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        threshold=self.getCCThreshold()</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        mdOut=emlib.MetaData()</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">for</span> n <span class="keywordflow">in</span> <a class="code" href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">range</a>(self.numVolumes.get()):</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            fnRoot=self._getPath(<span class="stringliteral">&#39;proposedVolume%05d&#39;</span>%n)</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            fnAssignment=fnRoot+<span class="stringliteral">&quot;.xmd&quot;</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keywordflow">if</span> os.path.exists(fnAssignment):</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --fill weight constant 1&quot;</span>%fnAssignment)</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                MDassignment=emlib.MetaData(fnAssignment)</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                sum=0</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                thresholdedSum=0</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                N=0</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                minCC=2</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                <span class="keywordflow">for</span> id <span class="keywordflow">in</span> MDassignment:</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                    cc=MDassignment.getValue(emlib.MDL_MAXCC,id)</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                    sum+=cc</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                    thresholdedSum+=cc-threshold</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                    <span class="keywordflow">if</span> cc&lt;minCC:</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                        minCC=cc</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                    N+=1</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                <span class="keywordflow">if</span> N&gt;0:</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                    avg=sum/N</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                    avg=0.0</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                id=mdOut.addObject()</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                mdOut.setValue(emlib.MDL_IMAGE,fnRoot+<span class="stringliteral">&quot;.mrc&quot;</span>,id)</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                mdOut.setValue(emlib.MDL_VOLUME_SCORE_SUM,float(sum),id)</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                mdOut.setValue(emlib.MDL_VOLUME_SCORE_SUM_TH,float(thresholdedSum),id)</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                mdOut.setValue(emlib.MDL_VOLUME_SCORE_MEAN,float(avg),id)</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                mdOut.setValue(emlib.MDL_VOLUME_SCORE_MIN,float(minCC),id)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        mdOut.write(self._getPath(<span class="stringliteral">&quot;proposedVolumes.xmd&quot;</span>))</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="ttc" id="namespacelibsvm_1_1svm_html_a94988a86d7dfc39cb8e193731dbf6c94"><div class="ttname"><a href="namespacelibsvm_1_1svm.html#a94988a86d7dfc39cb8e193731dbf6c94">libsvm.svm.range</a></div><div class="ttdeci">range</div><div class="ttdef"><b>Definition:</b> <a href="svm_8py_source.html#l00017">svm.py:17</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a87e4f02816f4c7dd900450fee29bcdde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87e4f02816f4c7dd900450fee29bcdde">&#9670;&nbsp;</a></span>imgsFn</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmipp3.protocols.protocol_ransac.XmippProtRansac.imgsFn</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00175">175</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>

</div>
</div>
<a id="afa0120bf683c95c121ba488290e343dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa0120bf683c95c121ba488290e343dd">&#9670;&nbsp;</a></span>stepsExecutionMode</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmipp3.protocols.protocol_ransac.XmippProtRansac.stepsExecutionMode</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00063">63</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>

</div>
</div>
<a id="a89af80506ea44e6227a63dd621488e27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89af80506ea44e6227a63dd621488e27">&#9670;&nbsp;</a></span>Xdim</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmipp3.protocols.protocol_ransac.XmippProtRansac.Xdim</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00179">179</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>

</div>
</div>
<a id="a3cc22dc97c2150fcb274fbab18916c9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cc22dc97c2150fcb274fbab18916c9b">&#9670;&nbsp;</a></span>Xdim2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmipp3.protocols.protocol_ransac.XmippProtRansac.Xdim2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__ransac_8py_source.html#l00190">190</a> of file <a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>scipion-em-xmipp/xmipp3/protocols/<a class="el" href="protocol__ransac_8py_source.html">protocol_ransac.py</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
