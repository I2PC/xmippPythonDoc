<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Xmipp: xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xmipp_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xmipp
   &#160;<span id="projectnumber">v20.07</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacexmipp3.html">xmipp3</a></li><li class="navelem"><a class="el" href="namespacexmipp3_1_1protocols.html">protocols</a></li><li class="navelem"><a class="el" href="namespacexmipp3_1_1protocols_1_1protocol__reconstruct__highres.html">protocol_reconstruct_highres</a></li><li class="navelem"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html">XmippProtReconstructHighRes</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes:</div>
<div class="dyncontent">
<div class="center"><img src="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes__inherit__graph.png" border="0" usemap="#xmipp3_8protocols_8protocol__reconstruct__highres_8XmippProtReconstructHighRes_inherit__map" alt="Inheritance graph"/></div>
<map name="xmipp3_8protocols_8protocol__reconstruct__highres_8XmippProtReconstructHighRes_inherit__map" id="xmipp3_8protocols_8protocol__reconstruct__highres_8XmippProtReconstructHighRes_inherit__map">
<area shape="rect" id="node3" href="classxmipp3_1_1base_1_1HelicalFinder.html" title="xmipp3.base.HelicalFinder" alt="" coords="131,5,307,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes:</div>
<div class="dyncontent">
<div class="center"><img src="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes__coll__graph.png" border="0" usemap="#xmipp3_8protocols_8protocol__reconstruct__highres_8XmippProtReconstructHighRes_coll__map" alt="Collaboration graph"/></div>
<map name="xmipp3_8protocols_8protocol__reconstruct__highres_8XmippProtReconstructHighRes_coll__map" id="xmipp3_8protocols_8protocol__reconstruct__highres_8XmippProtReconstructHighRes_coll__map">
<area shape="rect" id="node3" href="classxmipp3_1_1base_1_1HelicalFinder.html" title="xmipp3.base.HelicalFinder" alt="" coords="131,5,307,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a67beb4d2b7799cd365a66c56190cad77"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a67beb4d2b7799cd365a66c56190cad77">insertIteration</a> (self, iteration)</td></tr>
<tr class="separator:a67beb4d2b7799cd365a66c56190cad77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29c4555956818cd2f8e083b6b04646de"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a29c4555956818cd2f8e083b6b04646de">convertInputStep</a> (self, inputParticlesId)</td></tr>
<tr class="separator:a29c4555956818cd2f8e083b6b04646de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a983b80060666d2a0f9a5107c6e252e25"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a983b80060666d2a0f9a5107c6e252e25">createOutput</a> (self)</td></tr>
<tr class="separator:a983b80060666d2a0f9a5107c6e252e25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02a1382bea61e4d55d4606a488d03c03"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a02a1382bea61e4d55d4606a488d03c03">getLastFinishedIter</a> (self)</td></tr>
<tr class="separator:a02a1382bea61e4d55d4606a488d03c03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86d3b153a6935091c3f485f9b1abaa06"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a86d3b153a6935091c3f485f9b1abaa06">getNumberOfPreviousIterations</a> (self)</td></tr>
<tr class="separator:a86d3b153a6935091c3f485f9b1abaa06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b4be49ef7001d5287d46181348818e8"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a9b4be49ef7001d5287d46181348818e8">copyBasicInformation</a> (self)</td></tr>
<tr class="separator:a9b4be49ef7001d5287d46181348818e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b435e2dccaaf06535d34f9200ffb59a"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a8b435e2dccaaf06535d34f9200ffb59a">doWeightSSNR</a> (self)</td></tr>
<tr class="separator:a8b435e2dccaaf06535d34f9200ffb59a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7adfeb394ac24fad2c88bea16af8e621"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a7adfeb394ac24fad2c88bea16af8e621">doIteration000</a> (self)</td></tr>
<tr class="separator:a7adfeb394ac24fad2c88bea16af8e621"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa26ad937115341dd5946cdb78fc7a445"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#aa26ad937115341dd5946cdb78fc7a445">evaluateReconstructions</a> (self, iteration)</td></tr>
<tr class="separator:aa26ad937115341dd5946cdb78fc7a445"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31ec67976105c69e2b7732c5f338d284"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a31ec67976105c69e2b7732c5f338d284">checkInfoField</a> (self, fnDir, block)</td></tr>
<tr class="separator:a31ec67976105c69e2b7732c5f338d284"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad07597bd2ae6826d9cdaf54ed60c3324"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#ad07597bd2ae6826d9cdaf54ed60c3324">readInfoField</a> (self, fnDir, block, label)</td></tr>
<tr class="separator:ad07597bd2ae6826d9cdaf54ed60c3324"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00a9740007e704765790d38a48fc102f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a00a9740007e704765790d38a48fc102f">writeInfoField</a> (self, fnDir, block, label, value)</td></tr>
<tr class="separator:a00a9740007e704765790d38a48fc102f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40a8e3f950efeb85bcbb7e18dd456575"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a40a8e3f950efeb85bcbb7e18dd456575">prepareImages</a> (self, fnDirPrevious, fnDir, TsCurrent, getShiftsFrom='')</td></tr>
<tr class="separator:a40a8e3f950efeb85bcbb7e18dd456575"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a723e7ae402d5a485a48e84bb3e534bee"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a723e7ae402d5a485a48e84bb3e534bee">prepareReferences</a> (self, fnDirPrevious, fnDir, TsCurrent, targetResolution)</td></tr>
<tr class="separator:a723e7ae402d5a485a48e84bb3e534bee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa41ee1b597d9b512f33dab65808b120e"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#aa41ee1b597d9b512f33dab65808b120e">prepareMask</a> (self, maskObject, fnMask, TsMaskOut, XdimOut)</td></tr>
<tr class="separator:aa41ee1b597d9b512f33dab65808b120e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac828e0751085274fefb15b8c4ce42214"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#ac828e0751085274fefb15b8c4ce42214">calculateAngStep</a> (self, newXdim, TsCurrent, ResolutionAlignment)</td></tr>
<tr class="separator:ac828e0751085274fefb15b8c4ce42214"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf3f2ef7f51778b86fb96b8a875b2310"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#acf3f2ef7f51778b86fb96b8a875b2310">globalAssignment</a> (self, iteration)</td></tr>
<tr class="separator:acf3f2ef7f51778b86fb96b8a875b2310"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac187c14d4e56b8932e43db24ad802049"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#ac187c14d4e56b8932e43db24ad802049">adaptShifts</a> (self, fnSource, TsSource, fnDest, TsDest)</td></tr>
<tr class="separator:ac187c14d4e56b8932e43db24ad802049"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29433fa234f6f62a6102ee3b22ac9244"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a29433fa234f6f62a6102ee3b22ac9244">localAssignment</a> (self, iteration)</td></tr>
<tr class="separator:a29433fa234f6f62a6102ee3b22ac9244"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95eddf31e91cc59fe487ae8cea65895b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a95eddf31e91cc59fe487ae8cea65895b">noAssignment</a> (self, iteration)</td></tr>
<tr class="separator:a95eddf31e91cc59fe487ae8cea65895b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ec7986fe34102a12f16d9bbc52a1b8e"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a6ec7986fe34102a12f16d9bbc52a1b8e">weightParticles</a> (self, iteration)</td></tr>
<tr class="separator:a6ec7986fe34102a12f16d9bbc52a1b8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a792b05452947153262c67e78e3921fb5"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a792b05452947153262c67e78e3921fb5">qualifyParticles</a> (self, iteration)</td></tr>
<tr class="separator:a792b05452947153262c67e78e3921fb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c1c65d906e8b33241b336d0ffe13b8e"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a6c1c65d906e8b33241b336d0ffe13b8e">reconstruct</a> (self, iteration)</td></tr>
<tr class="separator:a6c1c65d906e8b33241b336d0ffe13b8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b9ec411c348e6a9f49c78addb67de97"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a8b9ec411c348e6a9f49c78addb67de97">postProcessing</a> (self, iteration)</td></tr>
<tr class="separator:a8b9ec411c348e6a9f49c78addb67de97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a294af8c18a9004175a798a4b897a033f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a294af8c18a9004175a798a4b897a033f">cleanDirectory</a> (self, iteration)</td></tr>
<tr class="separator:a294af8c18a9004175a798a4b897a033f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classxmipp3_1_1base_1_1HelicalFinder"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classxmipp3_1_1base_1_1HelicalFinder')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classxmipp3_1_1base_1_1HelicalFinder.html">xmipp3.base.HelicalFinder</a></td></tr>
<tr class="memitem:aad85b9918a0876d7e7b9d7f68071a616 inherit pub_methods_classxmipp3_1_1base_1_1HelicalFinder"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1base_1_1HelicalFinder.html#aad85b9918a0876d7e7b9d7f68071a616">getSymmetry</a> (self, dihedral)</td></tr>
<tr class="separator:aad85b9918a0876d7e7b9d7f68071a616 inherit pub_methods_classxmipp3_1_1base_1_1HelicalFinder"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea671759f5d7ce0fa91682dd01588d88 inherit pub_methods_classxmipp3_1_1base_1_1HelicalFinder"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1base_1_1HelicalFinder.html#aea671759f5d7ce0fa91682dd01588d88">runCoarseSearch</a> (self, fnVol, dihedral, heightFraction, z0, zF, zStep, rot0, rotF, rotStep, Nthr, fnOut, cylinderInnerRadius, cylinderOuterRadius, height, Ts)</td></tr>
<tr class="separator:aea671759f5d7ce0fa91682dd01588d88 inherit pub_methods_classxmipp3_1_1base_1_1HelicalFinder"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9021af8b7dff48f012cf9c0cdc03e55 inherit pub_methods_classxmipp3_1_1base_1_1HelicalFinder"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1base_1_1HelicalFinder.html#af9021af8b7dff48f012cf9c0cdc03e55">runFineSearch</a> (self, fnVol, dihedral, fnCoarse, fnFine, heightFraction, z0, zF, rot0, rotF, cylinderInnerRadius, cylinderOuterRadius, height, Ts)</td></tr>
<tr class="separator:af9021af8b7dff48f012cf9c0cdc03e55 inherit pub_methods_classxmipp3_1_1base_1_1HelicalFinder"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2927f2e15ca89c93f803d0d792b606af inherit pub_methods_classxmipp3_1_1base_1_1HelicalFinder"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1base_1_1HelicalFinder.html#a2927f2e15ca89c93f803d0d792b606af">runSymmetrize</a> (self, fnVol, dihedral, fnParams, fnOut, heightFraction, cylinderInnerRadius, cylinderOuterRadius, height, Ts)</td></tr>
<tr class="separator:a2927f2e15ca89c93f803d0d792b606af inherit pub_methods_classxmipp3_1_1base_1_1HelicalFinder"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a54b7c25034ccaa1340f9654159e2bdb7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a54b7c25034ccaa1340f9654159e2bdb7">imgsFn</a></td></tr>
<tr class="separator:a54b7c25034ccaa1340f9654159e2bdb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83b9162cecd316fe7c2342e96ca92e44"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a83b9162cecd316fe7c2342e96ca92e44">firstIteration</a></td></tr>
<tr class="separator:a83b9162cecd316fe7c2342e96ca92e44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7417eeb425ff364bdce78108e946fd2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#aa7417eeb425ff364bdce78108e946fd2">TsOrig</a></td></tr>
<tr class="separator:aa7417eeb425ff364bdce78108e946fd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c008532bdb15df503d3834441574b70"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a2c008532bdb15df503d3834441574b70">alignmentMethod</a></td></tr>
<tr class="separator:a2c008532bdb15df503d3834441574b70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a548d226258b3778f423562744d78583a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a548d226258b3778f423562744d78583a">scaleFactor</a></td></tr>
<tr class="separator:a548d226258b3778f423562744d78583a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5e606b7e097ab58549c8ea3f99708b7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#ab5e606b7e097ab58549c8ea3f99708b7">iterMd</a></td></tr>
<tr class="separator:ab5e606b7e097ab58549c8ea3f99708b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e6b5ec26b9f7f0821a8b53bb669c6e2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a8e6b5ec26b9f7f0821a8b53bb669c6e2">lastRow</a></td></tr>
<tr class="separator:a8e6b5ec26b9f7f0821a8b53bb669c6e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af34bfdd78ad64beaa6a328055b575172"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#af34bfdd78ad64beaa6a328055b575172">splitMethod</a></td></tr>
<tr class="separator:af34bfdd78ad64beaa6a328055b575172"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a66d19810215d3e851699c9edd4843f03"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a66d19810215d3e851699c9edd4843f03">SPLIT_STOCHASTIC</a> = 0</td></tr>
<tr class="separator:a66d19810215d3e851699c9edd4843f03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a806a5a1a4376247a6a2f9fb2b3ca7cb0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a806a5a1a4376247a6a2f9fb2b3ca7cb0">SPLIT_FIXED</a> = 1</td></tr>
<tr class="separator:a806a5a1a4376247a6a2f9fb2b3ca7cb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30f95d463646ccc26173960bddd20005"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a30f95d463646ccc26173960bddd20005">GLOBAL_ALIGNMENT</a> = 0</td></tr>
<tr class="separator:a30f95d463646ccc26173960bddd20005"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b6e454fc05c49e57c37181cbc8a4e27"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a4b6e454fc05c49e57c37181cbc8a4e27">LOCAL_ALIGNMENT</a> = 1</td></tr>
<tr class="separator:a4b6e454fc05c49e57c37181cbc8a4e27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c7e79ca2eb11a98daeb6448072475cc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a7c7e79ca2eb11a98daeb6448072475cc">AUTOMATIC_ALIGNMENT</a> = 2</td></tr>
<tr class="separator:a7c7e79ca2eb11a98daeb6448072475cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4711b9d900e4a36de2710cfe29ec4e1c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a4711b9d900e4a36de2710cfe29ec4e1c">STOCHASTIC_ALIGNMENT</a> = 3</td></tr>
<tr class="separator:a4711b9d900e4a36de2710cfe29ec4e1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a994a5c11dbbf000cf3c93d9d5525593a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classxmipp3_1_1protocols_1_1protocol__reconstruct__highres_1_1XmippProtReconstructHighRes.html#a994a5c11dbbf000cf3c93d9d5525593a">NO_ALIGNMENT</a> = 4</td></tr>
<tr class="separator:a994a5c11dbbf000cf3c93d9d5525593a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">This is a 3D refinement protocol whose main input is a volume and a set of particles.
   The set of particles has to be at full size (the finer sampling rate available), but
   the rest of inputs (reference volume and masks) can be at any downsampling factor.
   The protocol scales the input images and volumes to a reasonable size depending on
   the resolution of the previous iteration.
   
   The protocol works with any input volume, whichever its resolution, as long as it
   is a reasonable initial volume for the set of particles. The protocol does not
   resolve the heterogeneous problem (it assumes an homogeneous population),
   although it is somewhat tolerant through the use of particle weights in the
   reconstruction process.
   
   It is recommended to perform several global alignment iterations before entering
   into the local iterations. The switch from global to local should be performed when
   a substantial percentage of the particles do not move from one iteration to the next.
   
   The algorithm reports the cross correlation (global alignment) or cost (local) function
   per defocus group, so that we can see which was the percentile of each particle in its
   defocus group. You may want to perform iterations one by one, and remove from one
   iteration to the next, those particles that worse fit the model.</pre> 
<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00064">64</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="ac187c14d4e56b8932e43db24ad802049"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac187c14d4e56b8932e43db24ad802049">&#9670;&nbsp;</a></span>adaptShifts()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.adaptShifts </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnSource</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>TsSource</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnDest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>TsDest</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00992">992</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keyword">def </span>adaptShifts(self, fnSource, TsSource, fnDest, TsDest):</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        K=TsSource/TsDest</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        copyFile(fnSource,fnDest)</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        row=getFirstRow(fnDest)</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="keywordflow">if</span> row.containsLabel(emlib.MDL_SHIFT_X):</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --operate modify_values &quot;shiftX=%f*shiftX&quot;&#39;</span>%(fnDest,K),numberOfMpi=1)</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --operate modify_values &quot;shiftY=%f*shiftY&quot;&#39;</span>%(fnDest,K),numberOfMpi=1)</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        <span class="keywordflow">if</span> row.containsLabel(emlib.MDL_CONTINUOUS_X):</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --operate modify_values &quot;continuousX=%f*continuousX&quot;&#39;</span>%(fnDest,K),numberOfMpi=1)</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --operate modify_values &quot;continuousY=%f*continuousY&quot;&#39;</span>%(fnDest,K),numberOfMpi=1)</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="ac828e0751085274fefb15b8c4ce42214"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac828e0751085274fefb15b8c4ce42214">&#9670;&nbsp;</a></span>calculateAngStep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.calculateAngStep </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>newXdim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>TsCurrent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ResolutionAlignment</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00803">803</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="keyword">def </span>calculateAngStep(self,newXdim,TsCurrent,ResolutionAlignment):</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        k=newXdim*TsCurrent/ResolutionAlignment <span class="comment"># Freq. index</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keywordflow">return</span> math.atan2(1,k)*180.0/math.pi <span class="comment"># Corresponding angular step</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a31ec67976105c69e2b7732c5f338d284"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31ec67976105c69e2b7732c5f338d284">&#9670;&nbsp;</a></span>checkInfoField()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.checkInfoField </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnDir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00653">653</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keyword">def </span>checkInfoField(self,fnDir,block):</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        fnInfo = join(fnDir,<span class="stringliteral">&quot;iterInfo.xmd&quot;</span>)</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnInfo):</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        blocks = emlib.getBlocksInMetaDataFile(fnInfo)</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keywordflow">return</span> block <span class="keywordflow">in</span> blocks</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="ttc" id="namespaceAutoConfig_html_a4db5974500e14fc05a286bdbfd7701b0"><div class="ttname"><a href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">AutoConfig.exists</a></div><div class="ttdeci">def exists(env)</div><div class="ttdef"><b>Definition:</b> <a href="install_2scons-tools_2AutoConfig_8py_source.html#l00088">AutoConfig.py:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a294af8c18a9004175a798a4b897a033f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a294af8c18a9004175a798a4b897a033f">&#9670;&nbsp;</a></span>cleanDirectory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.cleanDirectory </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l01613">1613</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <span class="keyword">def </span>cleanDirectory(self, iteration):</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;        fnDirCurrent=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%iteration)</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <span class="keywordflow">if</span> self.saveSpace:</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;            fnGlobal=join(fnDirCurrent,<span class="stringliteral">&quot;globalAssignment&quot;</span>)</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;            fnLocal=join(fnDirCurrent,<span class="stringliteral">&quot;localAssignment&quot;</span>)</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;            <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnGlobal):</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;                cleanPath(join(fnGlobal,<span class="stringliteral">&quot;images.stk&quot;</span>))</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnGlobal):</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                    cleanPath(join(fnGlobal,<span class="stringliteral">&quot;images%02d.xmd&quot;</span>%i))</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                    cleanPath(join(fnGlobal,<span class="stringliteral">&quot;volumeRef%02d.vol&quot;</span>%i))</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnLocal):</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                    cleanPath(join(fnLocal,<span class="stringliteral">&quot;images%02d.xmd&quot;</span>%i))</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                    cleanPath(join(fnLocal,<span class="stringliteral">&quot;images.stk&quot;</span>))</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                    cleanPath(join(fnLocal,<span class="stringliteral">&quot;anglesCont%02d.stk&quot;</span>%i))</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                    cleanPath(join(fnLocal,<span class="stringliteral">&quot;anglesDisc%02d.xmd&quot;</span>%i))</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                    cleanPath(join(fnLocal,<span class="stringliteral">&quot;volumeRef%02d.vol&quot;</span>%i))</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                fnCorrectedImages=join(fnDirCurrent,<span class="stringliteral">&quot;images_corrected%02d.stk&quot;</span>%i)</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnCorrectedImages) <span class="keywordflow">and</span> iteration!=self.firstIteration+self.numberOfIterations.get()-1:</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                    cleanPath(fnCorrectedImages) <span class="comment"># Delete corrected images except for the last iteration</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                    <span class="comment">#if self.weightResiduals:</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;                    <span class="comment">#    cleanPath(join(fnLocal,&quot;covariance%02d.stk&quot;%i))</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                    <span class="comment">#    cleanPath(join(fnLocal,&quot;residuals%02i.stk&quot;%i))</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div><div class="ttc" id="namespaceAutoConfig_html_a4db5974500e14fc05a286bdbfd7701b0"><div class="ttname"><a href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">AutoConfig.exists</a></div><div class="ttdeci">def exists(env)</div><div class="ttdef"><b>Definition:</b> <a href="install_2scons-tools_2AutoConfig_8py_source.html#l00088">AutoConfig.py:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a29c4555956818cd2f8e083b6b04646de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29c4555956818cd2f8e083b6b04646de">&#9670;&nbsp;</a></span>convertInputStep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.convertInputStep </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>inputParticlesId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00326">326</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keyword">def </span>convertInputStep(self, inputParticlesId):</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keywordflow">if</span> self.alignmentMethod==self.NO_ALIGNMENT:</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <a class="code" href="namespacexmipp3_1_1convert_1_1convert.html#a497bb7406003a5e6c285ef27b5242230">writeSetOfParticles</a>(self.inputParticles.get(),self.imgsFn, postprocessImageRow=getPreviousQuality)</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <a class="code" href="namespacexmipp3_1_1convert_1_1convert.html#a497bb7406003a5e6c285ef27b5242230">writeSetOfParticles</a>(self.inputParticles.get(), self.imgsFn)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --fill image1 constant noImage&#39;</span>%self.imgsFn,numberOfMpi=1)</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --operate modify_values &quot;image1=image&quot;&#39;</span>%self.imgsFn,numberOfMpi=1)</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --fill particleId constant 1&#39;</span>%self.imgsFn,numberOfMpi=1)</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --operate modify_values &quot;particleId=itemId&quot;&#39;</span>%self.imgsFn,numberOfMpi=1)</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        imgsFnId=self._getExtraPath(<span class="stringliteral">&#39;imagesId.xmd&#39;</span>)</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --operate keep_column particleId -o %s&#39;</span>%(self.imgsFn,imgsFnId),numberOfMpi=1)</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="ttc" id="namespacexmipp3_1_1convert_1_1convert_html_a497bb7406003a5e6c285ef27b5242230"><div class="ttname"><a href="namespacexmipp3_1_1convert_1_1convert.html#a497bb7406003a5e6c285ef27b5242230">xmipp3.convert.convert.writeSetOfParticles</a></div><div class="ttdeci">def writeSetOfParticles(imgSet, filename, blockName='Particles', kwargs)</div><div class="ttdef"><b>Definition:</b> <a href="convert_8py_source.html#l01095">convert.py:1095</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9b4be49ef7001d5287d46181348818e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b4be49ef7001d5287d46181348818e8">&#9670;&nbsp;</a></span>copyBasicInformation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.copyBasicInformation </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00435">435</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keyword">def </span>copyBasicInformation(self):</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        previousRun=self.continueRun.get()</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.inputParticles.hasValue():</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            copyFile(previousRun._getExtraPath(<span class="stringliteral">&#39;images.xmd&#39;</span>),self._getExtraPath(<span class="stringliteral">&#39;images.xmd&#39;</span>))</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            copyFile(previousRun._getExtraPath(<span class="stringliteral">&#39;imagesId.xmd&#39;</span>),self._getExtraPath(<span class="stringliteral">&#39;imagesId.xmd&#39;</span>))</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordflow">if</span> previousRun.weightSSNR:</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            copyFile(previousRun._getExtraPath(<span class="stringliteral">&#39;ssnrWeights.xmd&#39;</span>),self._getExtraPath(<span class="stringliteral">&#39;ssnrWeights.xmd&#39;</span>))</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordflow">elif</span> self.weightSSNR:</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            self.doWeightSSNR()</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        lastIter=self.getNumberOfPreviousIterations()</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(0,lastIter+1):</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            createLink(previousRun._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%i),join(self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%i)))</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a983b80060666d2a0f9a5107c6e252e25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a983b80060666d2a0f9a5107c6e252e25">&#9670;&nbsp;</a></span>createOutput()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.createOutput </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00338">338</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keyword">def </span>createOutput(self):</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="comment"># get last iteration</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        fnIterDir=glob(self._getExtraPath(<span class="stringliteral">&quot;Iter*&quot;</span>))</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        lastIter=len(fnIterDir)-1</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        fnLastDir=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%lastIter)</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        fnLastVol=join(fnLastDir,<span class="stringliteral">&quot;volumeAvg.mrc&quot;</span>)</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        Ts=self.readInfoField(fnLastDir,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnLastVol):</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            volume=Volume()</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            volume.setFileName(fnLastVol)</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            volume.setSamplingRate(Ts)</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            halfMap1=join(fnLastDir,<span class="stringliteral">&quot;volume01.vol&quot;</span>)</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            halfMap2=join(fnLastDir,<span class="stringliteral">&quot;volume02.vol&quot;</span>)</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            volume.setHalfMaps([halfMap1, halfMap2])</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            self._defineOutputs(outputVolume=volume)</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            self._defineSourceRelation(self.inputParticles.get(),volume)</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.doContinue <span class="keywordflow">and</span> self.inputVolumes.get() <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                self._defineSourceRelation(self.inputVolumes.get(),volume)</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        fnLastAngles=join(fnLastDir,<span class="stringliteral">&quot;angles.xmd&quot;</span>)</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnLastAngles):</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            fnAngles=self._getPath(<span class="stringliteral">&quot;angles.xmd&quot;</span>)</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s -o %s --operate modify_values &quot;image=image1&quot;&#39;</span>%(fnLastAngles,fnAngles),numberOfMpi=1)</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --operate sort particleId&#39;</span>%fnAngles,numberOfMpi=1)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --operate drop_column image1&#39;</span>%fnAngles,numberOfMpi=1)</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --operate modify_values &quot;itemId=particleId&quot;&#39;</span>%fnAngles,numberOfMpi=1)</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            imgSet = self.inputParticles.get()</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            self.scaleFactor=Ts/imgSet.getSamplingRate()</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            imgSetOut = self._createSetOfParticles()</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            imgSetOut.copyInfo(imgSet)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            imgSetOut.setAlignmentProj()</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            imgSetOut.setIsPhaseFlipped( imgSet.isPhaseFlipped() )</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            self.iterMd = md.iterRows(fnAngles, md.MDL_PARTICLE_ID)</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            self.lastRow = next(self.iterMd)</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            imgSetOut.copyItems(imgSet,</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                                updateItemCallback=self._updateItem)</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            self._defineOutputs(outputParticles=imgSetOut)</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            self._defineSourceRelation(self.inputParticles, imgSetOut)</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="ttc" id="namespaceAutoConfig_html_a4db5974500e14fc05a286bdbfd7701b0"><div class="ttname"><a href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">AutoConfig.exists</a></div><div class="ttdeci">def exists(env)</div><div class="ttdef"><b>Definition:</b> <a href="install_2scons-tools_2AutoConfig_8py_source.html#l00088">AutoConfig.py:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7adfeb394ac24fad2c88bea16af8e621"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7adfeb394ac24fad2c88bea16af8e621">&#9670;&nbsp;</a></span>doIteration000()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.doIteration000 </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00458">458</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keyword">def </span>doIteration000(self):</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        fnDirCurrent=self._getExtraPath(<span class="stringliteral">&#39;Iter000&#39;</span>)</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        makePath(fnDirCurrent)</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="comment"># Split data</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="keywordflow">if</span> self.splitMethod == self.SPLIT_FIXED:</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_split&quot;</span>,<span class="stringliteral">&quot;-i %s --oroot %s/images -n 2&quot;</span>%(self.imgsFn,fnDirCurrent),numberOfMpi=1)</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                moveFile(<span class="stringliteral">&quot;%s/images%06d.xmd&quot;</span>%(fnDirCurrent,i),<span class="stringliteral">&quot;%s/images%02d.xmd&quot;</span>%(fnDirCurrent,i))</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="comment"># Get volume sampling rate</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keywordflow">if</span> self.inputVolumes.get() <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            TsCurrent=self.inputParticles.get().getSamplingRate()</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            TsCurrent=self.inputVolumes.get().getSamplingRate()</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        self.writeInfoField(fnDirCurrent,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE,TsCurrent)</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="comment"># Copy reference volumes and window if necessary</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        Xdim=self.inputParticles.get().getDimensions()[0]</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        newXdim=int(round(Xdim*self.TsOrig/TsCurrent))</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        self.writeInfoField(fnDirCurrent,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE,newXdim)</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        </div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        img = ImageHandler()</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">if</span> isinstance(self.inputVolumes.get(),SetOfVolumes):</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            i=1</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            <span class="keywordflow">for</span> vol <span class="keywordflow">in</span> self.inputVolumes.get():</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                fnVol=join(fnDirCurrent,<span class="stringliteral">&quot;volume%02d.vol&quot;</span>%i)</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                img.convert(vol, fnVol)</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                <span class="keywordflow">if</span> newXdim!=vol.getDim()[0]:</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                    self.runJob(<span class="stringliteral">&#39;xmipp_transform_window&#39;</span>,<span class="stringliteral">&quot;-i %s --size %d&quot;</span>%(fnVol,newXdim),numberOfMpi=1)</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                i+=1</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;            fnVol1=join(fnDirCurrent,<span class="stringliteral">&quot;volume%02d.vol&quot;</span>%1)</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            fnVol2=join(fnDirCurrent,<span class="stringliteral">&quot;volume%02d.vol&quot;</span>%2)</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            <span class="keywordflow">if</span> self.inputVolumes.get() <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                args = <span class="stringliteral">&quot;-i %s -o %s --max_resolution 0.3 --sampling %f --sym %s&quot;</span> % (</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                    self.imgsFn, fnVol1, TsCurrent, self.symmetryGroup.get())</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                <span class="keywordflow">if</span> self.useGpu.get():</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                    <span class="comment">#AJ to make it work with and without queue system</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                    <span class="keywordflow">if</span> self.numberOfMpi.get()&gt;1:</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                        N_GPUs = len((self.gpuList.get()).split(<span class="stringliteral">&#39;,&#39;</span>))</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                        args += <span class="stringliteral">&#39; -gpusPerNode %d&#39;</span> % N_GPUs</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                        args += <span class="stringliteral">&#39; -threadsPerGPU %d&#39;</span> % max(self.numberOfThreads.get(),4)</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                    count=0</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                    GpuListCuda=<span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                    <span class="keywordflow">if</span> self.useQueueForSteps() <span class="keywordflow">or</span> self.useQueue():</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                        GpuList = os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>]</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                        GpuList = GpuList.split(<span class="stringliteral">&quot;,&quot;</span>)</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                        <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> GpuList:</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                            GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                            count+=1</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                        GpuListAux = <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                        <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> self.getGpuList():</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                            GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                            GpuListAux = GpuListAux+str(elem)+<span class="stringliteral">&#39;,&#39;</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                            count+=1</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                        os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>] = GpuListAux</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                    <span class="keywordflow">if</span> self.numberOfMpi.get()==1:</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                        args += <span class="stringliteral">&quot; --device %s&quot;</span> %(GpuListCuda)</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                    args += <span class="stringliteral">&#39; --thr %s&#39;</span> % self.numberOfThreads.get()</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                    <span class="keywordflow">if</span> self.numberOfMpi.get()&gt;1:</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                        self.runJob(<span class="stringliteral">&#39;xmipp_cuda_reconstruct_fourier&#39;</span>, args, numberOfMpi=len((self.gpuList.get()).split(<span class="stringliteral">&#39;,&#39;</span>))+1)</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                        self.runJob(<span class="stringliteral">&#39;xmipp_cuda_reconstruct_fourier&#39;</span>, args)</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_reconstruct_fourier_accel&quot;</span>, args,</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                                numberOfMpi=self.numberOfMpi.get())</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                volXdim = Xdim</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                vol=self.inputVolumes.get()</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                img.convert(vol, fnVol1)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                volXdim = vol.getDim()[0]</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            <span class="keywordflow">if</span> newXdim!=volXdim:</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                self.runJob(<span class="stringliteral">&#39;xmipp_transform_window&#39;</span>,<span class="stringliteral">&quot;-i %s --size %d&quot;</span>%(fnVol1,newXdim),numberOfMpi=1)</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <span class="keywordflow">if</span> self.alignmentMethod != self.LOCAL_ALIGNMENT:</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;               maxFreq=0.25</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;               maxFreq=0.45</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_transform_randomize_phases&#39;</span>,<span class="stringliteral">&quot;-i %s -o %s --freq discrete %f&quot;</span>%(fnVol1,fnVol2,maxFreq),numberOfMpi=1)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="comment"># Compare both reconstructions</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        self.evaluateReconstructions(0)</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="comment"># Get the angles and shifts from images into this directory as if this directory</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="comment"># had been the result of a global alignment</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <span class="keywordflow">if</span> self.alignmentMethod.get()==self.LOCAL_ALIGNMENT:</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            copyFile(self.imgsFn,join(fnDirCurrent,<span class="stringliteral">&quot;angles.xmd&quot;</span>))</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a8b435e2dccaaf06535d34f9200ffb59a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b435e2dccaaf06535d34f9200ffb59a">&#9670;&nbsp;</a></span>doWeightSSNR()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.doWeightSSNR </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00449">449</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keyword">def </span>doWeightSSNR(self):</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        R=self.particleRadius.get()</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="keywordflow">if</span> R&lt;=0:</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            R=self.inputParticles.get().getDimensions()[0]/2</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        self.runJob(<span class="stringliteral">&quot;xmipp_image_ssnr&quot;</span>, <span class="stringliteral">&quot;-i %s -R %d --sampling %f --normalizessnr&quot;</span>%\</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                    (self.imgsFn,R,self.inputParticles.get().getSamplingRate()),numberOfMpi=min(self.numberOfMpi.get(),24))</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s -o %s --operate keep_column &quot;particleId weightSSNR&quot; &#39;</span>%\</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                    (self.imgsFn,self._getExtraPath(<span class="stringliteral">&quot;ssnrWeights.xmd&quot;</span>)),numberOfMpi=1)</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="aa26ad937115341dd5946cdb78fc7a445"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa26ad937115341dd5946cdb78fc7a445">&#9670;&nbsp;</a></span>evaluateReconstructions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.evaluateReconstructions </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00549">549</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keyword">def </span>evaluateReconstructions(self,iteration):</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        fnDirCurrent=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%iteration)</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        fnVol1=join(fnDirCurrent,<span class="stringliteral">&quot;volume%02d.vol&quot;</span>%1)</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        fnVol2=join(fnDirCurrent,<span class="stringliteral">&quot;volume%02d.vol&quot;</span>%2)</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        fnVolFSC1=join(fnDirCurrent,<span class="stringliteral">&quot;volumeFSC%02d.vol&quot;</span>%1)</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        fnVolFSC2=join(fnDirCurrent,<span class="stringliteral">&quot;volumeFSC%02d.vol&quot;</span>%2)</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        TsCurrent=self.readInfoField(fnDirCurrent,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        </div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnVolFSC1):</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            copyFile(fnVol1,fnVolFSC1)</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            copyFile(fnVol2,fnVolFSC2)</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="comment"># Apply mask if available</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        fnMask=<span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        volXdim = self.readInfoField(fnDirCurrent, <span class="stringliteral">&quot;size&quot;</span>, emlib.MDL_XSIZE)</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="keywordflow">if</span> self.postAdHocMask.hasValue():</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            fnMask=join(fnDirCurrent,<span class="stringliteral">&quot;mask.vol&quot;</span>)</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnMask):</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                self.prepareMask(self.postAdHocMask.get(), fnMask, TsCurrent, volXdim)</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --mult %s&quot;</span>%(fnVolFSC1,fnMask),numberOfMpi=1)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --mult %s&quot;</span>%(fnVolFSC2,fnMask),numberOfMpi=1)</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="comment"># Threshold</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_transform_threshold&#39;</span>,<span class="stringliteral">&#39;-i %s --select below 0 --substitute value 0 &#39;</span>%fnVolFSC1,numberOfMpi=1)</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_transform_threshold&#39;</span>,<span class="stringliteral">&#39;-i %s --select below 0 --substitute value 0 &#39;</span>%fnVolFSC2,numberOfMpi=1)</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="comment"># Estimate resolution</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        fnFsc=join(fnDirCurrent,<span class="stringliteral">&quot;fsc.xmd&quot;</span>)</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_resolution_fsc&#39;</span>,<span class="stringliteral">&#39;--ref %s -i %s -o %s --sampling_rate %f&#39;</span>\</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                    %(fnVolFSC1,fnVolFSC2,fnFsc,TsCurrent),numberOfMpi=1)</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        cleanPath(fnVolFSC1)</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        cleanPath(fnVolFSC2)</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">if</span> fnMask!=<span class="stringliteral">&quot;&quot;</span>:</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            cleanPath(fnMask)</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="comment"># Estimate resolution before postprocessing</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        fnBeforeVol1=join(fnDirCurrent,<span class="stringliteral">&quot;volumeBeforePostProcessing%02d.vol&quot;</span>%1)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        fnBeforeVol2=join(fnDirCurrent,<span class="stringliteral">&quot;volumeBeforePostProcessing%02d.vol&quot;</span>%2)</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnBeforeVol1) <span class="keywordflow">and</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnBeforeVol2):</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            fnBeforeFsc=join(fnDirCurrent,<span class="stringliteral">&quot;fscBeforePostProcessing.xmd&quot;</span>)</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_resolution_fsc&#39;</span>,<span class="stringliteral">&#39;--ref %s -i %s -o %s --sampling_rate %f&#39;</span>%(fnBeforeVol1,fnBeforeVol2,fnBeforeFsc,TsCurrent),</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                        numberOfMpi=1)</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        mdFSC = emlib.MetaData(fnFsc)</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        resolution=2*TsCurrent</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">for</span> objId <span class="keywordflow">in</span> mdFSC:</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            fsc = mdFSC.getValue(emlib.MDL_RESOLUTION_FRC,objId)</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            <span class="keywordflow">if</span> fsc&lt;self.nextResolutionCriterion.get():</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                resolution=mdFSC.getValue(emlib.MDL_RESOLUTION_FREQREAL,objId)</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                <span class="keywordflow">break</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="keywordflow">if</span> iteration==0:</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="keywordflow">if</span> self.alignmentMethod != self.LOCAL_ALIGNMENT:</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                resolution = TsCurrent * 1/0.25</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                resolution = TsCurrent * 1/0.45</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        self.writeInfoField(fnDirCurrent,<span class="stringliteral">&quot;resolution&quot;</span>,emlib.MDL_RESOLUTION_FREQREAL,resolution)</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="comment"># Produce a filtered volume</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">if</span> iteration&gt;0:</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_transform_filter&#39;</span>,<span class="stringliteral">&#39;-i %s -o %s --fourier low_pass %f --sampling %f&#39;</span>%\</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                        (join(fnDirCurrent,<span class="stringliteral">&quot;volumeAvg.mrc&quot;</span>),join(fnDirCurrent,<span class="stringliteral">&quot;volumeAvgFiltered.mrc&quot;</span>),resolution,TsCurrent),numberOfMpi=1)</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="comment"># A little bit of statistics (accepted and rejected particles, number of directions, ...)</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="keywordflow">if</span> iteration&gt;0:</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                fnAnglesi = join(fnDirCurrent,<span class="stringliteral">&quot;angles%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                mdAngles = emlib.MetaData(fnAnglesi)</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                mdUnique = emlib.MetaData()</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                mdUnique.aggregateMdGroupBy(mdAngles, emlib.AGGR_MAX, [emlib.MDL_PARTICLE_ID], emlib.MDL_WEIGHT, emlib.MDL_WEIGHT)</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                mdUnique.sort(emlib.MDL_PARTICLE_ID)</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                fnAnglesUnique = join(fnDirCurrent,<span class="stringliteral">&quot;imagesUsed%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                mdUnique.write(fnAnglesUnique)</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            fnUsed=join(fnDirCurrent,<span class="stringliteral">&quot;imagesUsed.xmd&quot;</span>)</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            fnUsed1=join(fnDirCurrent,<span class="stringliteral">&quot;imagesUsed01.xmd&quot;</span>)</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            fnUsed2=join(fnDirCurrent,<span class="stringliteral">&quot;imagesUsed02.xmd&quot;</span>)</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&quot;-i %s --set union_all %s -o %s&quot;</span>%(fnUsed1,fnUsed2,fnUsed),numberOfMpi=1)</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            cleanPath(fnUsed1)</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            cleanPath(fnUsed2)</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            fnAngles=join(fnDirCurrent,<span class="stringliteral">&quot;angles.xmd&quot;</span>)</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            fnUsedId=join(fnDirCurrent,<span class="stringliteral">&quot;imagesUsedId.xmd&quot;</span>)</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&quot;-i %s --operate keep_column particleId -o %s&quot;</span>%(fnUsed,fnUsedId),numberOfMpi=1)</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&quot;-i %s --set natural_join %s&quot;</span>%(fnUsedId,fnAngles),numberOfMpi=1)</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            fnImages=self._getExtraPath(<span class="stringliteral">&quot;images.xmd&quot;</span>)</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            fnImagesId=self._getExtraPath(<span class="stringliteral">&#39;imagesId.xmd&#39;</span>)</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            fnImagesRejected=join(fnDirCurrent,<span class="stringliteral">&quot;imagesRejected.xmd&quot;</span>)</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&quot;-i %s --set subtraction %s particleId -o %s&quot;</span>%(fnImagesId,fnUsedId,fnImagesRejected),numberOfMpi=1)</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&quot;-i %s --set natural_join %s&quot;</span>%(fnImagesRejected,fnImages),numberOfMpi=1)</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            cleanPath(fnUsedId)</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            Nimages=getSize(fnImages)</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            Nrepeated=getSize(join(fnDirCurrent,<span class="stringliteral">&quot;angles.xmd&quot;</span>))</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            Nunique=getSize(fnUsed)</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            Nrejected=getSize(fnImagesRejected)</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            fh=open(join(fnDirCurrent,<span class="stringliteral">&quot;statistics.txt&quot;</span>),<span class="stringliteral">&#39;w&#39;</span>)</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            fh.write(<span class="stringliteral">&quot;Number of input    images: %d\n&quot;</span>%Nimages)</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            fh.write(<span class="stringliteral">&quot;Number of used     images: %d\n&quot;</span>%Nunique)</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            fh.write(<span class="stringliteral">&quot;Number of rejected images: %d\n&quot;</span>%Nrejected)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <span class="keywordflow">if</span> Nunique&gt;0:</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                fh.write(<span class="stringliteral">&quot;Average number of directions per used image: %f\n&quot;</span>%(float(Nrepeated)/Nunique))</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            fh.close()</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="ttc" id="namespaceAutoConfig_html_a4db5974500e14fc05a286bdbfd7701b0"><div class="ttname"><a href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">AutoConfig.exists</a></div><div class="ttdeci">def exists(env)</div><div class="ttdef"><b>Definition:</b> <a href="install_2scons-tools_2AutoConfig_8py_source.html#l00088">AutoConfig.py:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a02a1382bea61e4d55d4606a488d03c03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02a1382bea61e4d55d4606a488d03c03">&#9670;&nbsp;</a></span>getLastFinishedIter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.getLastFinishedIter </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00425">425</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keyword">def </span>getLastFinishedIter(self):</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        fnFscs=sorted(glob(self._getExtraPath(<span class="stringliteral">&quot;Iter???/fsc.xmd&quot;</span>)))</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        lastDir=split(fnFscs[-1])[0]</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">return</span> int(lastDir[-3:])</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a86d3b153a6935091c3f485f9b1abaa06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86d3b153a6935091c3f485f9b1abaa06">&#9670;&nbsp;</a></span>getNumberOfPreviousIterations()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.getNumberOfPreviousIterations </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00430">430</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keyword">def </span>getNumberOfPreviousIterations(self):</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        fnDirs=sorted(glob(self.continueRun.get()._getExtraPath(<span class="stringliteral">&quot;Iter???&quot;</span>)))</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        lastDir=fnDirs[-1]</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">return</span> int(lastDir[-3:])</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="acf3f2ef7f51778b86fb96b8a875b2310"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf3f2ef7f51778b86fb96b8a875b2310">&#9670;&nbsp;</a></span>globalAssignment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.globalAssignment </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00807">807</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keyword">def </span>globalAssignment(self,iteration):</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        fnDirPrevious=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%(iteration-1))</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        fnDirCurrent=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%iteration)</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        makePath(fnDirCurrent)</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        previousResolution=self.readInfoField(fnDirPrevious,<span class="stringliteral">&quot;resolution&quot;</span>,emlib.MDL_RESOLUTION_FREQREAL)</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">if</span> self.alignmentMethod==self.GLOBAL_ALIGNMENT <span class="keywordflow">or</span> self.alignmentMethod==self.AUTOMATIC_ALIGNMENT <span class="keywordflow">or</span> \</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;           self.alignmentMethod==self.STOCHASTIC_ALIGNMENT:</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            fnGlobal=join(fnDirCurrent,<span class="stringliteral">&quot;globalAssignment&quot;</span>)</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            makePath(fnGlobal)</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            targetResolution=max(previousResolution*0.5,self._maximumTargetResolution[iteration-1])</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            <span class="keywordflow">if</span> self.multiresolution:</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                TsCurrent=max(self.TsOrig,targetResolution/3)</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                TsCurrent=self.TsOrig</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            getShiftsFrom=<span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            <span class="comment"># if iteration&gt;1: # This causes images to be replicated</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            <span class="comment">#    getShiftsFrom=fnDirPrevious</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            self.prepareImages(fnDirPrevious,fnGlobal,TsCurrent,getShiftsFrom)</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            TsCurrent=self.readInfoField(fnGlobal,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE) <span class="comment"># Prepare images may have changed it</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;            self.prepareReferences(fnDirPrevious,fnGlobal,TsCurrent,targetResolution)</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            <span class="comment"># Calculate angular step at this resolution</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            ResolutionAlignment=previousResolution</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <span class="keywordflow">if</span> self.nextLowPass:</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                ResolutionAlignment+=self.nextResolutionOffset.get()</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            newXdim=self.readInfoField(fnGlobal,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE)</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            angleStep=self.calculateAngStep(newXdim, TsCurrent, ResolutionAlignment)</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            angleStep=max(angleStep,3.0)</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            self.writeInfoField(fnGlobal,<span class="stringliteral">&quot;angleStep&quot;</span>,emlib.MDL_ANGLE_DIFF,float(angleStep))</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            </div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            <span class="comment"># Global alignment</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            perturbationList = [chr(x) <span class="keywordflow">for</span> x <span class="keywordflow">in</span> range(ord(<span class="stringliteral">&#39;a&#39;</span>),ord(<span class="stringliteral">&#39;a&#39;</span>)+self.numberOfPerturbations.get())]</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                fnDirSignificant=join(fnGlobal,<span class="stringliteral">&quot;significant%02d&quot;</span>%i)</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                fnImgs=join(fnGlobal,<span class="stringliteral">&quot;images%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                makePath(fnDirSignificant)</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                <span class="comment"># Create defocus groups</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                row=getFirstRow(fnImgs)</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                <span class="keywordflow">if</span> row.containsLabel(emlib.MDL_CTF_MODEL) <span class="keywordflow">or</span> row.containsLabel(emlib.MDL_CTF_DEFOCUSU):</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_ctf_group&quot;</span>,<span class="stringliteral">&quot;--ctfdat %s -o %s/ctf:stk --pad 1.0 --sampling_rate %f --phase_flipped  --error 0.1 --resol %f&quot;</span>%\</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                                (fnImgs,fnDirSignificant,TsCurrent,targetResolution),numberOfMpi=1)</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                    moveFile(<span class="stringliteral">&quot;%s/ctf_images.sel&quot;</span>%fnDirSignificant,<span class="stringliteral">&quot;%s/ctf_groups.xmd&quot;</span>%fnDirSignificant)</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                    cleanPath(<span class="stringliteral">&quot;%s/ctf_split.doc&quot;</span>%fnDirSignificant)</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                    mdInfo = emlib.MetaData(<span class="stringliteral">&quot;numberGroups@%s&quot;</span>%join(fnDirSignificant,<span class="stringliteral">&quot;ctfInfo.xmd&quot;</span>))</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                    fnCTFs=<span class="stringliteral">&quot;%s/ctf_ctf.stk&quot;</span>%fnDirSignificant</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                    numberGroups=mdInfo.getValue(emlib.MDL_COUNT,mdInfo.firstObject())</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                    ctfPresent=<span class="keyword">True</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                    numberGroups=1</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                    ctfPresent=<span class="keyword">False</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                    fnCTFs=<span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                <span class="comment"># Generate projections</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                fnReferenceVol=join(fnGlobal,<span class="stringliteral">&quot;volumeRef%02d.vol&quot;</span>%i)</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                <span class="keywordflow">for</span> subset <span class="keywordflow">in</span> perturbationList:</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                    fnGallery = join(fnDirSignificant,<span class="stringliteral">&quot;gallery%02d%s.stk&quot;</span> % (i, subset))</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                    fnGalleryMd = join(fnDirSignificant,<span class="stringliteral">&quot;gallery%02d%s.xmd&quot;</span> % (i, subset))</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                    args = <span class="stringliteral">&quot;-i %s -o %s --sampling_rate %f --sym %s --min_tilt_angle %f --max_tilt_angle %f --perturb %f &quot;</span> % \</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                           (fnReferenceVol, fnGallery, angleStep,self.symmetryGroup, self.angularMinTilt.get(),self.angularMaxTilt.get(),math.sin(angleStep * math.pi / 180.0) / 4)</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                    args += <span class="stringliteral">&quot; --compute_neighbors --angular_distance -1 --experimental_images %s&quot;</span> % self._getExtraPath(<span class="stringliteral">&quot;images.xmd&quot;</span>)</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_angular_project_library&quot;</span>, args,numberOfMpi=min(self.numberOfMpi.get(), 24))</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                    cleanPath(join(fnDirSignificant, <span class="stringliteral">&quot;gallery_angles%02d%s.doc&quot;</span> % (i, subset)))</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                    moveFile(join(fnDirSignificant,<span class="stringliteral">&quot;gallery%02d%s.doc&quot;</span> % (i, subset)), fnGalleryMd)</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                    fnAngles = join(fnGlobal, <span class="stringliteral">&quot;anglesDisc%02d%s.xmd&quot;</span> % (i, subset))</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                    <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(1, numberGroups + 1):</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                        fnAnglesGroup = join(fnDirSignificant,<span class="stringliteral">&quot;angles_group%03d%s.xmd&quot;</span> % (j, subset))</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                        <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAnglesGroup):</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                            <span class="keywordflow">if</span> ctfPresent:</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                                fnGroup=<span class="stringliteral">&quot;ctfGroup%06d@%s/ctf_groups.xmd&quot;</span>%(j,fnDirSignificant)</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                                fnCTF =<span class="stringliteral">&quot;%d@%s/ctf_ctf.stk&quot;</span>%(j,fnDirSignificant)</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                                fnGalleryGroup=fnGallery=join(fnDirSignificant,<span class="stringliteral">&quot;gallery%02d%s_%06d.stk&quot;</span>%(i,subset,j))</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                fnGalleryGroupMd=fnGallery=join(fnDirSignificant,<span class="stringliteral">&quot;gallery%02d%s_%06d.xmd&quot;</span>%(i,subset,j))</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                                self.runJob(<span class="stringliteral">&quot;xmipp_transform_filter&quot;</span>,<span class="stringliteral">&quot;-i %s -o %s --fourier binary_file %s --save_metadata_stack %s --keep_input_columns&quot;</span>%\</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                                            (fnGalleryMd,fnGalleryGroup,fnCTF,fnGalleryGroupMd),</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                                            numberOfMpi=min(self.numberOfMpi.get(),24))</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                                fnGroup=fnImgs</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                                fnGalleryGroup=fnGallery</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                                fnGalleryGroupMd=fnGalleryMd</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                            <span class="keywordflow">if</span> getSize(fnGroup)==0: <span class="comment"># If the group is empty</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                                <span class="keywordflow">continue</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                            maxShift = round(self.angularMaxShift.get() * newXdim / 100)</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                            R = self.particleRadius.get()</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                            <span class="keywordflow">if</span> R &lt;= 0:</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                                R = self.inputParticles.get().getDimensions()[0] / 2</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                            R = R * self.TsOrig / TsCurrent</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                            <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.useGpu.get():</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                                args = <span class="stringliteral">&#39;-i %s --initgallery %s --maxShift %d --odir %s --dontReconstruct --useForValidation %d --dontCheckMirrors &#39;</span> % \</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                                       (fnGroup, fnGalleryGroupMd, maxShift,fnDirSignificant,self.numberOfReplicates.get() - 1)</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                                self.runJob(<span class="stringliteral">&#39;xmipp_reconstruct_significant&#39;</span>,args,numberOfMpi=self.numberOfMpi.get())</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                                <span class="comment"># moveFile(join(fnDirSignificant,&quot;images_significant_iter001_00.xmd&quot;),join(fnDirSignificant,&quot;angles_group%03d%s.xmd&quot;%(j,subset)))</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                                fnAnglesSignificant = join(fnDirSignificant,<span class="stringliteral">&quot;angles_iter001_00.xmd&quot;</span>)</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                                <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAnglesSignificant):</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                                    moveFile(fnAnglesSignificant, fnAnglesGroup)</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                                    cleanPath(join(fnDirSignificant,<span class="stringliteral">&quot;images_iter001_00.xmd&quot;</span>))</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                                    <span class="comment"># cleanPath(join(fnDirSignificant,&quot;angles_iter001_00.xmd&quot;))</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                                    cleanPath(join(fnDirSignificant,<span class="stringliteral">&quot;images_significant_iter001_00.xmd&quot;</span>))</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                                count=0</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                                GpuListCuda=<span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                                <span class="keywordflow">if</span> self.useQueueForSteps() <span class="keywordflow">or</span> self.useQueue():</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                                    GpuList = os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>]</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                                    GpuList = GpuList.split(<span class="stringliteral">&quot;,&quot;</span>)</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                                    <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> GpuList:</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                                        GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                                        count+=1</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                                    GpuList = <span class="stringliteral">&#39; &#39;</span>.join([str(elem) <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> self.getGpuList()])</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                                    GpuListAux = <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                                    <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> self.getGpuList():</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                                        GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                                        GpuListAux = GpuListAux+str(elem)+<span class="stringliteral">&#39;,&#39;</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                                        count+=1</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                                    os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>] = GpuListAux</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                                args = <span class="stringliteral">&#39;-i %s -r %s -o %s --keepBestN %f --dev %s &#39;</span> % \</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                                       (fnGroup, fnGalleryGroupMd, fnAnglesGroup,self.numberOfReplicates.get(), GpuListCuda)</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                                self.runJob(<span class="stringliteral">&quot;xmipp_cuda_align_significant&quot;</span>,args, numberOfMpi=1)</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                            <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAnglesGroup):</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                                <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAngles) <span class="keywordflow">and</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAnglesGroup):</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                                    copyFile(fnAnglesGroup, fnAngles)</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                                    <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAngles) <span class="keywordflow">and</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAnglesGroup):</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                                        self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --set union_all %s&quot;</span>%(fnAngles,fnAnglesGroup),numberOfMpi=1)</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                    <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAngles) <span class="keywordflow">and</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnImgs):</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                        self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --set join %s image&quot;</span>%(fnAngles,fnImgs),numberOfMpi=1)</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                    <span class="keywordflow">if</span> self.saveSpace <span class="keywordflow">and</span> ctfPresent:</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                        self.runJob(<span class="stringliteral">&quot;rm -f&quot;</span>,fnDirSignificant+<span class="stringliteral">&quot;/gallery*&quot;</span>,numberOfMpi=1)</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                <span class="comment"># Evaluate the stability of the alignment</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                fnOut=join(fnGlobal,<span class="stringliteral">&quot;anglesDisc%02d&quot;</span>%i)</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                <span class="keywordflow">for</span> subset1 <span class="keywordflow">in</span> perturbationList:</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                    fnOut1=join(fnGlobal,<span class="stringliteral">&quot;anglesDisc%02d%s&quot;</span>%(i,subset1))</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                    fnAngles1=fnOut1+<span class="stringliteral">&quot;.xmd&quot;</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                    counter2 = 0</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                    <span class="keywordflow">for</span> subset2 <span class="keywordflow">in</span> perturbationList:</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                        <span class="keywordflow">if</span> subset1==subset2:</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                            <span class="keywordflow">continue</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                        fnAngles2=join(fnGlobal,<span class="stringliteral">&quot;anglesDisc%02d%s.xmd&quot;</span>%(i,subset2))</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                        fnOut12=join(fnGlobal,<span class="stringliteral">&quot;anglesDisc%02d%s%s&quot;</span>%(i,subset1,subset2))</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                        self.runJob(<span class="stringliteral">&quot;xmipp_angular_distance&quot;</span>,<span class="stringliteral">&quot;--ang1 %s --ang2 %s --oroot %s --sym %s --compute_weights 1 particleId 0.5 --check_mirrors --set 0&quot;</span>%(fnAngles2,fnAngles1,fnOut12,self.symmetryGroup),numberOfMpi=1)</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                        self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --operate keep_column &quot;angleDiff0 shiftDiff0 weightJumper0&quot;&#39;</span>%(fnOut12+<span class="stringliteral">&quot;_weights.xmd&quot;</span>),numberOfMpi=1)</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                        <span class="keywordflow">if</span> counter2 == 0:</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                            mdWeightsAll = emlib.MetaData(fnOut12+<span class="stringliteral">&quot;_weights.xmd&quot;</span>)</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                            counter2=1</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                            mdWeights = emlib.MetaData(fnOut12+<span class="stringliteral">&quot;_weights.xmd&quot;</span>)</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                            <span class="keywordflow">if</span> mdWeights.size()==mdWeightsAll.size():</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                                counter2 += 1</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                                <span class="keywordflow">for</span> id1, id2 <span class="keywordflow">in</span> <a class="code" href="namespacexmipp3_1_1protocols_1_1protocol__reconstruct__highres.html#abe180c29ae02ce781a93b74dbe38034a">izip</a>(mdWeights,mdWeightsAll):</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                                    angleDiff0 = mdWeights.getValue(emlib.MDL_ANGLE_DIFF0, id1)</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                                    shiftDiff0 = mdWeights.getValue(emlib.MDL_SHIFT_DIFF0, id1)</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                                    weightJumper0 = mdWeights.getValue(emlib.MDL_WEIGHT_JUMPER0, id1)</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                                    angleDiff0All = mdWeightsAll.getValue(emlib.MDL_ANGLE_DIFF0, id2)</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                                    shiftDiff0All = mdWeightsAll.getValue(emlib.MDL_SHIFT_DIFF0, id2)</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                                    weightJumper0All = mdWeightsAll.getValue(emlib.MDL_WEIGHT_JUMPER0, id2)</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                                    mdWeightsAll.setValue(emlib.MDL_ANGLE_DIFF0, angleDiff0+angleDiff0All, id2)</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                                    mdWeightsAll.setValue(emlib.MDL_SHIFT_DIFF0, shiftDiff0+shiftDiff0All, id2)</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                                    mdWeightsAll.setValue(emlib.MDL_WEIGHT_JUMPER0, weightJumper0+weightJumper0All, id2)</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                    <span class="keywordflow">if</span> counter2&gt;1:</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                        iCounter2 = 1.0/counter2</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;                        <span class="keywordflow">for</span> id <span class="keywordflow">in</span> mdWeightsAll:</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                            angleDiff0All = mdWeightsAll.getValue(emlib.MDL_ANGLE_DIFF0, id)</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                            shiftDiff0All = mdWeightsAll.getValue(emlib.MDL_SHIFT_DIFF0, id)</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                            weightJumper0All = mdWeightsAll.getValue(emlib.MDL_WEIGHT_JUMPER0, id)</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                            mdWeightsAll.setValue(emlib.MDL_ANGLE_DIFF0, angleDiff0All*iCounter2, id)</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                            mdWeightsAll.setValue(emlib.MDL_SHIFT_DIFF0, shiftDiff0All*iCounter2, id)</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                            mdWeightsAll.setValue(emlib.MDL_WEIGHT_JUMPER0, weightJumper0All*iCounter2, id)</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                    <span class="keywordflow">if</span> counter2&gt;0:</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                        mdWeightsAll.write(fnOut1+<span class="stringliteral">&quot;_weights.xmd&quot;</span>)</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                        self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --set merge %s&#39;</span>%(fnAngles1,fnOut1+<span class="stringliteral">&quot;_weights.xmd&quot;</span>),numberOfMpi=1)</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                    <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnOut+<span class="stringliteral">&quot;.xmd&quot;</span>) <span class="keywordflow">and</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAngles1):</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                        copyFile(fnAngles1,fnOut+<span class="stringliteral">&quot;.xmd&quot;</span>)</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                        <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAngles1) <span class="keywordflow">and</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnOut+<span class="stringliteral">&quot;.xmd&quot;</span>):</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --set union_all %s&#39;</span>%(fnOut+<span class="stringliteral">&quot;.xmd&quot;</span>,fnAngles1),numberOfMpi=1)</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        cleanPath(join(fnGlobal,<span class="stringliteral">&quot;anglesDisc*_weights.xmd&quot;</span>))</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div><div class="ttc" id="namespaceAutoConfig_html_a4db5974500e14fc05a286bdbfd7701b0"><div class="ttname"><a href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">AutoConfig.exists</a></div><div class="ttdeci">def exists(env)</div><div class="ttdef"><b>Definition:</b> <a href="install_2scons-tools_2AutoConfig_8py_source.html#l00088">AutoConfig.py:88</a></div></div>
<div class="ttc" id="namespacexmipp3_1_1protocols_1_1protocol__reconstruct__highres_html_abe180c29ae02ce781a93b74dbe38034a"><div class="ttname"><a href="namespacexmipp3_1_1protocols_1_1protocol__reconstruct__highres.html#abe180c29ae02ce781a93b74dbe38034a">xmipp3.protocols.protocol_reconstruct_highres.izip</a></div><div class="ttdeci">izip</div><div class="ttdef"><b>Definition:</b> <a href="protocol__reconstruct__highres_8py_source.html#l00034">protocol_reconstruct_highres.py:34</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a67beb4d2b7799cd365a66c56190cad77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67beb4d2b7799cd365a66c56190cad77">&#9670;&nbsp;</a></span>insertIteration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.insertIteration </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00309">309</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keyword">def </span>insertIteration(self,iteration):</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keywordflow">if</span> self.alignmentMethod==self.GLOBAL_ALIGNMENT <span class="keywordflow">or</span> \</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;           self.alignmentMethod==self.STOCHASTIC_ALIGNMENT <span class="keywordflow">or</span> \</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;           (self.alignmentMethod==self.AUTOMATIC_ALIGNMENT <span class="keywordflow">and</span> iteration&lt;=3):</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            self._insertFunctionStep(<span class="stringliteral">&#39;globalAssignment&#39;</span>,iteration)</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordflow">elif</span> self.alignmentMethod==self.NO_ALIGNMENT:</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            self._insertFunctionStep(<span class="stringliteral">&#39;noAssignment&#39;</span>, iteration)</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            self._insertFunctionStep(<span class="stringliteral">&#39;localAssignment&#39;</span>,iteration)</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        self._insertFunctionStep(<span class="stringliteral">&#39;weightParticles&#39;</span>,iteration)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        self._insertFunctionStep(<span class="stringliteral">&#39;qualifyParticles&#39;</span>,iteration)</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        self._insertFunctionStep(<span class="stringliteral">&#39;reconstruct&#39;</span>,iteration)</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        self._insertFunctionStep(<span class="stringliteral">&#39;postProcessing&#39;</span>,iteration)</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        self._insertFunctionStep(<span class="stringliteral">&#39;evaluateReconstructions&#39;</span>,iteration)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        self._insertFunctionStep(<span class="stringliteral">&#39;cleanDirectory&#39;</span>,iteration)</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a29433fa234f6f62a6102ee3b22ac9244"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29433fa234f6f62a6102ee3b22ac9244">&#9670;&nbsp;</a></span>localAssignment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.localAssignment </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l01003">1003</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="keyword">def </span>localAssignment(self,iteration):</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        fnDirPrevious=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%(iteration-1))</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="keywordflow">if</span> self.alignmentMethod==self.LOCAL_ALIGNMENT <span class="keywordflow">or</span> \</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;           (self.alignmentMethod==self.AUTOMATIC_ALIGNMENT <span class="keywordflow">and</span> iteration&gt;=4):</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            fnDirCurrent=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%iteration)</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            fnDirLocal=join(fnDirCurrent,<span class="stringliteral">&quot;localAssignment&quot;</span>)</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            makePath(fnDirLocal)</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            previousResolution=self.readInfoField(fnDirPrevious,<span class="stringliteral">&quot;resolution&quot;</span>,emlib.MDL_RESOLUTION_FREQREAL)</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            targetResolution=max(previousResolution*0.8,self._maximumTargetResolution[iteration-1])</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            <span class="keywordflow">if</span> self.multiresolution:</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                TsCurrent=max(self.TsOrig,targetResolution/3)</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                TsCurrent=self.TsOrig</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            self.writeInfoField(fnDirLocal,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE,TsCurrent)</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            TsCurrent=self.readInfoField(fnDirLocal,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE) <span class="comment"># Write and read to guarantee consistency with previous directories</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;            </div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            <span class="comment"># Prepare images and references</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;            produceNewReferences=<span class="keyword">True</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            fnDirGlobal=join(fnDirCurrent,<span class="stringliteral">&quot;globalAssignment&quot;</span>)</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;            <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnDirGlobal):</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                TsGlobal=self.readInfoField(fnDirGlobal,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                <span class="keywordflow">if</span> TsGlobal==TsCurrent:</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                    produceNewReferences=<span class="keyword">False</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;            <span class="keywordflow">if</span> produceNewReferences:</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                self.prepareImages(fnDirPrevious,fnDirLocal,TsCurrent,fnDirPrevious)</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                TsCurrent=self.readInfoField(fnDirLocal,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE) <span class="comment"># Prepare images may have changed it</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                self.prepareReferences(fnDirPrevious,fnDirLocal,TsCurrent,targetResolution)</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                newXdim=self.readInfoField(fnDirGlobal,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE)</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                self.writeInfoField(fnDirLocal,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE,newXdim)</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                    createLink(join(fnDirGlobal,<span class="stringliteral">&quot;images%02d.xmd&quot;</span>%i),join(fnDirLocal,<span class="stringliteral">&quot;images%02d.xmd&quot;</span>%i))</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                    createLink(join(fnDirGlobal,<span class="stringliteral">&quot;volumeRef%02d.vol&quot;</span>%i),join(fnDirLocal,<span class="stringliteral">&quot;volumeRef%02d.vol&quot;</span>%i))</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;            <span class="comment"># Compute maximum angular deviation</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            ResolutionAlignment=previousResolution</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            <span class="keywordflow">if</span> self.nextLowPass:</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                ResolutionAlignment+=self.nextResolutionOffset.get()</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            newXdim=self.readInfoField(fnDirLocal,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE)</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;            maxAngle=3*self.calculateAngStep(newXdim, TsCurrent, ResolutionAlignment)</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                state = self.readInfoField(fnDirLocal, <span class="stringliteral">&quot;count&quot;</span>, emlib.MDL_COUNT)</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                <span class="keywordflow">if</span> state&gt;=2+i:</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                    <span class="keywordflow">continue</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                fnLocalImages=join(fnDirLocal,<span class="stringliteral">&quot;images%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                fnLocalImagesIdx=join(fnDirLocal,<span class="stringliteral">&quot;images%02d_idx.xmd&quot;</span>%i)</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                <span class="comment"># Starting angles</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                fnLocalAssignment=join(fnDirLocal,<span class="stringliteral">&quot;anglesDisc%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnDirGlobal):</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                    fnGlobalAssignment=join(fnDirGlobal,<span class="stringliteral">&quot;anglesDisc%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                    TsGlobal=self.readInfoField(fnDirGlobal,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                    <span class="keywordflow">if</span> TsGlobal==TsCurrent:</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                        copyFile(fnGlobalAssignment,fnLocalAssignment)</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                        self.adaptShifts(fnGlobalAssignment,TsGlobal,fnLocalAssignment,TsCurrent)</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                    TsPrevious=self.readInfoField(fnDirPrevious,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                    fnAux=join(fnDirLocal,<span class="stringliteral">&quot;aux.xmd&quot;</span>)</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --set intersection %s particleId particleId -o %s&quot;</span>%\</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                                (join(fnDirPrevious,<span class="stringliteral">&quot;angles.xmd&quot;</span>),fnLocalImages,fnAux),numberOfMpi=1)</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                    self.adaptShifts(fnAux,TsPrevious,fnLocalAssignment,TsCurrent)</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                    cleanPath(fnAux)</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --operate drop_column image&quot;</span>%fnLocalAssignment,numberOfMpi=1)</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --operate keep_column &quot;particleId image&quot; -o %s&#39;</span>%(fnLocalImages,fnLocalImagesIdx),numberOfMpi=1)</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --operate remove_duplicates particleId&#39;</span>%(fnLocalImagesIdx),numberOfMpi=1)</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --set join %s particleId&quot;</span>%(fnLocalAssignment,fnLocalImagesIdx),numberOfMpi=1)</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                cleanPath(fnLocalImagesIdx)</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                fnVol=join(fnDirLocal,<span class="stringliteral">&quot;volumeRef%02d.vol&quot;</span>%i)</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;                fnLocalStk=join(fnDirLocal,<span class="stringliteral">&quot;anglesCont%02d.stk&quot;</span>%i)</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                R=self.particleRadius.get()</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                <span class="keywordflow">if</span> R&lt;=0:</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;                    R=self.inputParticles.get().getDimensions()[0]/2</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                R=round(R*self.TsOrig/TsCurrent)</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                args=<span class="stringliteral">&quot;-i %s -o %s --sampling %f --Rmax %d --padding %d --ref %s --max_resolution %f --applyTo image1&quot;</span>%\</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                   (fnLocalAssignment,fnLocalStk,TsCurrent,R,self.contPadding.get(),fnVol,previousResolution)</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                <span class="keywordflow">if</span> self.contShift <span class="keywordflow">or</span> self.alignmentMethod.get()==self.AUTOMATIC_ALIGNMENT:</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                    args+=<span class="stringliteral">&quot; --optimizeShift --max_shift %f&quot;</span>%(self.contMaxShiftVariation.get()*newXdim*0.01)</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                <span class="keywordflow">if</span> self.contScale <span class="keywordflow">or</span> (self.alignmentMethod.get()==self.AUTOMATIC_ALIGNMENT <span class="keywordflow">and</span> iteration&gt;=5):</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                    args+=<span class="stringliteral">&quot; --optimizeScale --max_scale %f&quot;</span>%self.contMaxScale.get()</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                <span class="keywordflow">if</span> self.contAngles <span class="keywordflow">or</span> self.alignmentMethod.get()==self.AUTOMATIC_ALIGNMENT:</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                    args+=<span class="stringliteral">&quot; --optimizeAngles --max_angular_change %f&quot;</span>%maxAngle</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                <span class="keywordflow">if</span> self.contDefocus <span class="keywordflow">or</span> (self.alignmentMethod.get()==self.AUTOMATIC_ALIGNMENT <span class="keywordflow">and</span> iteration&gt;=5):</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                    args+=<span class="stringliteral">&quot; --optimizeDefocus --max_defocus_change %f&quot;</span>%self.contMaxDefocus.get()</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                <span class="keywordflow">if</span> self.inputParticles.get().isPhaseFlipped():</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                    args+=<span class="stringliteral">&quot; --phaseFlipped&quot;</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                <span class="comment">#if self.weightResiduals:</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                <span class="comment">#    args+=&quot; --oresiduals %s&quot;%join(fnDirLocal,&quot;residuals%02i.stk&quot;%i)</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_angular_continuous_assign2&quot;</span>,args,numberOfMpi=self.numberOfMpi.get())</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_transform_mask&quot;</span>,<span class="stringliteral">&quot;-i %s --mask circular -%d&quot;</span>%(fnLocalStk,R),numberOfMpi=min(self.numberOfMpi.get(),24))</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                self.writeInfoField(fnDirLocal,<span class="stringliteral">&quot;count&quot;</span>,emlib.MDL_COUNT,int(2+i))</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="ttc" id="namespaceAutoConfig_html_a4db5974500e14fc05a286bdbfd7701b0"><div class="ttname"><a href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">AutoConfig.exists</a></div><div class="ttdeci">def exists(env)</div><div class="ttdef"><b>Definition:</b> <a href="install_2scons-tools_2AutoConfig_8py_source.html#l00088">AutoConfig.py:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a95eddf31e91cc59fe487ae8cea65895b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95eddf31e91cc59fe487ae8cea65895b">&#9670;&nbsp;</a></span>noAssignment()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.noAssignment </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l01099">1099</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="keyword">def </span>noAssignment(self, iteration):</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        fnDirPrevious = self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span> % (iteration - 1))</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        fnDirCurrent = self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span> % iteration)</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        fnDirLocal = join(fnDirCurrent, <span class="stringliteral">&quot;noAssignment&quot;</span>)</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        makePath(fnDirLocal)</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        previousResolution = self.readInfoField(fnDirPrevious, <span class="stringliteral">&quot;resolution&quot;</span>, emlib.MDL_RESOLUTION_FREQREAL)</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        targetResolution = max(previousResolution * 0.8, self._maximumTargetResolution[iteration - 1])</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <span class="keywordflow">if</span> self.multiresolution:</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            TsCurrent = max(self.TsOrig, targetResolution / 3)</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            TsCurrent = self.TsOrig</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        self.writeInfoField(fnDirLocal, <span class="stringliteral">&quot;sampling&quot;</span>, emlib.MDL_SAMPLINGRATE, TsCurrent)</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        TsCurrent = self.readInfoField(fnDirLocal, <span class="stringliteral">&quot;sampling&quot;</span>,</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                                       emlib.MDL_SAMPLINGRATE)  <span class="comment"># Write and read to guarantee consistency with previous directories</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        <span class="comment"># Prepare images and references</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        self.prepareImages(fnDirPrevious, fnDirLocal, TsCurrent)</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1, 3):</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;            fnLocalImages = join(fnDirLocal, <span class="stringliteral">&quot;images%02d.xmd&quot;</span> % i)</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;            fnAssignment = join(fnDirLocal, <span class="stringliteral">&quot;anglesNoAssignment%02d.xmd&quot;</span> % i)</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            TsPrevious = self.readInfoField(fnDirPrevious, <span class="stringliteral">&quot;sampling&quot;</span>, emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            self.adaptShifts(fnLocalImages, TsPrevious, fnAssignment, TsCurrent)</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;            row = md.getFirstRow(fnAssignment)</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> row.hasLabel(md.MDL_MAXCC) <span class="keywordflow">and</span> <span class="keywordflow">not</span> row.hasLabel(md.MDL_COST):</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>, <span class="stringliteral">&quot;-i %s --fill maxCC constant 1&quot;</span>% fnAssignment, numberOfMpi=1)</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a8b9ec411c348e6a9f49c78addb67de97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b9ec411c348e6a9f49c78addb67de97">&#9670;&nbsp;</a></span>postProcessing()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.postProcessing </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l01470">1470</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    <span class="keyword">def </span>postProcessing(self, iteration):</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        fnDirCurrent=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%iteration)</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        TsCurrent=self.readInfoField(fnDirCurrent,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;            fnVol=join(fnDirCurrent,<span class="stringliteral">&quot;volume%02d.vol&quot;</span>%i)</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;            fnBeforeVol=join(fnDirCurrent,<span class="stringliteral">&quot;volumeBeforePostProcessing%02d.vol&quot;</span>%i)</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;            volXdim = self.readInfoField(fnDirCurrent, <span class="stringliteral">&quot;size&quot;</span>, emlib.MDL_XSIZE)</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;            <span class="keywordflow">if</span> self.postSymmetryWithinMask:</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                <span class="keywordflow">if</span> self.postMaskSymmetry!=<span class="stringliteral">&quot;c1&quot;</span>:</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;                    fnMask=join(fnDirCurrent,<span class="stringliteral">&quot;mask.vol&quot;</span>)</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;                    self.prepareMask(self.postSymmetryWithinMaskMask.get(),fnMask,TsCurrent,volXdim)</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_transform_symmetrize&quot;</span>,<span class="stringliteral">&quot;-i %s --sym %s --mask_in %s --dont_wrap&quot;</span>%\</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;                                (fnVol,self.postSymmetryWithinMaskType.get(),fnMask),numberOfMpi=1)</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;                    cleanPath(fnMask)</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;            <span class="keywordflow">if</span> self.postSymmetryHelical:</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;                z0=float(self.postSymmetryHelicalMinZ.get())</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                zF=float(self.postSymmetryHelicalMaxZ.get())</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;                zStep=(zF-z0)/10</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;                rot0=float(self.postSymmetryHelicalMinRot.get())</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;                rotF=float(self.postSymmetryHelicalMaxRot.get())</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;                rotStep=(rotF-rot0)/10</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;                fnCoarse=join(fnDirCurrent,<span class="stringliteral">&quot;coarseHelical%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;                fnFine=join(fnDirCurrent,<span class="stringliteral">&quot;fineHelical%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                radius=int(self.postSymmetryHelicalRadius.get()/TsCurrent)</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;                height=int(volXdim)</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;                self.runCoarseSearch(fnVol, self.postSymmetryHelicalDihedral, 0.9, z0, zF, zStep, rot0, rotF, rotStep, 1, fnCoarse, 0, radius, height, TsCurrent)</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;                self.runFineSearch(fnVol, self.postSymmetryHelicalDihedral, fnCoarse, fnFine, 0.9, z0, zF, rot0, rotF, 0, radius, height, TsCurrent)</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                cleanPath(fnCoarse)</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                self.runSymmetrize(fnVol, self.postSymmetryHelicalDihedral, fnFine, fnVol, 0.9, 0, radius, height, TsCurrent)</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;            <span class="keywordflow">if</span> self.postScript!=<span class="stringliteral">&quot;&quot;</span>:</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                img = ImageHandler()</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                volXdim, _, _, _ =img.getDimensions((1,fnVol))</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;                scriptArgs = {<span class="stringliteral">&#39;volume&#39;</span>: fnVol,</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                              <span class="stringliteral">&#39;sampling&#39;</span>: TsCurrent,</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;                              <span class="stringliteral">&#39;dim&#39;</span>: volXdim,</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;                              <span class="stringliteral">&#39;iterDir&#39;</span>: fnDirCurrent}</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;                cmd = self.postScript % scriptArgs</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                self.runJob(cmd, <span class="stringliteral">&#39;&#39;</span>, numberOfMpi=1)</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        <span class="comment"># Align volumes</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;        fnVol1=join(fnDirCurrent,<span class="stringliteral">&quot;volume%02d.vol&quot;</span>%1)</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        fnVol2=join(fnDirCurrent,<span class="stringliteral">&quot;volume%02d.vol&quot;</span>%2)</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        fnVolAvg=join(fnDirCurrent,<span class="stringliteral">&quot;volumeAvg.mrc&quot;</span>)</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_image_operate&#39;</span>,<span class="stringliteral">&#39;-i %s --plus %s -o %s&#39;</span>%(fnVol1,fnVol2,fnVolAvg),numberOfMpi=1)</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_image_operate&#39;</span>,<span class="stringliteral">&#39;-i %s --mult 0.5&#39;</span>%fnVolAvg,numberOfMpi=1)</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_volume_align&#39;</span>,<span class="stringliteral">&#39;--i1 %s --i2 %s --local --apply&#39;</span>%(fnVolAvg,fnVol1),numberOfMpi=1)</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_volume_align&#39;</span>,<span class="stringliteral">&#39;--i1 %s --i2 %s --local --apply&#39;</span>%(fnVolAvg,fnVol2),numberOfMpi=1)</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        <span class="comment"># Generate mask if available</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        <span class="keywordflow">if</span> self.postAdHocMask.hasValue():</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;            fnMask=join(fnDirCurrent,<span class="stringliteral">&quot;mask.vol&quot;</span>)</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnMask):</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;                volXdim = self.readInfoField(fnDirCurrent, <span class="stringliteral">&quot;size&quot;</span>, emlib.MDL_XSIZE)</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;                self.prepareMask(self.postAdHocMask.get(), fnMask, TsCurrent, volXdim)</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;                self.runJob(<span class="stringliteral">&#39;xmipp_transform_threshold&#39;</span>,<span class="stringliteral">&quot;-i %s --select below 0.5 --substitute binarize&quot;</span>%fnMask,numberOfMpi=1)</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;            fnMask=<span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        <span class="comment"># Remove untrusted background voxels</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        <span class="keywordflow">if</span> self.postSignificantDenoise:</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;            fnRootRestored=join(fnDirCurrent,<span class="stringliteral">&quot;volumeRestored&quot;</span>)</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            args=<span class="stringliteral">&#39;--i1 %s --i2 %s --oroot %s --denoising 1&#39;</span>%(fnVol1,fnVol2,fnRootRestored)</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;            <span class="keywordflow">if</span> fnMask!=<span class="stringliteral">&quot;&quot;</span>:</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;                args+=<span class="stringliteral">&quot; --mask binary_file %s&quot;</span>%fnMask</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_volume_halves_restoration&#39;</span>,args,numberOfMpi=1)</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;            moveFile(<span class="stringliteral">&quot;%s_restored1.vol&quot;</span>%fnRootRestored,fnVol1)</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;            moveFile(<span class="stringliteral">&quot;%s_restored2.vol&quot;</span>%fnRootRestored,fnVol2)</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;        <span class="comment"># Filter bank denoising</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;        <span class="keywordflow">if</span> self.postFilterBank:</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;            fnRootRestored=join(fnDirCurrent,<span class="stringliteral">&quot;volumeRestored&quot;</span>)</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;            args=<span class="stringliteral">&#39;--i1 %s --i2 %s --oroot %s --filterBank 0.01&#39;</span>%(fnVol1,fnVol2,fnRootRestored)</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;            <span class="keywordflow">if</span> fnMask!=<span class="stringliteral">&quot;&quot;</span>:</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;                args+=<span class="stringliteral">&quot; --mask binary_file %s&quot;</span>%fnMask</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_volume_halves_restoration&#39;</span>,args,numberOfMpi=1)</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;            moveFile(<span class="stringliteral">&quot;%s_restored1.vol&quot;</span>%fnRootRestored,fnVol1)</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;            moveFile(<span class="stringliteral">&quot;%s_restored2.vol&quot;</span>%fnRootRestored,fnVol2)</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;            cleanPath(<span class="stringliteral">&quot;%s_filterBank.vol&quot;</span>%fnRootRestored)</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        <span class="comment"># Laplacian Denoising</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        <span class="keywordflow">if</span> self.postLaplacian:</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;            fnRootRestored=join(fnDirCurrent,<span class="stringliteral">&quot;volumeRestored&quot;</span>)</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;            args = <span class="stringliteral">&quot;-i %s --retinex 0.95 &quot;</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;            <span class="keywordflow">if</span> fnMask!=<span class="stringliteral">&quot;&quot;</span>:</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                args+=fnMask</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_transform_filter&#39;</span>,args%fnVol1,numberOfMpi=1)</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_transform_filter&#39;</span>,args%fnVol2,numberOfMpi=1)</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;        <span class="comment"># Blind deconvolution</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;        <span class="keywordflow">if</span> self.postDeconvolve:</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;            fnRootRestored=join(fnDirCurrent,<span class="stringliteral">&quot;volumeRestored&quot;</span>)</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;            args=<span class="stringliteral">&#39;--i1 %s --i2 %s --oroot %s --deconvolution 1&#39;</span>%(fnVol1,fnVol2,fnRootRestored)</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;            <span class="keywordflow">if</span> fnMask!=<span class="stringliteral">&quot;&quot;</span>:</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                args+=<span class="stringliteral">&quot; --mask binary_file %s&quot;</span>%fnMask</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_volume_halves_restoration&#39;</span>,args,numberOfMpi=1)</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;            moveFile(<span class="stringliteral">&quot;%s_restored1.vol&quot;</span>%fnRootRestored,fnVol1)</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;            moveFile(<span class="stringliteral">&quot;%s_restored2.vol&quot;</span>%fnRootRestored,fnVol2)</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_convert&quot;</span>,<span class="stringliteral">&quot;-i %s_convolved.vol -o %s -t vol&quot;</span>%(fnRootRestored,fnVolAvg),numberOfMpi=1)</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;            cleanPath(<span class="stringliteral">&quot;%s_convolved.vol&quot;</span>%fnRootRestored)</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;            cleanPath(<span class="stringliteral">&quot;%s_deconvolved.vol&quot;</span>%fnRootRestored)</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        fnForFSC=join(fnDirCurrent,<span class="stringliteral">&quot;volumeFSC%02d.vol&quot;</span>%i)</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;        copyFile(fnVol,fnForFSC) <span class="comment"># From this point, the two half volumes may be modified</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;        <span class="comment"># Attenuate undershooting</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;        <span class="keywordflow">if</span> self.postSoftNeg:</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;            removeMask=<span class="keyword">False</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;            <span class="keywordflow">if</span> fnMask==<span class="stringliteral">&quot;&quot;</span>:</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                fnMask=join(fnDirCurrent,<span class="stringliteral">&quot;mask.vol&quot;</span>)</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_transform_mask&quot;</span>,<span class="stringliteral">&quot;-i %s --mask circular %d --create_mask %s&quot;</span>%(fnVol1,-volXdim/2,fnMask),numberOfMpi=1)</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;                removeMask=<span class="keyword">True</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;            fnFsc=join(fnDirCurrent,<span class="stringliteral">&quot;fscSoft.xmd&quot;</span>)</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_resolution_fsc&#39;</span>,<span class="stringliteral">&#39;--ref %s -i %s -o %s --sampling_rate %f&#39;</span>%(fnVol1,fnVol2,fnFsc,TsCurrent),numberOfMpi=1)</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_transform_filter&quot;</span>,<span class="stringliteral">&quot;-i %s --softnegative %s %s %f %f&quot;</span>%(fnVol1,fnMask,fnFsc,TsCurrent,self.postSoftNegK),numberOfMpi=1)</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_transform_filter&quot;</span>,<span class="stringliteral">&quot;-i %s --softnegative %s %s %f %f&quot;</span>%(fnVol2,fnMask,fnFsc,TsCurrent,self.postSoftNegK),numberOfMpi=1)</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;            cleanPath(fnFsc)</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;            <span class="keywordflow">if</span> removeMask:</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                cleanPath(fnMask)</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;                fnMask=<span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        <span class="comment"># Difference evaluation and production of a consensus average</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <span class="keywordflow">if</span> self.postDifference:</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;            fnRootRestored=join(fnDirCurrent,<span class="stringliteral">&quot;volumeRestored&quot;</span>)</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;            args=<span class="stringliteral">&#39;--i1 %s --i2 %s --oroot %s --difference 2 2&#39;</span>%(fnVol1,fnVol2,fnRootRestored)</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;            <span class="keywordflow">if</span> fnMask!=<span class="stringliteral">&quot;&quot;</span>:</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;                args+=<span class="stringliteral">&quot; --mask binary_file %s&quot;</span>%fnMask</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_volume_halves_restoration&#39;</span>,args,numberOfMpi=1)</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_convert&quot;</span>,<span class="stringliteral">&quot;-i %s_avgDiff.vol -o %s -t vol&quot;</span>%(fnRootRestored,fnVolAvg),numberOfMpi=1)</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;            cleanPath(<span class="stringliteral">&quot;%s_avgDiff.vol&quot;</span>%fnRootRestored)</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;            cleanPath(<span class="stringliteral">&quot;%s_restored1.vol&quot;</span>%fnRootRestored)</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;            cleanPath(<span class="stringliteral">&quot;%s_restored2.vol&quot;</span>%fnRootRestored)</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;        <span class="comment"># Recalculate the average after alignment and denoising</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnVolAvg):</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_image_operate&#39;</span>,<span class="stringliteral">&#39;-i %s --plus %s -o %s&#39;</span>%(fnVol1,fnVol2,fnVolAvg),numberOfMpi=1)</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_image_operate&#39;</span>,<span class="stringliteral">&#39;-i %s --mult 0.5&#39;</span>%fnVolAvg,numberOfMpi=1)</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment">#         if fnMask!=&quot;&quot;:</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="comment">#             self.runJob(&quot;xmipp_image_operate&quot;,&quot;-i %s --mult %s&quot;%(fnVolAvg,fnMask),numberOfMpi=1)</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_image_header&#39;</span>,<span class="stringliteral">&#39;-i %s --sampling_rate %f&#39;</span>%(fnVolAvg,TsCurrent),numberOfMpi=1)</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;</div><div class="ttc" id="namespaceAutoConfig_html_a4db5974500e14fc05a286bdbfd7701b0"><div class="ttname"><a href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">AutoConfig.exists</a></div><div class="ttdeci">def exists(env)</div><div class="ttdef"><b>Definition:</b> <a href="install_2scons-tools_2AutoConfig_8py_source.html#l00088">AutoConfig.py:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a40a8e3f950efeb85bcbb7e18dd456575"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40a8e3f950efeb85bcbb7e18dd456575">&#9670;&nbsp;</a></span>prepareImages()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.prepareImages </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnDirPrevious</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnDir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>TsCurrent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>getShiftsFrom</em> = <code>''</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00670">670</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keyword">def </span>prepareImages(self,fnDirPrevious,fnDir,TsCurrent,getShiftsFrom=&#39;&#39;):</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="keywordflow">if</span> self.checkInfoField(fnDir,<span class="stringliteral">&quot;count&quot;</span>):</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            state = self.readInfoField(fnDir, <span class="stringliteral">&quot;count&quot;</span>, emlib.MDL_COUNT)</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            <span class="keywordflow">if</span> state&gt;=1:</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                <span class="keywordflow">return</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        </div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        print(<span class="stringliteral">&quot;Preparing images to sampling rate=&quot;</span>,TsCurrent)</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        Xdim=self.inputParticles.get().getDimensions()[0]</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        newXdim=int(round(Xdim*self.TsOrig/TsCurrent))</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="keywordflow">if</span> newXdim&lt;40:</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            newXdim=int(40)</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            TsCurrent=Xdim*(self.TsOrig/newXdim)</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="keywordflow">elif</span> newXdim%2==1:</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            newXdim+=1</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            TsCurrent=Xdim*(self.TsOrig/newXdim)</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        self.writeInfoField(fnDir,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE,TsCurrent)</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        self.writeInfoField(fnDir,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE,newXdim)</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        </div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="comment"># Prepare particles</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        fnDir0=self._getExtraPath(<span class="stringliteral">&quot;Iter000&quot;</span>)</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        fnNewParticles=join(fnDir,<span class="stringliteral">&quot;images.stk&quot;</span>)</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <span class="keywordflow">if</span> newXdim!=Xdim:</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_resize&quot;</span>,<span class="stringliteral">&quot;-i %s -o %s --fourier %d&quot;</span>%(self.imgsFn,fnNewParticles,newXdim),numberOfMpi=min(self.numberOfMpi.get(),24))</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_image_convert&quot;</span>,<span class="stringliteral">&quot;-i %s -o %s --save_metadata_stack %s&quot;</span>%(self.imgsFn,fnNewParticles,join(fnDir,<span class="stringliteral">&quot;images.xmd&quot;</span>)),</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                        numberOfMpi=1)</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        R=self.particleRadius.get()</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordflow">if</span> R&lt;=0:</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            R=self.inputParticles.get().getDimensions()[0]/2</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        R=min(round(R*self.TsOrig/TsCurrent*(1+self.angularMaxShift.get()*0.01)),newXdim/2)</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        self.runJob(<span class="stringliteral">&quot;xmipp_transform_mask&quot;</span>,<span class="stringliteral">&quot;-i %s --mask circular -%d&quot;</span>%(fnNewParticles,R),numberOfMpi=min(self.numberOfMpi.get(),24))</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        fnSource=join(fnDir,<span class="stringliteral">&quot;images.xmd&quot;</span>)</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.inputParticles.get().isPhaseFlipped():</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_ctf_correct_phase&quot;</span>, <span class="stringliteral">&quot;-i %s --sampling_rate %f&quot;</span> % (fnSource, TsCurrent),</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                        numberOfMpi=min(self.numberOfMpi.get(), 24))</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="keywordflow">if</span> self.splitMethod==self.SPLIT_STOCHASTIC:</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --set intersection %s particleId particleId -o %s/all_images.xmd&#39;</span>%\</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                        (fnSource,self._getExtraPath(<span class="stringliteral">&#39;images.xmd&#39;</span>),fnDir),numberOfMpi=1)</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_split&quot;</span>,<span class="stringliteral">&quot;-i %s/all_images.xmd --oroot %s/images -n 2&quot;</span>%(fnDir,fnDir),numberOfMpi=1)</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            cleanPath(<span class="stringliteral">&quot;%s/all_images.xmd&quot;</span>%fnDir)</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                moveFile(<span class="stringliteral">&quot;%s/images%06d.xmd&quot;</span>%(fnDir,i),<span class="stringliteral">&quot;%s/images%02d.xmd&quot;</span>%(fnDir,i))</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                fnImagesi=join(fnDir,<span class="stringliteral">&quot;images%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --set intersection %s/images%02d.xmd particleId particleId -o %s&#39;</span>%\</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                            (fnSource,fnDir0,i,fnImagesi),numberOfMpi=1)</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        cleanPath(fnSource)</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="keywordflow">if</span> self.alignmentMethod==self.STOCHASTIC_ALIGNMENT:</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                fnImagesi=join(fnDir,<span class="stringliteral">&quot;images%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --operate random_subset %d&#39;</span>%\</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                            (fnImagesi,self.NimgsSGD),numberOfMpi=1)</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        </div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <span class="keywordflow">if</span> getShiftsFrom!=<span class="stringliteral">&quot;&quot;</span>:</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            fnPreviousAngles=join(getShiftsFrom,<span class="stringliteral">&quot;angles.xmd&quot;</span>)</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            TsPrevious=self.readInfoField(getShiftsFrom,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            fnAux=join(fnDir,<span class="stringliteral">&quot;aux.xmd&quot;</span>)</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                fnImagesi=join(fnDir,<span class="stringliteral">&quot;images%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --set join %s particleId particleId -o %s&#39;</span>%\</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                            (fnImagesi,fnPreviousAngles,fnAux),numberOfMpi=1)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                self.adaptShifts(fnAux, TsPrevious, fnImagesi, TsCurrent)</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            cleanPath(fnAux)</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        self.writeInfoField(fnDir,<span class="stringliteral">&quot;count&quot;</span>,emlib.MDL_COUNT,int(1))</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="aa41ee1b597d9b512f33dab65808b120e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa41ee1b597d9b512f33dab65808b120e">&#9670;&nbsp;</a></span>prepareMask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.prepareMask </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>maskObject</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnMask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>TsMaskOut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>XdimOut</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00795">795</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keyword">def </span>prepareMask(self,maskObject,fnMask,TsMaskOut,XdimOut):</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        img=ImageHandler()</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        img.convert(maskObject, fnMask)</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_image_resize&#39;</span>,<span class="stringliteral">&quot;-i %s --factor %f&quot;</span>%(fnMask,maskObject.getSamplingRate()/TsMaskOut),numberOfMpi=1)</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        maskXdim, _, _, _ =img.getDimensions((1,fnMask))</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="keywordflow">if</span> XdimOut!=maskXdim:</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_transform_window&#39;</span>,<span class="stringliteral">&quot;-i %s --size %d&quot;</span>%(fnMask,XdimOut),numberOfMpi=1)</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a723e7ae402d5a485a48e84bb3e534bee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a723e7ae402d5a485a48e84bb3e534bee">&#9670;&nbsp;</a></span>prepareReferences()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.prepareReferences </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnDirPrevious</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnDir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>TsCurrent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>targetResolution</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00740">740</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keyword">def </span>prepareReferences(self,fnDirPrevious,fnDir,TsCurrent,targetResolution):</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="keywordflow">if</span> self.checkInfoField(fnDir,<span class="stringliteral">&quot;count&quot;</span>):</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            state = self.readInfoField(fnDir, <span class="stringliteral">&quot;count&quot;</span>, emlib.MDL_COUNT)</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            <span class="keywordflow">if</span> state&gt;=2:</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                <span class="keywordflow">return</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        print(<span class="stringliteral">&quot;Preparing references to sampling rate=&quot;</span>,TsCurrent)</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        fnMask=<span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        newXdim=self.readInfoField(fnDir,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE)</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">if</span> self.nextMask.hasValue():</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            fnMask=join(fnDir,<span class="stringliteral">&quot;mask.vol&quot;</span>)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            self.prepareMask(self.nextMask.get(), fnMask, TsCurrent, newXdim)</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        oldXdim=self.readInfoField(fnDirPrevious,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE)</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            fnPreviousVol=join(fnDirPrevious,<span class="stringliteral">&quot;volume%02d.vol&quot;</span>%i)</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            fnReferenceVol=join(fnDir,<span class="stringliteral">&quot;volumeRef%02d.vol&quot;</span>%i)</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            <span class="keywordflow">if</span> oldXdim!=newXdim:</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_image_resize&quot;</span>,<span class="stringliteral">&quot;-i %s -o %s --dim %d&quot;</span>%(fnPreviousVol,fnReferenceVol,newXdim),numberOfMpi=1)</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                copyFile(fnPreviousVol, fnReferenceVol)</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_transform_filter&#39;</span>,<span class="stringliteral">&#39;-i %s --fourier fsc %s --sampling %f&#39;</span>%(fnReferenceVol,join(fnDirPrevious,<span class="stringliteral">&quot;fsc.xmd&quot;</span>),TsCurrent),numberOfMpi=1)</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            <span class="keywordflow">if</span> self.nextLowPass:</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                self.runJob(<span class="stringliteral">&#39;xmipp_transform_filter&#39;</span>,<span class="stringliteral">&#39;-i %s --fourier low_pass %f --sampling %f&#39;</span>%\</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                            (fnReferenceVol,targetResolution+self.nextResolutionOffset.get(),TsCurrent),numberOfMpi=1)</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            <span class="keywordflow">if</span> self.nextSpherical:</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                <span class="keywordflow">if</span> self.postSymmetryHelical:</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                    R=self.postSymmetryHelicalRadius.get()</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                    <span class="keywordflow">if</span> R&lt;=0:</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                        R=self.inputParticles.get().getDimensions()[0]/2*self.TsOrig</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                    self.runJob(<span class="stringliteral">&#39;xmipp_transform_mask&#39;</span>,<span class="stringliteral">&#39;-i %s --mask cylinder -%d -%d&#39;</span>%\</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                                (fnReferenceVol,round(R/TsCurrent),newXdim),numberOfMpi=1)</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                    R=self.particleRadius.get()</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                    <span class="keywordflow">if</span> R&lt;=0:</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                        R=self.inputParticles.get().getDimensions()[0]/2</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                    self.runJob(<span class="stringliteral">&#39;xmipp_transform_mask&#39;</span>,<span class="stringliteral">&#39;-i %s --mask circular -%d&#39;</span>%\</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                                (fnReferenceVol,round(R*self.TsOrig/TsCurrent)),numberOfMpi=1)</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            <span class="keywordflow">if</span> self.nextPositivity:</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                self.runJob(<span class="stringliteral">&#39;xmipp_transform_threshold&#39;</span>,<span class="stringliteral">&#39;-i %s --select below 0 --substitute value 0&#39;</span>%fnReferenceVol,numberOfMpi=1)</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            <span class="keywordflow">if</span> fnMask!=<span class="stringliteral">&#39;&#39;</span>:</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                self.runJob(<span class="stringliteral">&#39;xmipp_image_operate&#39;</span>,<span class="stringliteral">&#39;-i %s --mult %s&#39;</span>%(fnReferenceVol,fnMask),numberOfMpi=1)</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <span class="keywordflow">if</span> self.nextDropout.get()&gt;0.0:</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                self.runJob(<span class="stringliteral">&#39;xmipp_image_operate&#39;</span>,<span class="stringliteral">&#39;-i %s --dropout %f&#39;</span>%(fnReferenceVol,self.nextDropout),numberOfMpi=1)</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <span class="keywordflow">if</span> self.nextReferenceScript!=<span class="stringliteral">&quot;&quot;</span>:</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                scriptArgs = {<span class="stringliteral">&#39;volume&#39;</span>: fnReferenceVol,</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                              <span class="stringliteral">&#39;sampling&#39;</span>: TsCurrent,</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                              <span class="stringliteral">&#39;dim&#39;</span>: newXdim,</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                              <span class="stringliteral">&#39;iterDir&#39;</span>: fnDir}</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                cmd = self.nextReferenceScript % scriptArgs</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                self.runJob(cmd, <span class="stringliteral">&#39;&#39;</span>, numberOfMpi=1)</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="keywordflow">if</span> fnMask!=<span class="stringliteral">&#39;&#39;</span>:</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            cleanPath(fnMask)</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        self.writeInfoField(fnDir,<span class="stringliteral">&quot;count&quot;</span>,emlib.MDL_COUNT,int(2))</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a792b05452947153262c67e78e3921fb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a792b05452947153262c67e78e3921fb5">&#9670;&nbsp;</a></span>qualifyParticles()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.qualifyParticles </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l01236">1236</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="keyword">def </span>qualifyParticles(self, iteration):</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        fnDirCurrent=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%iteration)</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        fnDirPrevious=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%(iteration-1))</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        fnAngles=join(fnDirCurrent,<span class="stringliteral">&quot;angles.xmd&quot;</span>)</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        fnAnglesQualified=join(fnDirCurrent,<span class="stringliteral">&quot;angles_qualified.xmd&quot;</span>)</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        <span class="comment"># Qualify according to CC and COST by defocus groups</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        row=getFirstRow(fnAngles)</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        <span class="keywordflow">if</span> row.containsLabel(emlib.MDL_CTF_MODEL) <span class="keywordflow">or</span> row.containsLabel(emlib.MDL_CTF_DEFOCUSU):</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;            previousResolution=self.readInfoField(fnDirPrevious,<span class="stringliteral">&quot;resolution&quot;</span>,emlib.MDL_RESOLUTION_FREQREAL)</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;            TsCurrent=self.readInfoField(fnDirCurrent,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;            numberGroups=50</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_ctf_group&quot;</span>,<span class="stringliteral">&quot;--ctfdat %s -o %s/ctf:stk --simple %d&quot;</span>%\</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                        (fnAngles,fnDirCurrent,numberGroups),numberOfMpi=1)</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;            moveFile(<span class="stringliteral">&quot;%s/ctf_images.sel&quot;</span>%fnDirCurrent,<span class="stringliteral">&quot;%s/ctf_groups.xmd&quot;</span>%fnDirCurrent)</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;            ctfPresent=<span class="keyword">True</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;            numberGroups=1</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;            ctfPresent=<span class="keyword">False</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(1,numberGroups+2):</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;            fnAnglesGroup=join(fnDirCurrent,<span class="stringliteral">&quot;angles_group%03d.xmd&quot;</span>%j)</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;            <span class="keywordflow">if</span> ctfPresent:</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                fnGroup=<span class="stringliteral">&quot;ctfGroup%06d@%s/ctf_groups.xmd&quot;</span>%(j,fnDirCurrent)</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                fnGroup=fnAngles</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;            <span class="keywordflow">if</span> getSize(fnGroup)&gt;0:</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                <span class="keywordflow">if</span> row.containsLabel(emlib.MDL_MAXCC):</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --operate percentile maxCC maxCCPerc -o %s&quot;</span>%(fnGroup,fnAnglesGroup),numberOfMpi=1)</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                    fnGroup=fnAnglesGroup</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                <span class="keywordflow">if</span> row.containsLabel(emlib.MDL_COST):</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --operate percentile cost costPerc -o %s&quot;</span>%(fnGroup,fnAnglesGroup),numberOfMpi=1)          </div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAnglesQualified):</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                    copyFile(fnAnglesGroup, fnAnglesQualified)</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --set union %s&quot;</span>%(fnAnglesQualified,fnAnglesGroup),numberOfMpi=1)</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                cleanPath(fnAnglesGroup)</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        <span class="keywordflow">if</span> ctfPresent:</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;            cleanPath(<span class="stringliteral">&quot;%s/ctf_groups.xmd&quot;</span>%fnDirCurrent)</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        moveFile(fnAnglesQualified, fnAngles)</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <span class="keywordflow">if</span> self.weightCC:</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;            mdAngles=emlib.MetaData(fnAngles)</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;            weightCCmin=float(self.weightCCmin.get())</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;            hasCost = mdAngles.containsLabel(md.MDL_COST_PERCENTILE)</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;            hasCC = mdAngles.containsLabel(md.MDL_MAXCC_PERCENTILE)</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;            <span class="keywordflow">for</span> objId <span class="keywordflow">in</span> mdAngles:</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;                <span class="keywordflow">if</span> self.alignmentMethod==self.LOCAL_ALIGNMENT <span class="keywordflow">or</span> \</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                        (self.alignmentMethod==self.NO_ALIGNMENT <span class="keywordflow">and</span> hasCost):</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                    w=mdAngles.getValue(emlib.MDL_COST_PERCENTILE,objId)</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                <span class="keywordflow">elif</span> hasCC:</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                    w=mdAngles.getValue(emlib.MDL_MAXCC_PERCENTILE,objId)</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;                    w=1</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;                weight=mdAngles.getValue(emlib.MDL_WEIGHT,objId)</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                weight*=weightCCmin+w*(1-weightCCmin)</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                mdAngles.setValue(emlib.MDL_WEIGHT,weight,objId)</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;            mdAngles.write(fnAngles)</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <span class="comment"># Qualify according to angular temperature</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        <span class="keywordflow">if</span> iteration==1:</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --fill angleTemp constant 0&quot;</span>%fnAngles,numberOfMpi=1)</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;            fnAngles_1=join(fnDirPrevious,<span class="stringliteral">&quot;angles.xmd&quot;</span>)</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;            fnTemp=join(fnDirCurrent,<span class="stringliteral">&quot;previousAngleTemp.xmd&quot;</span>)</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --operate keep_column &quot;particleId angleTemp&quot; -o %s&#39;</span>%(fnAngles_1,fnTemp),numberOfMpi=1)</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --operate remove_duplicates particleId&#39;</span>%fnTemp,numberOfMpi=1)</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --set join %s particleId&#39;</span>%(fnAngles,fnTemp),numberOfMpi=1)</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            cleanPath(fnTemp)</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;            </div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;        hasDiff0 = row.containsLabel(emlib.MDL_ANGLE_DIFF0)</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        hasDiff1 = row.containsLabel(emlib.MDL_ANGLE_DIFF)</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        hasDiff2 = row.containsLabel(emlib.MDL_ANGLE_DIFF2)</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <span class="keywordflow">if</span> hasDiff0 <span class="keywordflow">or</span> hasDiff1 <span class="keywordflow">or</span> hasDiff2:</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            mdAngles=emlib.MetaData(fnAngles)</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;            K=1.0/3.0</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;            iNorm = 1.0/(hasDiff0 + hasDiff1 + hasDiff2)</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;            <span class="keywordflow">for</span> objId <span class="keywordflow">in</span> mdAngles:</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;                perturbation=0.</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;                <span class="keywordflow">if</span> hasDiff0:</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;                    perturbation+=mdAngles.getValue(emlib.MDL_ANGLE_DIFF0,objId)</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;                <span class="keywordflow">if</span> hasDiff1:</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                    perturbation+=mdAngles.getValue(emlib.MDL_ANGLE_DIFF,objId)</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                <span class="keywordflow">if</span> hasDiff2:</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                    perturbation+=mdAngles.getValue(emlib.MDL_ANGLE_DIFF2,objId)</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                perturbation*=iNorm</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                previousTemp = mdAngles.getValue(emlib.MDL_ANGLE_TEMPERATURE,objId)</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                currentTemp = (1-K)*previousTemp + K*perturbation</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;                mdAngles.setValue(emlib.MDL_ANGLE_TEMPERATURE,currentTemp,objId)</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;            mdAngles.write(fnAngles)</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="ttc" id="namespaceAutoConfig_html_a4db5974500e14fc05a286bdbfd7701b0"><div class="ttname"><a href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">AutoConfig.exists</a></div><div class="ttdeci">def exists(env)</div><div class="ttdef"><b>Definition:</b> <a href="install_2scons-tools_2AutoConfig_8py_source.html#l00088">AutoConfig.py:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad07597bd2ae6826d9cdaf54ed60c3324"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad07597bd2ae6826d9cdaf54ed60c3324">&#9670;&nbsp;</a></span>readInfoField()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.readInfoField </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnDir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>label</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00660">660</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keyword">def </span><a class="code" href="namespacexmipp__base.html#a3d3d7f5fe3571f0d7d059ea085620f8a">readInfoField</a>(self,fnDir,block,label):</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        mdInfo = emlib.MetaData(<span class="stringliteral">&quot;%s@%s&quot;</span>%(block,join(fnDir,<span class="stringliteral">&quot;iterInfo.xmd&quot;</span>)))</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordflow">return</span> mdInfo.getValue(label,mdInfo.firstObject())</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="ttc" id="namespacexmipp__base_html_a3d3d7f5fe3571f0d7d059ea085620f8a"><div class="ttname"><a href="namespacexmipp__base.html#a3d3d7f5fe3571f0d7d059ea085620f8a">xmipp_base.readInfoField</a></div><div class="ttdeci">def readInfoField(fnDir, block, label, xmdFile=&quot;iterInfo.xmd&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__base_8py_source.html#l00527">xmipp_base.py:527</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6c1c65d906e8b33241b336d0ffe13b8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c1c65d906e8b33241b336d0ffe13b8e">&#9670;&nbsp;</a></span>reconstruct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.reconstruct </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l01328">1328</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="keyword">def </span>reconstruct(self, iteration):</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        fnDirCurrent=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%iteration)</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        TsCurrent=self.readInfoField(fnDirCurrent,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        <span class="comment"># Delete previous image files, they exist in case that the last iteration</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <span class="comment"># was performed as a single iteration</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;        fnDirPrevious=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%(iteration-1))</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        fnCorrectedImages1=join(fnDirPrevious,<span class="stringliteral">&quot;images_corrected01.stk&quot;</span>)</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnCorrectedImages1) <span class="keywordflow">and</span> self.saveSpace.get():</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;            cleanPath(fnCorrectedImages1)</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        fnCorrectedImages2=join(fnDirPrevious,<span class="stringliteral">&quot;images_corrected02.stk&quot;</span>)</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnCorrectedImages2) <span class="keywordflow">and</span> self.saveSpace.get():</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;            cleanPath(fnCorrectedImages2)</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;        grayAdjusted=<span class="keyword">False</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;            fnAngles=join(fnDirCurrent,<span class="stringliteral">&quot;angles%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;            fnVol=join(fnDirCurrent,<span class="stringliteral">&quot;volume%02d.vol&quot;</span>%i)</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnVol):</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                <span class="comment"># Correct for the CTF</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                fnAnglesToUse = fnAngles</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                row=getFirstRow(fnAngles)</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                hasCTF = row.containsLabel(emlib.MDL_CTF_DEFOCUSU) <span class="keywordflow">or</span> row.containsLabel(emlib.MDL_CTF_MODEL)</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                fnCorrectedImagesRoot=join(fnDirCurrent,<span class="stringliteral">&quot;images_corrected%02d&quot;</span>%i)</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                deleteStack = <span class="keyword">False</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                <span class="keywordflow">if</span> hasCTF:</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                    args=<span class="stringliteral">&quot;-i %s -o %s.stk --save_metadata_stack %s.xmd --keep_input_columns&quot;</span>%(fnAngles,fnCorrectedImagesRoot,fnCorrectedImagesRoot)</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                    args+=<span class="stringliteral">&quot; --sampling_rate %f --correct_envelope&quot;</span>%TsCurrent</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                    <span class="keywordflow">if</span> self.inputParticles.get().isPhaseFlipped():</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                        args+=<span class="stringliteral">&quot; --phase_flipped&quot;</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_ctf_correct_wiener2d&quot;</span>,args,numberOfMpi=min(self.numberOfMpi.get(),24))</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_image_eliminate_byEnergy&quot;</span>,<span class="stringliteral">&quot;-i %s.xmd --sigma2 9 --minSigma2 0.01&quot;</span>%\</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                                fnCorrectedImagesRoot,numberOfMpi=min(self.numberOfMpi.get(),12))</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                    fnAnglesToUse = fnCorrectedImagesRoot+<span class="stringliteral">&quot;.xmd&quot;</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                    deleteStack = <span class="keyword">True</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;                    deletePattern = fnCorrectedImagesRoot+<span class="stringliteral">&quot;.*&quot;</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                    <span class="keywordflow">if</span> self.alignmentMethod!=self.STOCHASTIC_ALIGNMENT:</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                        self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&#39;-i %s --set intersection %s particleId particleId&#39;</span>%(fnAngles,fnAnglesToUse),numberOfMpi=1) </div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                        <span class="comment"># This is because eliminate_byEnergy may have reduced the number of images in fnAngles</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                </div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                <span class="keywordflow">if</span> (self.contGrayValues <span class="keywordflow">and</span> self.alignmentMethod.get()==self.LOCAL_ALIGNMENT) <span class="keywordflow">or</span> \</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                        (self.alignmentMethod.get()==self.AUTOMATIC_ALIGNMENT <span class="keywordflow">and</span> iteration&gt;=5):</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                    grayAdjusted=<span class="keyword">True</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;                    R=self.particleRadius.get()</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;                    <span class="keywordflow">if</span> R&lt;=0:</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;                        R=self.inputParticles.get().getDimensions()[0]/2</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                    fnGrayRoot = join(fnDirCurrent,<span class="stringliteral">&quot;images_gray%02d&quot;</span>%i)</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;                    fnRefVol=join(fnDirCurrent,<span class="stringliteral">&quot;localAssignment&quot;</span>,<span class="stringliteral">&quot;volumeRef%02d.vol&quot;</span>%i)</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;                    fnDirPrevious=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%(iteration-1))</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;                    previousResolution=self.readInfoField(fnDirPrevious,<span class="stringliteral">&quot;resolution&quot;</span>,emlib.MDL_RESOLUTION_FREQREAL)</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;                    args=<span class="stringliteral">&quot;-i %s -o %s.stk --sampling %f --Rmax %d --padding %d --ref %s --max_resolution %f --save_metadata_stack %s.xmd&quot;</span>%\</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;                         (fnAnglesToUse,fnGrayRoot,TsCurrent,R,self.contPadding.get(),fnRefVol,previousResolution,fnGrayRoot)</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;                    args+=<span class="stringliteral">&quot; --max_gray_scale %f --max_gray_shift %f&quot;</span>%\</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;                         (self.contMaxGrayScale.get(),self.contMaxGrayShift.get())</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_transform_adjust_image_grey_levels&quot;</span>,args,numberOfMpi=self.numberOfMpi.get())</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                    fnAnglesToUse = fnGrayRoot+<span class="stringliteral">&quot;.xmd&quot;</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;                    <span class="keywordflow">if</span> deleteStack:</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;                        cleanPattern(deletePattern)</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;                    deleteStack = <span class="keyword">True</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;                    deletePattern = fnGrayRoot+<span class="stringliteral">&quot;.*&quot;</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;                    <span class="comment"># Save the gray transformation</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --operate drop_column &quot;continuousA continuousB&quot;&#39;</span>%fnAngles,numberOfMpi=1)</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;                    fnAux = join(fnDirCurrent,<span class="stringliteral">&quot;gray_transformation%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --operate keep_column &quot;continuousA continuousB&quot; -o %s&#39;</span>%(fnAnglesToUse,fnAux),numberOfMpi=1)</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --set merge %s&#39;</span>%(fnAngles,fnAux),numberOfMpi=1)</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;                    cleanPath(fnAux)</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                <span class="comment"># Restrict the angles</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                <span class="keywordflow">if</span> self.restrictReconstructionAngles:</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;                    fnRestricted = join(fnDirCurrent,<span class="stringliteral">&quot;images_restricted%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;                    args = <span class="stringliteral">&#39;-i %s --query select &quot;angleRot &gt; %f AND anglePsi &lt; %f&quot; -o %s&#39;</span>%\</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;                           (fnAnglesToUse,self.angularMinTiltReconstruct.get(),self.angularMaxTiltReconstruct.get(),fnRestricted)</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,args,numberOfMpi=1)</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;                    fnAnglesToUse = fnRestricted</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;                <span class="comment"># Reconstruct Fourier</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;                args=<span class="stringliteral">&quot;-i %s -o %s --sym %s --weight&quot;</span>%(fnAnglesToUse,fnVol,self.symmetryGroup)</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;                <span class="keywordflow">if</span> self.useGpu.get():</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;                    <span class="comment">#AJ to make it work with and without queue system</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;                    <span class="keywordflow">if</span> self.numberOfMpi.get()&gt;1:</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;                        N_GPUs = len((self.gpuList.get()).split(<span class="stringliteral">&#39;,&#39;</span>))</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;                        args += <span class="stringliteral">&#39; -gpusPerNode %d&#39;</span> % N_GPUs</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;                        args += <span class="stringliteral">&#39; -threadsPerGPU %d&#39;</span> % max(self.numberOfThreads.get(),4)</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                    count=0</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                    GpuListCuda=<span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;                    <span class="keywordflow">if</span> self.useQueueForSteps() <span class="keywordflow">or</span> self.useQueue():</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                        GpuList = os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>]</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                        GpuList = GpuList.split(<span class="stringliteral">&quot;,&quot;</span>)</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                        <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> GpuList:</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;                            GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                            count+=1</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                        GpuListAux = <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;                        <span class="keywordflow">for</span> elem <span class="keywordflow">in</span> self.getGpuList():</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                            GpuListCuda = GpuListCuda+str(count)+<span class="stringliteral">&#39; &#39;</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;                            GpuListAux = GpuListAux+str(elem)+<span class="stringliteral">&#39;,&#39;</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                            count+=1</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;                        os.environ[<span class="stringliteral">&quot;CUDA_VISIBLE_DEVICES&quot;</span>] = GpuListAux</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                    <span class="keywordflow">if</span> self.numberOfMpi.get()==1:</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                        args += <span class="stringliteral">&quot; --device %s&quot;</span> %(GpuListCuda)</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;                    args += <span class="stringliteral">&#39; --thr %s&#39;</span> % self.numberOfThreads.get()</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;                    <span class="keywordflow">if</span> self.numberOfMpi.get()&gt;1:</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                        self.runJob(<span class="stringliteral">&#39;xmipp_cuda_reconstruct_fourier&#39;</span>, args, numberOfMpi=len((self.gpuList.get()).split(<span class="stringliteral">&#39;,&#39;</span>))+1)</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;                        self.runJob(<span class="stringliteral">&#39;xmipp_cuda_reconstruct_fourier&#39;</span>, args)</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_reconstruct_fourier_accel&quot;</span>, args, numberOfMpi=self.numberOfMpi.get())</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;                <span class="comment"># If stochastic gradient descent</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;                <span class="keywordflow">if</span> self.alignmentMethod==self.STOCHASTIC_ALIGNMENT:</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;                    newXdim = self.readInfoField(fnDirCurrent, <span class="stringliteral">&quot;size&quot;</span>, emlib.MDL_XSIZE)</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;                    fnAuxVol=join(fnDirCurrent,<span class="stringliteral">&quot;volume%02d_aux.vol&quot;</span>%i)</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;                    fnPreviousVol=join(fnDirPrevious,<span class="stringliteral">&quot;volume%02d.vol&quot;</span>%i)</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_image_resize&quot;</span>,<span class="stringliteral">&quot;-i %s -o %s --dim %d&quot;</span>%(fnPreviousVol,fnAuxVol,newXdim))</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --mult %f&quot;</span>%(fnVol,self.alphaSGD.get()))</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --mult %f&quot;</span>%(fnAuxVol,1-self.alphaSGD.get()))</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_image_operate&quot;</span>,<span class="stringliteral">&quot;-i %s --plus %s&quot;</span>%(fnVol,fnAuxVol))</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;                    cleanPath(fnAuxVol)</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;                <span class="keywordflow">if</span> deleteStack:</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                    cleanPattern(deletePattern)</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        <span class="keywordflow">if</span> grayAdjusted:</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;            fnAngles=join(fnDirCurrent,<span class="stringliteral">&quot;angles.xmd&quot;</span>)</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;            fnAnglesAux=join(fnDirCurrent,<span class="stringliteral">&quot;anglesAux.xmd&quot;</span>)</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;            fnAnglesAuxId=join(fnDirCurrent,<span class="stringliteral">&quot;anglesAuxId.xmd&quot;</span>)</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;            fnAngles1=join(fnDirCurrent,<span class="stringliteral">&quot;angles01.xmd&quot;</span>)</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;            fnAngles2=join(fnDirCurrent,<span class="stringliteral">&quot;angles02.xmd&quot;</span>)</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --operate drop_column &quot;continuousA continuousB&quot;&#39;</span>%fnAngles,numberOfMpi=1)</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&quot;-i %s --set union %s -o %s&quot;</span>%(fnAngles1,fnAngles2,fnAnglesAux),numberOfMpi=1)</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&quot;-i %s --operate keep_column itemId -o %s&quot;</span>%\</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                                                   (fnAnglesAux,fnAnglesAuxId),numberOfMpi=1)</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;            self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&quot;-i %s --set intersection %s itemId itemId&quot;</span>%\</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                                                   (fnAngles,fnAnglesAuxId),numberOfMpi=1)</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --operate sort itemId&#39;</span>%fnAngles,numberOfMpi=1)</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --operate sort itemId&#39;</span>%fnAnglesAux,numberOfMpi=1)</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --operate keep_column &quot;continuousA continuousB&quot;&#39;</span>%fnAnglesAux,numberOfMpi=1)</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;            self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&#39;-i %s --set merge %s&#39;</span>%(fnAngles,fnAnglesAux),numberOfMpi=1)</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;            cleanPath(fnAnglesAux)</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;            cleanPath(fnAnglesAuxId)</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div><div class="ttc" id="namespaceAutoConfig_html_a4db5974500e14fc05a286bdbfd7701b0"><div class="ttname"><a href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">AutoConfig.exists</a></div><div class="ttdeci">def exists(env)</div><div class="ttdef"><b>Definition:</b> <a href="install_2scons-tools_2AutoConfig_8py_source.html#l00088">AutoConfig.py:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6ec7986fe34102a12f16d9bbc52a1b8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ec7986fe34102a12f16d9bbc52a1b8e">&#9670;&nbsp;</a></span>weightParticles()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.weightParticles </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>iteration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l01127">1127</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keyword">def </span>weightParticles(self, iteration):</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        fnDirCurrent=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%iteration)</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        <span class="keyword">from</span> math <span class="keyword">import</span> exp</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,3):</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            <span class="comment"># Grab file</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            fnDirGlobal=join(fnDirCurrent,<span class="stringliteral">&quot;globalAssignment&quot;</span>)</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;            fnDirLocal=join(fnDirCurrent,<span class="stringliteral">&quot;localAssignment&quot;</span>)</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;            fnDirNo=join(fnDirCurrent,<span class="stringliteral">&quot;noAssignment&quot;</span>)</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;            fnAnglesCont=join(fnDirLocal,<span class="stringliteral">&quot;anglesCont%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;            fnAnglesDisc=join(fnDirGlobal,<span class="stringliteral">&quot;anglesDisc%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;            fnAnglesNo=join(fnDirNo,<span class="stringliteral">&quot;anglesNoAssignment%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            fnAngles=join(fnDirCurrent,<span class="stringliteral">&quot;angles%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;            <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAnglesCont):</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                copyFile(fnAnglesCont, fnAngles)</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                TsCurrent=self.readInfoField(fnDirLocal,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                Xdim=self.readInfoField(fnDirLocal,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE)</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            <span class="keywordflow">elif</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAnglesNo):</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                copyFile(fnAnglesNo, fnAngles)</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                TsCurrent = self.readInfoField(fnDirNo, <span class="stringliteral">&quot;sampling&quot;</span>, emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                Xdim = self.readInfoField(fnDirNo, <span class="stringliteral">&quot;size&quot;</span>, emlib.MDL_XSIZE)</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                <span class="keywordflow">if</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAnglesDisc):</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                    copyFile(fnAnglesDisc, fnAngles)</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                    TsCurrent=self.readInfoField(fnDirGlobal,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE)</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                    Xdim=self.readInfoField(fnDirGlobal,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE)</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                    <span class="keywordflow">raise</span> Exception(<span class="stringliteral">&quot;Angles for iteration &quot;</span>+str(iteration)+<span class="stringliteral">&quot; not found&quot;</span>)</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            self.writeInfoField(fnDirCurrent,<span class="stringliteral">&quot;sampling&quot;</span>,emlib.MDL_SAMPLINGRATE,TsCurrent)</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            self.writeInfoField(fnDirCurrent,<span class="stringliteral">&quot;size&quot;</span>,emlib.MDL_XSIZE,Xdim)</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            <span class="keywordflow">if</span> self.weightSSNR:</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;                row=getFirstRow(fnAngles)</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                <span class="keywordflow">if</span> row.containsLabel(emlib.MDL_WEIGHT_SSNR):</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --operate drop_column weightSSNR&quot;</span>%fnAngles,numberOfMpi=1)</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --set join %s particleId&quot;</span>%\</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;                            (fnAngles,self._getExtraPath(<span class="stringliteral">&quot;ssnrWeights.xmd&quot;</span>)),numberOfMpi=1)</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            <span class="keywordflow">if</span> iteration&gt;1 <span class="keywordflow">and</span> self.alignmentMethod!=self.STOCHASTIC_ALIGNMENT:</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;                fnDirPrevious=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%(iteration-1))</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                <span class="keywordflow">if</span> self.splitMethod == self.SPLIT_FIXED:</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                    fnPreviousAngles=join(fnDirPrevious,<span class="stringliteral">&quot;angles%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                    fnPreviousAngles=join(fnDirCurrent,<span class="stringliteral">&quot;aux.xmd&quot;</span>)</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --set intersection %s particleId particleId -o %s&quot;</span>%\</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                                (join(fnDirPrevious,<span class="stringliteral">&quot;angles.xmd&quot;</span>),fnAngles,fnPreviousAngles),numberOfMpi=1)</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                self.runJob(<span class="stringliteral">&quot;xmipp_angular_distance&quot;</span>,<span class="stringliteral">&quot;--ang1 %s --ang2 %s --compute_weights --check_mirrors --oroot %s --sym %s&quot;</span>%\</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;                            (fnPreviousAngles,fnAngles,fnDirCurrent+<span class="stringliteral">&quot;/jumper&quot;</span>,self.symmetryGroup),numberOfMpi=1)</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;                moveFile(fnDirCurrent+<span class="stringliteral">&quot;/jumper_weights.xmd&quot;</span>, fnAngles)</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                <span class="keywordflow">if</span> self.splitMethod == self.SPLIT_STOCHASTIC:</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                    cleanPath(fnPreviousAngles)</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                <span class="keywordflow">if</span> iteration&gt;2:</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                    fnDirPrevious=self._getExtraPath(<span class="stringliteral">&quot;Iter%03d&quot;</span>%(iteration-2))</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                    <span class="keywordflow">if</span> self.splitMethod == self.SPLIT_FIXED:</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                        fnPreviousAngles=join(fnDirPrevious,<span class="stringliteral">&quot;angles%02d.xmd&quot;</span>%i)</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                        fnPreviousAngles=join(fnDirCurrent,<span class="stringliteral">&quot;aux.xmd&quot;</span>)</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                        self.runJob(<span class="stringliteral">&quot;xmipp_metadata_utilities&quot;</span>,<span class="stringliteral">&quot;-i %s --set intersection %s particleId particleId -o %s&quot;</span>%\</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                                    (join(fnDirPrevious,<span class="stringliteral">&quot;angles.xmd&quot;</span>),fnAngles,fnPreviousAngles),numberOfMpi=1)</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                    self.runJob(<span class="stringliteral">&quot;xmipp_angular_distance&quot;</span>,<span class="stringliteral">&quot;--ang1 %s --ang2 %s --compute_weights --check_mirrors --oroot %s --set 2 --sym %s&quot;</span>%\</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                                (fnPreviousAngles,fnAngles,fnDirCurrent+<span class="stringliteral">&quot;/jumper&quot;</span>,self.symmetryGroup),numberOfMpi=1)</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                    moveFile(fnDirCurrent+<span class="stringliteral">&quot;/jumper_weights.xmd&quot;</span>, fnAngles)</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                    <span class="keywordflow">if</span> self.splitMethod == self.SPLIT_STOCHASTIC:</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                        cleanPath(fnPreviousAngles)</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;            <span class="comment">#if self.weightResiduals and exists(fnAnglesCont):</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;            <span class="comment">#    fnCovariance=join(fnDirLocal,&quot;covariance%02d.stk&quot;%i)</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;            <span class="comment">#    self.runJob(&quot;xmipp_image_residuals&quot;,&quot;-i %s -o %s --normalizeDivergence&quot;%(fnAngles,fnCovariance),numberOfMpi=1)</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;            <span class="comment">#    moveFile(join(fnDirLocal,&quot;covariance%02d.xmd&quot;%i),fnAngles)</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            </div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;            mdAngles=emlib.MetaData(fnAngles)</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            weightCCmin=float(self.weightCCmin.get())</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;            <span class="keywordflow">for</span> objId <span class="keywordflow">in</span> mdAngles:</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                weight=1.0</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                <span class="keywordflow">if</span> self.weightJumper <span class="keywordflow">and</span> self.alignmentMethod==self.GLOBAL_ALIGNMENT <span class="keywordflow">and</span> self.numberOfPerturbations.get()&gt;1:</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                    aux=mdAngles.getValue(emlib.MDL_WEIGHT_JUMPER0,objId)</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                    weight*=aux</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                <span class="keywordflow">if</span> self.weightSSNR:</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                    aux=mdAngles.getValue(emlib.MDL_WEIGHT_SSNR,objId)</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;                    weight*=aux</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                <span class="keywordflow">if</span> self.weightContinuous <span class="keywordflow">and</span> <a class="code" href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">exists</a>(fnAnglesCont) <span class="keywordflow">and</span> self.alignmentMethod==self.LOCAL_ALIGNMENT:</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                    aux=mdAngles.getValue(emlib.MDL_WEIGHT_CONTINUOUS2,objId)</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                    weight*=aux</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                <span class="comment">#if self.weightResiduals and exists(fnAnglesCont):</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                <span class="comment">#    aux=mdAngles.getValue(emlib.MDL_ZSCORE_RESCOV,objId)</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                <span class="comment">#    aux/=3</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                <span class="comment">#    weight*=exp(-0.5*aux*aux)</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                <span class="comment">#    aux=mdAngles.getValue(emlib.MDL_ZSCORE_RESMEAN,objId)</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                <span class="comment">#    aux/=3</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                <span class="comment">#    weight*=exp(-0.5*aux*aux)</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                <span class="comment">#    aux=mdAngles.getValue(emlib.MDL_ZSCORE_RESVAR,objId)</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                <span class="comment">#    aux/=3</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                <span class="comment">#    weight*=exp(-0.5*aux*aux)</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                <span class="keywordflow">if</span> self.weightJumper <span class="keywordflow">and</span> iteration&gt;1:</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;                    w1=mdAngles.getValue(emlib.MDL_WEIGHT_JUMPER,objId)</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                    w2=1.0</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;                    <span class="keywordflow">if</span> iteration&gt;2:</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                        w2=mdAngles.getValue(emlib.MDL_WEIGHT_JUMPER2,objId)</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;                    weight*=w1*w2</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;                mdAngles.setValue(emlib.MDL_WEIGHT,weight,objId)</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;            mdAngles.write(fnAngles)</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        fnAngles=join(fnDirCurrent,<span class="stringliteral">&quot;angles.xmd&quot;</span>)</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        fnAngles1=join(fnDirCurrent,<span class="stringliteral">&quot;angles01.xmd&quot;</span>)</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        fnAngles2=join(fnDirCurrent,<span class="stringliteral">&quot;angles02.xmd&quot;</span>)</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        self.runJob(<span class="stringliteral">&#39;xmipp_metadata_utilities&#39;</span>,<span class="stringliteral">&quot;-i %s --set union %s -o %s&quot;</span>%(fnAngles1,fnAngles2,fnAngles),numberOfMpi=1)</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="ttc" id="namespaceAutoConfig_html_a4db5974500e14fc05a286bdbfd7701b0"><div class="ttname"><a href="namespaceAutoConfig.html#a4db5974500e14fc05a286bdbfd7701b0">AutoConfig.exists</a></div><div class="ttdeci">def exists(env)</div><div class="ttdef"><b>Definition:</b> <a href="install_2scons-tools_2AutoConfig_8py_source.html#l00088">AutoConfig.py:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a00a9740007e704765790d38a48fc102f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00a9740007e704765790d38a48fc102f">&#9670;&nbsp;</a></span>writeInfoField()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.writeInfoField </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fnDir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>block</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00664">664</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>
<div class="fragment"><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="keyword">def </span><a class="code" href="namespacexmipp__base.html#a5d29a2b26aadbdd8f89762c128860e9c">writeInfoField</a>(self,fnDir,block,label, value):</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        mdInfo = emlib.MetaData()</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        objId=mdInfo.addObject()</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        mdInfo.setValue(label,value,objId)</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        mdInfo.write(<span class="stringliteral">&quot;%s@%s&quot;</span>%(block,join(fnDir,<span class="stringliteral">&quot;iterInfo.xmd&quot;</span>)),emlib.MD_APPEND)</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;</div><div class="ttc" id="namespacexmipp__base_html_a5d29a2b26aadbdd8f89762c128860e9c"><div class="ttname"><a href="namespacexmipp__base.html#a5d29a2b26aadbdd8f89762c128860e9c">xmipp_base.writeInfoField</a></div><div class="ttdeci">def writeInfoField(fnDir, block, label, value, xmdFile=&quot;iterInfo.xmd&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__base_8py_source.html#l00532">xmipp_base.py:532</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a2c008532bdb15df503d3834441574b70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c008532bdb15df503d3834441574b70">&#9670;&nbsp;</a></span>alignmentMethod</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.alignmentMethod</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00310">310</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="a7c7e79ca2eb11a98daeb6448072475cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c7e79ca2eb11a98daeb6448072475cc">&#9670;&nbsp;</a></span>AUTOMATIC_ALIGNMENT</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.AUTOMATIC_ALIGNMENT = 2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00093">93</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="a83b9162cecd316fe7c2342e96ca92e44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83b9162cecd316fe7c2342e96ca92e44">&#9670;&nbsp;</a></span>firstIteration</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.firstIteration</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00293">293</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="a30f95d463646ccc26173960bddd20005"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30f95d463646ccc26173960bddd20005">&#9670;&nbsp;</a></span>GLOBAL_ALIGNMENT</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.GLOBAL_ALIGNMENT = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00091">91</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="a54b7c25034ccaa1340f9654159e2bdb7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54b7c25034ccaa1340f9654159e2bdb7">&#9670;&nbsp;</a></span>imgsFn</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.imgsFn</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00284">284</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="ab5e606b7e097ab58549c8ea3f99708b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5e606b7e097ab58549c8ea3f99708b7">&#9670;&nbsp;</a></span>iterMd</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.iterMd</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00370">370</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="a8e6b5ec26b9f7f0821a8b53bb669c6e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e6b5ec26b9f7f0821a8b53bb669c6e2">&#9670;&nbsp;</a></span>lastRow</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.lastRow</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00371">371</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="a4b6e454fc05c49e57c37181cbc8a4e27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b6e454fc05c49e57c37181cbc8a4e27">&#9670;&nbsp;</a></span>LOCAL_ALIGNMENT</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.LOCAL_ALIGNMENT = 1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00092">92</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="a994a5c11dbbf000cf3c93d9d5525593a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a994a5c11dbbf000cf3c93d9d5525593a">&#9670;&nbsp;</a></span>NO_ALIGNMENT</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.NO_ALIGNMENT = 4</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00095">95</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="a548d226258b3778f423562744d78583a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a548d226258b3778f423562744d78583a">&#9670;&nbsp;</a></span>scaleFactor</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.scaleFactor</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00365">365</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="a806a5a1a4376247a6a2f9fb2b3ca7cb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a806a5a1a4376247a6a2f9fb2b3ca7cb0">&#9670;&nbsp;</a></span>SPLIT_FIXED</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.SPLIT_FIXED = 1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00089">89</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="a66d19810215d3e851699c9edd4843f03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66d19810215d3e851699c9edd4843f03">&#9670;&nbsp;</a></span>SPLIT_STOCHASTIC</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.SPLIT_STOCHASTIC = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00088">88</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="af34bfdd78ad64beaa6a328055b575172"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af34bfdd78ad64beaa6a328055b575172">&#9670;&nbsp;</a></span>splitMethod</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.splitMethod</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00463">463</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="a4711b9d900e4a36de2710cfe29ec4e1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4711b9d900e4a36de2710cfe29ec4e1c">&#9670;&nbsp;</a></span>STOCHASTIC_ALIGNMENT</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.STOCHASTIC_ALIGNMENT = 3</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00094">94</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<a id="aa7417eeb425ff364bdce78108e946fd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7417eeb425ff364bdce78108e946fd2">&#9670;&nbsp;</a></span>TsOrig</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">xmipp3.protocols.protocol_reconstruct_highres.XmippProtReconstructHighRes.TsOrig</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="protocol__reconstruct__highres_8py_source.html#l00300">300</a> of file <a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>scipion-em-xmipp/xmipp3/protocols/<a class="el" href="protocol__reconstruct__highres_8py_source.html">protocol_reconstruct_highres.py</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
